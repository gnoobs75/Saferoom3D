using Godot;
using System;
using System.Collections.Generic;

namespace SafeRoom3D.Enemies;

/// <summary>
/// Factory for creating monster meshes. Shared between BasicEnemy3D and EditorScreen3D
/// to ensure consistent appearance between game and editor preview.
/// </summary>
public static class MonsterMeshFactory
{
    /// <summary>
    /// Container for limb nodes used in animation
    /// </summary>
    public class LimbNodes
    {
        public Node3D? Head { get; set; }
        public Node3D? LeftArm { get; set; }
        public Node3D? RightArm { get; set; }
        public Node3D? LeftLeg { get; set; }
        public Node3D? RightLeg { get; set; }
        public Node3D? Weapon { get; set; }
        public Node3D? Torch { get; set; }
    }

    /// <summary>
    /// Level of detail for monster meshes
    /// </summary>
    public enum LODLevel
    {
        High,    // Full detail: 24-32 segments, all features
        Medium,  // Simplified: 16 segments, reduced details
        Low      // Basic silhouette: 8 segments, minimal features
    }

    /// <summary>
    /// Get radial segment count based on LOD level
    /// </summary>
    private static int GetRadialSegments(LODLevel lod)
    {
        return lod switch
        {
            LODLevel.High => 32,
            LODLevel.Medium => 16,
            LODLevel.Low => 8,
            _ => 16
        };
    }

    /// <summary>
    /// Get ring count based on LOD level
    /// </summary>
    private static int GetRings(LODLevel lod)
    {
        return lod switch
        {
            LODLevel.High => 16,
            LODLevel.Medium => 8,
            LODLevel.Low => 4,
            _ => 8
        };
    }

    /// <summary>
    /// Create a monster mesh and add it to the parent node.
    /// Returns limb nodes for animation purposes.
    /// </summary>
    public static LimbNodes CreateMonsterMesh(Node3D parent, string monsterType, Color? skinColorOverride = null)
    {
        var limbs = new LimbNodes();

        switch (monsterType.ToLower())
        {
            case "goblin":
                CreateGoblinMesh(parent, limbs, skinColorOverride);
                break;
            case "goblin_shaman":
                CreateGoblinShamanMesh(parent, limbs, skinColorOverride);
                break;
            case "goblin_thrower":
                CreateGoblinThrowerMesh(parent, limbs, skinColorOverride);
                break;
            case "goblin_warlord":
            case "boss_goblin":
                CreateGoblinWarlordMesh(parent, limbs, skinColorOverride);
                break;
            case "slime":
                CreateSlimeMesh(parent, limbs, skinColorOverride);
                break;
            case "skeleton":
                CreateSkeletonMesh(parent, limbs);
                break;
            case "wolf":
                CreateWolfMesh(parent, limbs);
                break;
            case "bat":
                CreateBatMesh(parent, limbs);
                break;
            case "dragon":
                CreateDragonMesh(parent, limbs);
                break;
            case "eye":
                CreateEyeMesh(parent, limbs, skinColorOverride);
                break;
            case "mushroom":
                CreateMushroomMesh(parent, limbs, skinColorOverride);
                break;
            case "spider":
                CreateSpiderMesh(parent, limbs, skinColorOverride);
                break;
            case "lizard":
                CreateLizardMesh(parent, limbs, skinColorOverride);
                break;
            case "badlama":
                CreateBadlamaMesh(parent, limbs, skinColorOverride);
                break;
            // Bosses
            case "slime_king":
            case "boss_slime":
                CreateSlimeKingMesh(parent, limbs, skinColorOverride);
                break;
            case "skeleton_lord":
            case "boss_skeleton":
                CreateSkeletonLordMesh(parent, limbs);
                break;
            case "dragon_king":
            case "boss_dragon":
                CreateDragonKingMesh(parent, limbs);
                break;
            case "spider_queen":
            case "boss_spider":
                CreateSpiderQueenMesh(parent, limbs);
                break;
            default:
                CreateSlimeMesh(parent, limbs, skinColorOverride);
                break;
        }

        return limbs;
    }

    private static void CreateGoblinMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride, LODLevel lod = LODLevel.High, float sizeVariation = 1.0f)
    {
        // Apply random hue shift for variation
        Color baseSkin = skinColorOverride ?? new Color(0.45f, 0.55f, 0.35f);
        float hueShift = (GD.Randf() - 0.5f) * 0.1f; // +/- 5% hue
        Color skinColor = baseSkin.Lightened(hueShift);
        Color darkSkinColor = skinColor.Darkened(0.2f);
        Color clothColor = new Color(0.4f, 0.3f, 0.2f);
        Color eyeColor = new Color(0.9f, 0.85f, 0.2f);
        Color toothColor = new Color(0.85f, 0.82f, 0.7f);

        // LOD-based segment counts
        int radialSegs = GetRadialSegments(lod);
        int rings = GetRings(lod);

        var skinMat = new StandardMaterial3D { AlbedoColor = skinColor, Roughness = 0.8f };
        var darkSkinMat = new StandardMaterial3D { AlbedoColor = darkSkinColor, Roughness = 0.85f };
        var clothMat = new StandardMaterial3D { AlbedoColor = clothColor, Roughness = 0.9f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = eyeColor,
            EmissionEnabled = true,
            Emission = eyeColor * 0.3f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };
        var toothMat = new StandardMaterial3D { AlbedoColor = toothColor, Roughness = 0.6f };

        // Apply size variation
        float scale = sizeVariation;

        // Body - muscular torso with asymmetry
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh { Radius = 0.24f * scale, Height = 0.48f * scale, RadialSegments = radialSegs, Rings = rings };
        body.Mesh = bodyMesh;
        body.MaterialOverride = clothMat;
        body.Position = new Vector3(0, 0.5f * scale, 0);
        body.Scale = new Vector3(0.92f, 1.2f, 0.78f); // Asymmetric for organic feel
        parent.AddChild(body);

        // Belly showing under clothes (only in High LOD)
        if (lod == LODLevel.High)
        {
            var belly = new MeshInstance3D();
            var bellyMesh = new SphereMesh { Radius = 0.13f * scale, Height = 0.26f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
            belly.Mesh = bellyMesh;
            belly.MaterialOverride = skinMat;
            belly.Position = new Vector3(0, 0.38f * scale, 0.09f * scale);
            parent.AddChild(belly);
        }

        // Head (in Node3D for animation) - larger relative to body, goblin proportions
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.85f * scale, 0.02f * scale);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        // Randomize head asymmetry
        float headAsymX = 0.98f + (GD.Randf() - 0.5f) * 0.08f; // 0.94-1.02
        float headAsymY = 0.92f + (GD.Randf() - 0.5f) * 0.06f; // 0.89-0.95

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.21f * scale, Height = 0.42f * scale, RadialSegments = radialSegs, Rings = rings };
        head.Mesh = headMesh;
        head.MaterialOverride = skinMat;
        head.Scale = new Vector3(headAsymX, headAsymY, 0.94f); // Asymmetry for organic feel
        headNode.AddChild(head);

        // Prominent brow ridge (menacing goblin face)
        if (lod >= LODLevel.Medium)
        {
            var browMesh = new BoxMesh { Size = new Vector3(0.2f * scale, 0.045f * scale, 0.09f * scale) };
            var brow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = darkSkinMat };
            brow.Position = new Vector3(0, 0.09f * scale, 0.15f * scale);
            headNode.AddChild(brow);
        }

        // Eyes with pupils - larger, more expressive
        int eyeSegs = lod == LODLevel.High ? radialSegs / 2 : radialSegs / 4;
        var eyeMesh = new SphereMesh { Radius = 0.058f * scale, Height = 0.116f * scale, RadialSegments = eyeSegs, Rings = eyeSegs / 2 };
        var pupilMesh = new SphereMesh { Radius = 0.03f * scale, Height = 0.06f * scale, RadialSegments = Mathf.Max(8, eyeSegs / 2), Rings = Mathf.Max(4, eyeSegs / 4) };

        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.075f, 0.04f, 0.15f);
        leftEye.Scale = new Vector3(0.98f, 1.05f, 1f); // Slight asymmetry
        headNode.AddChild(leftEye);
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.075f, 0.04f, 0.2f);
        headNode.AddChild(leftPupil);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.07f, 0.04f, 0.15f);
        rightEye.Scale = new Vector3(1.02f, 1f, 1f); // Slight asymmetry
        headNode.AddChild(rightEye);
        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.07f, 0.04f, 0.2f);
        headNode.AddChild(rightPupil);

        // Nose with nostrils - more prominent and hooked
        var nose = new MeshInstance3D();
        var noseMesh = new SphereMesh { Radius = 0.055f, Height = 0.11f, RadialSegments = 16, Rings = 12 };
        nose.Mesh = noseMesh;
        nose.MaterialOverride = skinMat;
        nose.Position = new Vector3(0, -0.02f, 0.18f);
        nose.Scale = new Vector3(1.05f, 0.85f, 0.75f); // Wider, flatter
        headNode.AddChild(nose);

        // Nostrils - larger and more visible
        var nostrilMesh = new SphereMesh { Radius = 0.018f, Height = 0.036f, RadialSegments = 12, Rings = 8 };
        var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = darkSkinMat };
        leftNostril.Position = new Vector3(-0.028f, -0.04f, 0.21f);
        leftNostril.Scale = new Vector3(0.9f, 1.1f, 0.8f);
        headNode.AddChild(leftNostril);
        var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = darkSkinMat };
        rightNostril.Position = new Vector3(0.028f, -0.04f, 0.21f);
        rightNostril.Scale = new Vector3(0.9f, 1.1f, 0.8f);
        headNode.AddChild(rightNostril);

        // Mouth area
        var mouthMesh = new BoxMesh { Size = new Vector3(0.1f, 0.03f, 0.04f) };
        var mouth = new MeshInstance3D { Mesh = mouthMesh, MaterialOverride = darkSkinMat };
        mouth.Position = new Vector3(0, -0.1f, 0.15f);
        headNode.AddChild(mouth);

        // Teeth (snaggle-toothed goblin look)
        var toothMesh = new CylinderMesh { TopRadius = 0.008f, BottomRadius = 0.012f, Height = 0.04f };
        // Lower fangs sticking up
        var tooth1 = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = toothMat };
        tooth1.Position = new Vector3(-0.03f, -0.08f, 0.17f);
        tooth1.RotationDegrees = new Vector3(10, 0, 5);
        headNode.AddChild(tooth1);
        var tooth2 = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = toothMat };
        tooth2.Position = new Vector3(0.025f, -0.085f, 0.16f);
        tooth2.RotationDegrees = new Vector3(8, 0, -8);
        headNode.AddChild(tooth2);
        // Upper teeth
        var smallToothMesh = new CylinderMesh { TopRadius = 0.006f, BottomRadius = 0.008f, Height = 0.025f };
        var tooth3 = new MeshInstance3D { Mesh = smallToothMesh, MaterialOverride = toothMat };
        tooth3.Position = new Vector3(-0.015f, -0.095f, 0.17f);
        tooth3.RotationDegrees = new Vector3(-170, 0, 0);
        headNode.AddChild(tooth3);
        var tooth4 = new MeshInstance3D { Mesh = smallToothMesh, MaterialOverride = toothMat };
        tooth4.Position = new Vector3(0.01f, -0.093f, 0.168f);
        tooth4.RotationDegrees = new Vector3(-175, 0, 0);
        headNode.AddChild(tooth4);

        // Large pointed ears with variation - key goblin feature!
        float earSizeVar = 0.95f + GD.Randf() * 0.15f; // 0.95-1.1x variation
        int earSegs = lod == LODLevel.High ? radialSegs / 2 : Mathf.Max(8, radialSegs / 4);
        var earMesh = new CylinderMesh {
            TopRadius = 0.01f * scale * earSizeVar,
            BottomRadius = 0.06f * scale * earSizeVar,
            Height = 0.24f * scale * earSizeVar,
            RadialSegments = earSegs,
            Rings = Mathf.Max(4, earSegs / 2)
        };

        // Asymmetric ear angles for organic feel
        float leftEarAngle = -56f + (GD.Randf() - 0.5f) * 8f; // -60 to -52
        float rightEarAngle = 54f + (GD.Randf() - 0.5f) * 8f;  // 50 to 58

        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        leftEar.Position = new Vector3(-0.21f * scale, 0.02f * scale, -0.02f * scale);
        leftEar.RotationDegrees = new Vector3(12, 20, leftEarAngle);
        leftEar.Scale = new Vector3(1.08f, 1f, 0.96f);
        headNode.AddChild(leftEar);

        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        rightEar.Position = new Vector3(0.21f * scale, 0.02f * scale, -0.02f * scale);
        rightEar.RotationDegrees = new Vector3(12, -17, rightEarAngle);
        rightEar.Scale = new Vector3(0.96f, 1f, 1.04f);
        headNode.AddChild(rightEar);

        // Inner ear detail (Medium and High LOD only)
        if (lod >= LODLevel.Medium)
        {
            var innerEarMesh = new CylinderMesh {
                TopRadius = 0.005f * scale * earSizeVar,
                BottomRadius = 0.032f * scale * earSizeVar,
                Height = 0.13f * scale * earSizeVar,
                RadialSegments = Mathf.Max(8, earSegs / 2),
                Rings = Mathf.Max(3, earSegs / 4)
            };
            var leftInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = darkSkinMat };
            leftInnerEar.Position = new Vector3(-0.19f * scale, 0.02f * scale, 0);
            leftInnerEar.RotationDegrees = new Vector3(12, 20, leftEarAngle);
            headNode.AddChild(leftInnerEar);
            var rightInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = darkSkinMat };
            rightInnerEar.Position = new Vector3(0.19f * scale, 0.02f * scale, 0);
            rightInnerEar.RotationDegrees = new Vector3(12, -17, rightEarAngle);
            headNode.AddChild(rightInnerEar);
        }

        // Arms with muscular definition and better segmentation
        int armSegs = lod == LODLevel.High ? radialSegs / 2 : Mathf.Max(8, radialSegs / 4);
        var upperArmMesh = new CapsuleMesh {
            Radius = 0.052f * scale,
            Height = 0.22f * scale,
            RadialSegments = armSegs,
            Rings = Mathf.Max(4, armSegs / 2)
        };
        var lowerArmMesh = new CapsuleMesh {
            Radius = 0.045f * scale,
            Height = 0.2f * scale,
            RadialSegments = armSegs,
            Rings = Mathf.Max(3, armSegs / 3)
        };
        var handMesh = new SphereMesh {
            Radius = 0.042f * scale,
            Height = 0.084f * scale,
            RadialSegments = Mathf.Max(8, armSegs),
            Rings = Mathf.Max(4, armSegs / 2)
        };
        var fingerMesh = new CylinderMesh {
            TopRadius = 0.01f * scale,
            BottomRadius = 0.014f * scale,
            Height = 0.065f * scale,
            RadialSegments = Mathf.Max(6, armSegs / 2),
            Rings = 2
        };

        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.25f * scale, 0.56f * scale, 0);
        leftArmNode.RotationDegrees = new Vector3(0, 0, -26);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;

        var leftUpperArm = new MeshInstance3D { Mesh = upperArmMesh, MaterialOverride = skinMat };
        leftUpperArm.Position = new Vector3(0, -0.09f * scale, 0);
        leftArmNode.AddChild(leftUpperArm);
        var leftLowerArm = new MeshInstance3D { Mesh = lowerArmMesh, MaterialOverride = skinMat };
        leftLowerArm.Position = new Vector3(0, -0.27f * scale, 0.02f * scale);
        leftLowerArm.RotationDegrees = new Vector3(-16, 0, 0);
        leftArmNode.AddChild(leftLowerArm);
        var leftHand = new MeshInstance3D { Mesh = handMesh, MaterialOverride = skinMat };
        leftHand.Position = new Vector3(0, -0.41f * scale, 0.045f * scale);
        leftHand.Scale = new Vector3(1f, 0.72f, 1.25f);
        leftArmNode.AddChild(leftHand);
        // Fingers (3-finger goblin hands, only High LOD)
        if (lod == LODLevel.High)
        {
            for (int f = 0; f < 3; f++)
            {
                var finger = new MeshInstance3D { Mesh = fingerMesh, MaterialOverride = skinMat };
                finger.Position = new Vector3((-0.022f + f * 0.022f) * scale, -0.45f * scale, 0.065f * scale);
                finger.RotationDegrees = new Vector3(-62, 0, -12 + f * 12);
                leftArmNode.AddChild(finger);
            }
        }

        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.25f * scale, 0.56f * scale, 0);
        rightArmNode.RotationDegrees = new Vector3(0, 0, 26);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;

        var rightUpperArm = new MeshInstance3D { Mesh = upperArmMesh, MaterialOverride = skinMat };
        rightUpperArm.Position = new Vector3(0, -0.09f * scale, 0);
        rightArmNode.AddChild(rightUpperArm);
        var rightLowerArm = new MeshInstance3D { Mesh = lowerArmMesh, MaterialOverride = skinMat };
        rightLowerArm.Position = new Vector3(0, -0.27f * scale, 0.02f * scale);
        rightLowerArm.RotationDegrees = new Vector3(-16, 0, 0);
        rightArmNode.AddChild(rightLowerArm);
        var rightHand = new MeshInstance3D { Mesh = handMesh, MaterialOverride = skinMat };
        rightHand.Position = new Vector3(0, -0.41f * scale, 0.045f * scale);
        rightHand.Scale = new Vector3(1f, 0.72f, 1.25f);
        rightArmNode.AddChild(rightHand);
        // Fingers (3-finger goblin hands, only High LOD)
        if (lod == LODLevel.High)
        {
            for (int f = 0; f < 3; f++)
            {
                var finger = new MeshInstance3D { Mesh = fingerMesh, MaterialOverride = skinMat };
                finger.Position = new Vector3((-0.022f + f * 0.022f) * scale, -0.45f * scale, 0.065f * scale);
                finger.RotationDegrees = new Vector3(-62, 0, -12 + f * 12);
                rightArmNode.AddChild(finger);
            }
        }

        // Legs with feet - muscular definition
        int legSegs = lod == LODLevel.High ? radialSegs / 2 : Mathf.Max(8, radialSegs / 4);
        var legMesh = new CapsuleMesh {
            Radius = 0.063f * scale,
            Height = 0.3f * scale,
            RadialSegments = legSegs,
            Rings = Mathf.Max(5, legSegs / 2)
        };
        var footMesh = new SphereMesh {
            Radius = 0.052f * scale,
            Height = 0.104f * scale,
            RadialSegments = Mathf.Max(8, legSegs),
            Rings = Mathf.Max(4, legSegs / 2)
        };
        var toeMesh = new CylinderMesh {
            TopRadius = 0.012f * scale,
            BottomRadius = 0.017f * scale,
            Height = 0.045f * scale,
            RadialSegments = Mathf.Max(6, legSegs / 2),
            Rings = 2
        };

        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.11f * scale, 0.24f * scale, 0);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;

        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        leftLegNode.AddChild(leftLeg);
        var leftFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = skinMat };
        leftFoot.Position = new Vector3(0, -0.17f * scale, 0.045f * scale);
        leftFoot.Scale = new Vector3(0.82f, 0.52f, 1.35f);
        leftLegNode.AddChild(leftFoot);
        // Toes (3-toe goblin feet, only High LOD)
        if (lod == LODLevel.High)
        {
            for (int t = 0; t < 3; t++)
            {
                var toe = new MeshInstance3D { Mesh = toeMesh, MaterialOverride = skinMat };
                toe.Position = new Vector3((-0.022f + t * 0.022f) * scale, -0.19f * scale, 0.095f * scale);
                toe.RotationDegrees = new Vector3(-72, 0, -12 + t * 12);
                leftLegNode.AddChild(toe);
            }
        }

        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.11f * scale, 0.24f * scale, 0);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;

        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        rightLegNode.AddChild(rightLeg);
        var rightFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = skinMat };
        rightFoot.Position = new Vector3(0, -0.17f * scale, 0.045f * scale);
        rightFoot.Scale = new Vector3(0.82f, 0.52f, 1.35f);
        rightLegNode.AddChild(rightFoot);
        // Toes (3-toe goblin feet, only High LOD)
        if (lod == LODLevel.High)
        {
            for (int t = 0; t < 3; t++)
            {
                var toe = new MeshInstance3D { Mesh = toeMesh, MaterialOverride = skinMat };
                toe.Position = new Vector3((-0.022f + t * 0.022f) * scale, -0.19f * scale, 0.095f * scale);
                toe.RotationDegrees = new Vector3(-72, 0, -12 + t * 12);
                rightLegNode.AddChild(toe);
            }
        }

        // Add simple weapon (dagger/club) for basic goblin - only High LOD
        if (lod == LODLevel.High)
        {
            var weaponNode = new Node3D();
            weaponNode.Position = new Vector3(0.08f * scale, -0.42f * scale, 0.06f * scale);
            rightArmNode.AddChild(weaponNode);
            limbs.Weapon = weaponNode;

            // Simple crude dagger
            var daggerHandle = new MeshInstance3D();
            var handleMesh = new CylinderMesh {
                TopRadius = 0.012f * scale,
                BottomRadius = 0.012f * scale,
                Height = 0.12f * scale,
                RadialSegments = 8
            };
            daggerHandle.Mesh = handleMesh;
            daggerHandle.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.3f, 0.2f, 0.15f), Roughness = 0.8f };
            daggerHandle.RotationDegrees = new Vector3(-75, 0, 0);
            weaponNode.AddChild(daggerHandle);

            var daggerBlade = new MeshInstance3D();
            var bladeMesh = new CylinderMesh {
                TopRadius = 0.004f * scale,
                BottomRadius = 0.018f * scale,
                Height = 0.16f * scale,
                RadialSegments = 8
            };
            daggerBlade.Mesh = bladeMesh;
            daggerBlade.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.6f, 0.6f, 0.65f), Metallic = 0.5f, Roughness = 0.5f };
            daggerBlade.Position = new Vector3(0, 0.12f, -0.05f);
            daggerBlade.RotationDegrees = new Vector3(-75, 0, 0);
            weaponNode.AddChild(daggerBlade);
        }
    }

    private static void CreateGoblinShamanMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride, LODLevel lod = LODLevel.High, float sizeVariation = 1.0f)
    {
        // Shaman is a magical goblin with robes and a staff
        Color baseSkin = skinColorOverride ?? new Color(0.35f, 0.45f, 0.55f); // Blue-green tint
        float hueShift = (GD.Randf() - 0.5f) * 0.08f;
        Color skinColor = baseSkin.Lightened(hueShift);
        Color robeColor = new Color(0.25f, 0.15f, 0.4f); // Purple robes
        Color glowColor = new Color(0.4f, 0.8f, 1f); // Magical cyan glow
        Color eyeColor = new Color(0.4f, 0.9f, 1f); // Glowing cyan eyes

        // LOD-based segment counts
        int radialSegs = GetRadialSegments(lod);
        int rings = GetRings(lod);
        float scale = sizeVariation;

        var skinMat = new StandardMaterial3D { AlbedoColor = skinColor, Roughness = 0.8f };
        var robeMat = new StandardMaterial3D { AlbedoColor = robeColor, Roughness = 0.9f };
        var glowMat = new StandardMaterial3D
        {
            AlbedoColor = glowColor,
            EmissionEnabled = true,
            Emission = glowColor,
            EmissionEnergyMultiplier = 1.5f
        };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = eyeColor,
            EmissionEnabled = true,
            Emission = eyeColor * 0.8f
        };

        // Body in long robes
        var body = new MeshInstance3D();
        var bodyMesh = new CylinderMesh { TopRadius = 0.2f, BottomRadius = 0.35f, Height = 0.7f };
        body.Mesh = bodyMesh;
        body.MaterialOverride = robeMat;
        body.Position = new Vector3(0, 0.35f, 0);
        parent.AddChild(body);

        // Head
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.88f, 0);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.2f, Height = 0.4f };
        head.Mesh = headMesh;
        head.MaterialOverride = skinMat;
        headNode.AddChild(head);

        // Glowing eyes
        var eyeMesh = new SphereMesh { Radius = 0.05f, Height = 0.1f };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.08f, 0.02f, 0.15f);
        headNode.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.08f, 0.02f, 0.15f);
        headNode.AddChild(rightEye);

        // Pointy ears
        var earMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.05f, Height = 0.15f };
        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        leftEar.Position = new Vector3(-0.2f, 0.02f, 0);
        leftEar.RotationDegrees = new Vector3(0, 0, -60);
        headNode.AddChild(leftEar);

        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        rightEar.Position = new Vector3(0.2f, 0.02f, 0);
        rightEar.RotationDegrees = new Vector3(0, 0, 60);
        headNode.AddChild(rightEar);

        // Hood (partial)
        var hood = new MeshInstance3D();
        var hoodMesh = new SphereMesh { Radius = 0.25f, Height = 0.3f };
        hood.Mesh = hoodMesh;
        hood.MaterialOverride = robeMat;
        hood.Position = new Vector3(0, 0.08f, -0.05f);
        hood.Scale = new Vector3(1f, 0.6f, 0.8f);
        headNode.AddChild(hood);

        // Staff arm (right)
        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.25f, 0.6f, 0);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;

        var rightArm = new MeshInstance3D();
        var armMesh = new CapsuleMesh { Radius = 0.06f, Height = 0.3f };
        rightArm.Mesh = armMesh;
        rightArm.MaterialOverride = skinMat;
        rightArm.RotationDegrees = new Vector3(0, 0, -30);
        rightArmNode.AddChild(rightArm);

        // Magical staff
        var staffNode = new Node3D();
        staffNode.Position = new Vector3(0.15f, -0.1f, 0);
        rightArmNode.AddChild(staffNode);
        limbs.Weapon = staffNode;

        var staff = new MeshInstance3D();
        var staffMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.03f, Height = 1.2f };
        staff.Mesh = staffMesh;
        staff.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.3f, 0.2f, 0.15f) };
        staff.Position = new Vector3(0, -0.4f, 0);
        staffNode.AddChild(staff);

        // Glowing orb on staff
        var orb = new MeshInstance3D();
        var orbMesh = new SphereMesh { Radius = 0.1f, Height = 0.2f };
        orb.Mesh = orbMesh;
        orb.MaterialOverride = glowMat;
        orb.Position = new Vector3(0, 0.25f, 0);
        staffNode.AddChild(orb);

        // Left arm
        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.25f, 0.6f, 0);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;

        var leftArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = skinMat };
        leftArm.RotationDegrees = new Vector3(0, 0, 30);
        leftArmNode.AddChild(leftArm);
    }

    private static void CreateGoblinThrowerMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride, LODLevel lod = LODLevel.High, float sizeVariation = 1.0f)
    {
        // Thrower is a ranged goblin with a bandolier and throwing weapons
        Color baseSkin = skinColorOverride ?? new Color(0.5f, 0.45f, 0.35f); // Tan/brown
        float hueShift = (GD.Randf() - 0.5f) * 0.08f;
        Color skinColor = baseSkin.Lightened(hueShift);
        Color clothColor = new Color(0.35f, 0.25f, 0.2f); // Leather
        Color metalColor = new Color(0.5f, 0.5f, 0.55f); // Steel
        Color eyeColor = new Color(0.9f, 0.75f, 0.2f);

        var skinMat = new StandardMaterial3D { AlbedoColor = skinColor, Roughness = 0.8f };
        var clothMat = new StandardMaterial3D { AlbedoColor = clothColor, Roughness = 0.9f };
        var metalMat = new StandardMaterial3D { AlbedoColor = metalColor, Metallic = 0.6f, Roughness = 0.4f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = eyeColor,
            EmissionEnabled = true,
            Emission = eyeColor * 0.3f
        };

        // Body - lean and athletic
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh { Radius = 0.22f, Height = 0.44f };
        body.Mesh = bodyMesh;
        body.MaterialOverride = clothMat;
        body.Position = new Vector3(0, 0.5f, 0);
        body.Scale = new Vector3(0.9f, 1.1f, 0.8f);
        parent.AddChild(body);

        // Bandolier (diagonal strap with spears)
        var bandolier = new MeshInstance3D();
        var bandMesh = new BoxMesh { Size = new Vector3(0.08f, 0.6f, 0.04f) };
        bandolier.Mesh = bandMesh;
        bandolier.MaterialOverride = clothMat;
        bandolier.Position = new Vector3(0.05f, 0.5f, 0.12f);
        bandolier.RotationDegrees = new Vector3(0, 0, 30);
        parent.AddChild(bandolier);

        // Mini spears on bandolier
        for (int i = 0; i < 3; i++)
        {
            var miniSpear = new MeshInstance3D();
            var miniSpearMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.02f, Height = 0.25f };
            miniSpear.Mesh = miniSpearMesh;
            miniSpear.MaterialOverride = metalMat;
            miniSpear.Position = new Vector3(-0.08f + i * 0.08f, 0.55f + i * 0.08f, 0.18f);
            miniSpear.RotationDegrees = new Vector3(20, 0, 30);
            parent.AddChild(miniSpear);
        }

        // Head
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.85f, 0);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.2f, Height = 0.4f };
        head.Mesh = headMesh;
        head.MaterialOverride = skinMat;
        headNode.AddChild(head);

        // Eyes
        var eyeMesh = new SphereMesh { Radius = 0.055f, Height = 0.11f };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.07f, 0.02f, 0.15f);
        headNode.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.07f, 0.02f, 0.15f);
        headNode.AddChild(rightEye);

        // Pointy nose
        var nose = new MeshInstance3D();
        var noseMesh = new CylinderMesh { TopRadius = 0.02f, BottomRadius = 0.04f, Height = 0.12f };
        nose.Mesh = noseMesh;
        nose.MaterialOverride = skinMat;
        nose.Position = new Vector3(0, -0.02f, 0.18f);
        nose.RotationDegrees = new Vector3(-70, 0, 0);
        headNode.AddChild(nose);

        // Ears
        var earMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.055f, Height = 0.16f };
        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        leftEar.Position = new Vector3(-0.2f, 0.02f, 0);
        leftEar.RotationDegrees = new Vector3(0, 0, -55);
        headNode.AddChild(leftEar);

        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
        rightEar.Position = new Vector3(0.2f, 0.02f, 0);
        rightEar.RotationDegrees = new Vector3(0, 0, 55);
        headNode.AddChild(rightEar);

        // Headband
        var headband = new MeshInstance3D();
        var hbMesh = new TorusMesh { InnerRadius = 0.16f, OuterRadius = 0.19f };
        headband.Mesh = hbMesh;
        headband.MaterialOverride = clothMat;
        headband.Position = new Vector3(0, 0.08f, 0);
        headband.Scale = new Vector3(1.1f, 0.3f, 1.1f);
        headNode.AddChild(headband);

        // Right arm (throwing arm)
        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.25f, 0.55f, 0);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;

        var armMesh = new CapsuleMesh { Radius = 0.065f, Height = 0.28f };
        var rightArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = skinMat };
        rightArm.RotationDegrees = new Vector3(-20, 0, -35);
        rightArmNode.AddChild(rightArm);

        // Spear in hand
        var weaponNode = new Node3D();
        weaponNode.Position = new Vector3(0.15f, -0.15f, 0.1f);
        rightArmNode.AddChild(weaponNode);
        limbs.Weapon = weaponNode;

        var spear = new MeshInstance3D();
        var spearMesh = new CylinderMesh { TopRadius = 0.015f, BottomRadius = 0.02f, Height = 0.7f };
        spear.Mesh = spearMesh;
        spear.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.4f, 0.3f, 0.2f) };
        spear.RotationDegrees = new Vector3(-60, 0, 0);
        weaponNode.AddChild(spear);

        var spearHead = new MeshInstance3D();
        var shMesh = new CylinderMesh { TopRadius = 0.005f, BottomRadius = 0.04f, Height = 0.12f };
        spearHead.Mesh = shMesh;
        spearHead.MaterialOverride = metalMat;
        spearHead.Position = new Vector3(0, 0.38f, -0.15f);
        spearHead.RotationDegrees = new Vector3(-60, 0, 0);
        weaponNode.AddChild(spearHead);

        // Left arm
        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.25f, 0.55f, 0);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;

        var leftArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = skinMat };
        leftArm.RotationDegrees = new Vector3(0, 0, 25);
        leftArmNode.AddChild(leftArm);

        // Legs
        var legMesh = new CapsuleMesh { Radius = 0.07f, Height = 0.35f };

        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.1f, 0.18f, 0);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;

        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        leftLegNode.AddChild(leftLeg);

        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.1f, 0.18f, 0);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;

        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        rightLegNode.AddChild(rightLeg);
    }

    private static void CreateGoblinWarlordMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride, LODLevel lod = LODLevel.High, float sizeVariation = 1.5f)
    {
        // Warlord is a BOSS goblin - larger, heavily armored, intimidating
        Color baseSkin = skinColorOverride ?? new Color(0.35f, 0.45f, 0.3f); // Dark green
        float hueShift = (GD.Randf() - 0.5f) * 0.05f;
        Color skinColor = baseSkin.Darkened(0.1f + hueShift); // Darker than normal goblins
        Color armorColor = new Color(0.25f, 0.25f, 0.28f); // Dark steel
        Color goldColor = new Color(0.85f, 0.75f, 0.3f); // Gold trim
        Color eyeColor = new Color(1f, 0.2f, 0.1f); // Menacing red eyes

        // LOD-based segment counts
        int radialSegs = GetRadialSegments(lod);
        int rings = GetRings(lod);
        float scale = sizeVariation; // Default 1.5x for boss

        var skinMat = new StandardMaterial3D { AlbedoColor = skinColor, Roughness = 0.8f };
        var darkSkinMat = new StandardMaterial3D { AlbedoColor = skinColor.Darkened(0.2f), Roughness = 0.85f };
        var armorMat = new StandardMaterial3D { AlbedoColor = armorColor, Metallic = 0.7f, Roughness = 0.4f };
        var goldMat = new StandardMaterial3D { AlbedoColor = goldColor, Metallic = 0.8f, Roughness = 0.3f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = eyeColor,
            EmissionEnabled = true,
            Emission = eyeColor * 0.6f
        };

        // Massive muscular body with armor plating
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh { Radius = 0.32f * scale, Height = 0.64f * scale, RadialSegments = radialSegs, Rings = rings };
        body.Mesh = bodyMesh;
        body.MaterialOverride = skinMat;
        body.Position = new Vector3(0, 0.6f * scale, 0);
        body.Scale = new Vector3(1.1f, 1.25f, 0.95f); // Broad-shouldered
        parent.AddChild(body);

        // Chest armor plate
        var chestPlate = new MeshInstance3D();
        var plateMesh = new BoxMesh { Size = new Vector3(0.5f * scale, 0.5f * scale, 0.08f * scale) };
        chestPlate.Mesh = plateMesh;
        chestPlate.MaterialOverride = armorMat;
        chestPlate.Position = new Vector3(0, 0.65f * scale, 0.2f * scale);
        parent.AddChild(chestPlate);

        // Shoulder pauldrons
        var leftPauldron = new MeshInstance3D();
        var pauldronMesh = new SphereMesh { Radius = 0.15f * scale, Height = 0.3f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
        leftPauldron.Mesh = pauldronMesh;
        leftPauldron.MaterialOverride = armorMat;
        leftPauldron.Position = new Vector3(-0.35f * scale, 0.75f * scale, 0.05f * scale);
        leftPauldron.Scale = new Vector3(1f, 0.6f, 1f);
        parent.AddChild(leftPauldron);

        var rightPauldron = new MeshInstance3D { Mesh = pauldronMesh, MaterialOverride = armorMat };
        rightPauldron.Position = new Vector3(0.35f * scale, 0.75f * scale, 0.05f * scale);
        rightPauldron.Scale = new Vector3(1f, 0.6f, 1f);
        parent.AddChild(rightPauldron);

        // Gold trim on pauldrons (High LOD only)
        if (lod == LODLevel.High)
        {
            var leftTrim = new MeshInstance3D();
            var trimMesh = new TorusMesh { InnerRadius = 0.12f * scale, OuterRadius = 0.14f * scale };
            leftTrim.Mesh = trimMesh;
            leftTrim.MaterialOverride = goldMat;
            leftTrim.Position = new Vector3(-0.35f * scale, 0.75f * scale, 0.05f * scale);
            leftTrim.Scale = new Vector3(1f, 0.4f, 1f);
            parent.AddChild(leftTrim);

            var rightTrim = new MeshInstance3D { Mesh = trimMesh, MaterialOverride = goldMat };
            rightTrim.Position = new Vector3(0.35f * scale, 0.75f * scale, 0.05f * scale);
            rightTrim.Scale = new Vector3(1f, 0.4f, 1f);
            parent.AddChild(rightTrim);
        }

        // Large head with intimidating features
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 1.1f * scale, 0.05f * scale);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.24f * scale, Height = 0.48f * scale, RadialSegments = radialSegs, Rings = rings };
        head.Mesh = headMesh;
        head.MaterialOverride = skinMat;
        head.Scale = new Vector3(1.08f, 0.9f, 0.96f);
        headNode.AddChild(head);

        // Heavy helmet with spike
        var helmet = new MeshInstance3D();
        var helmetMesh = new SphereMesh { Radius = 0.26f * scale, Height = 0.35f * scale, RadialSegments = radialSegs, Rings = rings / 2 };
        helmet.Mesh = helmetMesh;
        helmet.MaterialOverride = armorMat;
        helmet.Position = new Vector3(0, 0.1f * scale, 0);
        helmet.Scale = new Vector3(1.1f, 0.7f, 1f);
        headNode.AddChild(helmet);

        // Helmet spike (intimidation factor!)
        var spike = new MeshInstance3D();
        var spikeMesh = new CylinderMesh {
            TopRadius = 0.01f * scale,
            BottomRadius = 0.04f * scale,
            Height = 0.25f * scale,
            RadialSegments = Mathf.Max(8, radialSegs / 4)
        };
        spike.Mesh = spikeMesh;
        spike.MaterialOverride = armorMat;
        spike.Position = new Vector3(0, 0.35f * scale, 0);
        headNode.AddChild(spike);

        // Menacing red eyes (glowing)
        int eyeSegs = lod == LODLevel.High ? radialSegs / 2 : radialSegs / 4;
        var eyeMesh = new SphereMesh { Radius = 0.06f * scale, Height = 0.12f * scale, RadialSegments = eyeSegs, Rings = eyeSegs / 2 };

        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.08f * scale, 0f, 0.2f * scale);
        headNode.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.08f * scale, 0f, 0.2f * scale);
        headNode.AddChild(rightEye);

        // Large pointed ears
        if (lod >= LODLevel.Medium)
        {
            int earSegs = lod == LODLevel.High ? radialSegs / 2 : radialSegs / 4;
            var earMesh = new CylinderMesh {
                TopRadius = 0.015f * scale,
                BottomRadius = 0.07f * scale,
                Height = 0.28f * scale,
                RadialSegments = earSegs,
                Rings = Mathf.Max(4, earSegs / 2)
            };

            var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
            leftEar.Position = new Vector3(-0.24f * scale, -0.02f * scale, -0.05f * scale);
            leftEar.RotationDegrees = new Vector3(15, 25, -60);
            headNode.AddChild(leftEar);

            var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = skinMat };
            rightEar.Position = new Vector3(0.24f * scale, -0.02f * scale, -0.05f * scale);
            rightEar.RotationDegrees = new Vector3(15, -25, 60);
            headNode.AddChild(rightEar);
        }

        // Muscular arms
        int armSegs = lod == LODLevel.High ? radialSegs / 2 : Mathf.Max(8, radialSegs / 4);
        var upperArmMesh = new CapsuleMesh {
            Radius = 0.08f * scale,
            Height = 0.3f * scale,
            RadialSegments = armSegs,
            Rings = Mathf.Max(4, armSegs / 2)
        };
        var lowerArmMesh = new CapsuleMesh {
            Radius = 0.07f * scale,
            Height = 0.28f * scale,
            RadialSegments = armSegs,
            Rings = Mathf.Max(3, armSegs / 3)
        };

        // Right arm with big sword
        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.38f * scale, 0.7f * scale, 0);
        rightArmNode.RotationDegrees = new Vector3(0, 0, 25);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;

        var rightUpperArm = new MeshInstance3D { Mesh = upperArmMesh, MaterialOverride = skinMat };
        rightUpperArm.Position = new Vector3(0, -0.12f * scale, 0);
        rightArmNode.AddChild(rightUpperArm);

        var rightLowerArm = new MeshInstance3D { Mesh = lowerArmMesh, MaterialOverride = skinMat };
        rightLowerArm.Position = new Vector3(0, -0.35f * scale, 0.02f * scale);
        rightLowerArm.RotationDegrees = new Vector3(-20, 0, 0);
        rightArmNode.AddChild(rightLowerArm);

        // Massive sword (warlord weapon)
        var weaponNode = new Node3D();
        weaponNode.Position = new Vector3(0.1f * scale, -0.5f * scale, 0.08f * scale);
        rightArmNode.AddChild(weaponNode);
        limbs.Weapon = weaponNode;

        var swordHandle = new MeshInstance3D();
        var handleMesh = new CylinderMesh {
            TopRadius = 0.035f * scale,
            BottomRadius = 0.035f * scale,
            Height = 0.3f * scale,
            RadialSegments = Mathf.Max(8, armSegs)
        };
        swordHandle.Mesh = handleMesh;
        swordHandle.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.2f, 0.15f, 0.1f), Roughness = 0.8f };
        swordHandle.RotationDegrees = new Vector3(-85, 0, 0);
        weaponNode.AddChild(swordHandle);

        var swordGuard = new MeshInstance3D();
        var guardMesh = new BoxMesh { Size = new Vector3(0.25f * scale, 0.04f * scale, 0.04f * scale) };
        swordGuard.Mesh = guardMesh;
        swordGuard.MaterialOverride = goldMat;
        swordGuard.Position = new Vector3(0, 0.13f, -0.05f);
        swordGuard.RotationDegrees = new Vector3(-85, 0, 0);
        weaponNode.AddChild(swordGuard);

        var swordBlade = new MeshInstance3D();
        var bladeMesh = new BoxMesh { Size = new Vector3(0.1f * scale, 0.8f * scale, 0.02f * scale) };
        swordBlade.Mesh = bladeMesh;
        swordBlade.MaterialOverride = armorMat;
        swordBlade.Position = new Vector3(0, 0.55f, -0.05f);
        swordBlade.RotationDegrees = new Vector3(-85, 0, 0);
        weaponNode.AddChild(swordBlade);

        // Blood notches on blade (High LOD only)
        if (lod == LODLevel.High)
        {
            for (int n = 0; n < 3; n++)
            {
                var notch = new MeshInstance3D();
                var notchMesh = new BoxMesh { Size = new Vector3(0.12f * scale, 0.03f * scale, 0.025f * scale) };
                notch.Mesh = notchMesh;
                notch.MaterialOverride = new StandardMaterial3D { AlbedoColor = new Color(0.4f, 0.15f, 0.1f), Roughness = 0.6f };
                notch.Position = new Vector3(0.06f * scale, 0.3f + n * 0.2f, -0.05f);
                notch.RotationDegrees = new Vector3(-85, 0, 25);
                weaponNode.AddChild(notch);
            }
        }

        // Left arm
        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.38f * scale, 0.7f * scale, 0);
        leftArmNode.RotationDegrees = new Vector3(0, 0, -25);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;

        var leftUpperArm = new MeshInstance3D { Mesh = upperArmMesh, MaterialOverride = skinMat };
        leftUpperArm.Position = new Vector3(0, -0.12f * scale, 0);
        leftArmNode.AddChild(leftUpperArm);

        var leftLowerArm = new MeshInstance3D { Mesh = lowerArmMesh, MaterialOverride = skinMat };
        leftLowerArm.Position = new Vector3(0, -0.35f * scale, 0.02f * scale);
        leftLowerArm.RotationDegrees = new Vector3(-20, 0, 0);
        leftArmNode.AddChild(leftLowerArm);

        // Thick muscular legs
        int legSegs = lod == LODLevel.High ? radialSegs / 2 : Mathf.Max(8, radialSegs / 4);
        var legMesh = new CapsuleMesh {
            Radius = 0.1f * scale,
            Height = 0.4f * scale,
            RadialSegments = legSegs,
            Rings = Mathf.Max(5, legSegs / 2)
        };

        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.15f * scale, 0.3f * scale, 0);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;

        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        leftLegNode.AddChild(leftLeg);

        // Armored boots
        var leftBoot = new MeshInstance3D();
        var bootMesh = new BoxMesh { Size = new Vector3(0.15f * scale, 0.12f * scale, 0.22f * scale) };
        leftBoot.Mesh = bootMesh;
        leftBoot.MaterialOverride = armorMat;
        leftBoot.Position = new Vector3(0, -0.24f * scale, 0.06f * scale);
        leftLegNode.AddChild(leftBoot);

        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.15f * scale, 0.3f * scale, 0);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;

        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = skinMat };
        rightLegNode.AddChild(rightLeg);

        var rightBoot = new MeshInstance3D { Mesh = bootMesh, MaterialOverride = armorMat };
        rightBoot.Position = new Vector3(0, -0.24f * scale, 0.06f * scale);
        rightLegNode.AddChild(rightBoot);
    }

    private static void CreateSlimeMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride)
    {
        Color slimeColor = skinColorOverride ?? new Color(0.3f, 0.8f, 0.4f);
        Color bubbleColor = slimeColor.Lightened(0.3f);
        Color highlightColor = slimeColor.Lightened(0.5f);

        var slimeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(slimeColor.R, slimeColor.G, slimeColor.B, 0.75f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.15f,
            Metallic = 0.15f,
            RimEnabled = true,
            Rim = 0.3f,
            RimTint = 0.2f
        };

        var coreMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(slimeColor.Darkened(0.35f).R, slimeColor.Darkened(0.35f).G, slimeColor.Darkened(0.35f).B, 0.9f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.25f
        };

        var bubbleMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(bubbleColor.R, bubbleColor.G, bubbleColor.B, 0.5f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.1f,
            Metallic = 0.2f
        };

        var highlightMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(highlightColor.R, highlightColor.G, highlightColor.B, 0.4f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.05f
        };

        // Main body - slightly flattened blob with high poly count for organic smoothness
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh { Radius = 0.38f, Height = 0.76f, RadialSegments = 32, Rings = 24 };
        body.Mesh = bodyMesh;
        body.MaterialOverride = slimeMat;
        body.Position = new Vector3(0, 0.38f, 0);
        body.Scale = new Vector3(1.08f, 0.73f, 1.06f); // Slightly asymmetric for organic feel
        parent.AddChild(body);
        limbs.Head = body; // Use body for bobbing animation

        // Outer membrane layer for depth - extra smooth
        var membrane = new MeshInstance3D();
        var membraneMesh = new SphereMesh { Radius = 0.4f, Height = 0.8f, RadialSegments = 32, Rings = 24 };
        membrane.Mesh = membraneMesh;
        var membraneMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(slimeColor.R, slimeColor.G, slimeColor.B, 0.25f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            CullMode = BaseMaterial3D.CullModeEnum.Front, // Render inside
            Roughness = 0.08f,
            Metallic = 0.1f // Add slight sheen for realism
        };
        membrane.MaterialOverride = membraneMat;
        membrane.Position = new Vector3(0, 0.38f, 0);
        membrane.Scale = new Vector3(1.1f, 0.76f, 1.09f);
        parent.AddChild(membrane);

        // Core - nucleus inside the slime with smooth geometry
        var core = new MeshInstance3D();
        var coreMesh = new SphereMesh { Radius = 0.15f, Height = 0.3f, RadialSegments = 24, Rings = 18 };
        core.Mesh = coreMesh;
        core.MaterialOverride = coreMat;
        core.Position = new Vector3(0.01f, 0.33f, -0.01f); // Slightly off-center for organic feel
        core.Scale = new Vector3(1.02f, 0.88f, 0.98f);
        parent.AddChild(core);

        // Inner glow around core - brighter and more visible
        var glow = new MeshInstance3D();
        var glowMesh = new SphereMesh { Radius = 0.2f, Height = 0.4f, RadialSegments = 20, Rings = 16 };
        glow.Mesh = glowMesh;
        var glowMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(slimeColor.R, slimeColor.G, slimeColor.B, 0.35f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            EmissionEnabled = true,
            Emission = slimeColor * 0.25f, // Brighter emission
            BlendMode = BaseMaterial3D.BlendModeEnum.Add
        };
        glow.MaterialOverride = glowMat;
        glow.Position = new Vector3(0.01f, 0.33f, -0.01f);
        parent.AddChild(glow);

        // Bubbles floating inside - more varied and organic
        var bubbleMesh = new SphereMesh { Radius = 0.04f, Height = 0.08f, RadialSegments = 16, Rings = 12 };
        float[] bubbleX = { -0.15f, 0.18f, -0.08f, 0.14f, -0.22f, 0.06f, -0.11f, 0.09f };
        float[] bubbleY = { 0.45f, 0.38f, 0.28f, 0.52f, 0.35f, 0.24f, 0.48f, 0.31f };
        float[] bubbleZ = { 0.1f, -0.08f, 0.15f, 0.05f, -0.12f, -0.1f, 0.08f, -0.15f };
        float[] bubbleScale = { 1.1f, 0.75f, 0.55f, 0.85f, 0.65f, 0.45f, 0.9f, 0.5f };

        for (int i = 0; i < 8; i++) // More bubbles
        {
            var bubble = new MeshInstance3D { Mesh = bubbleMesh, MaterialOverride = bubbleMat };
            bubble.Position = new Vector3(bubbleX[i], bubbleY[i], bubbleZ[i]);
            bubble.Scale = Vector3.One * bubbleScale[i];
            parent.AddChild(bubble);
        }

        // Highlight/shine spots on surface
        var highlightMesh = new SphereMesh { Radius = 0.06f, Height = 0.12f };
        var highlight1 = new MeshInstance3D { Mesh = highlightMesh, MaterialOverride = highlightMat };
        highlight1.Position = new Vector3(-0.18f, 0.55f, 0.22f);
        highlight1.Scale = new Vector3(0.8f, 0.5f, 0.3f);
        parent.AddChild(highlight1);

        var highlight2 = new MeshInstance3D { Mesh = highlightMesh, MaterialOverride = highlightMat };
        highlight2.Position = new Vector3(0.15f, 0.5f, 0.18f);
        highlight2.Scale = new Vector3(0.5f, 0.3f, 0.2f);
        parent.AddChild(highlight2);

        // Drips/tendrils at base
        var dripMesh = new CylinderMesh { TopRadius = 0.02f, BottomRadius = 0.06f, Height = 0.12f };
        float[] dripAngles = { 0f, 72f, 144f, 216f, 288f };
        for (int i = 0; i < 5; i++)
        {
            var drip = new MeshInstance3D { Mesh = dripMesh, MaterialOverride = slimeMat };
            float angle = dripAngles[i] * Mathf.Pi / 180f;
            drip.Position = new Vector3(Mathf.Cos(angle) * 0.28f, 0.08f, Mathf.Sin(angle) * 0.28f);
            drip.RotationDegrees = new Vector3(0, 0, Mathf.Sin(angle * 2) * 15f);
            drip.Scale = new Vector3(1f, 0.6f + (i % 3) * 0.3f, 1f);
            parent.AddChild(drip);
        }

        // Eyes - larger, more expressive with smooth geometry
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = Colors.White,
            EmissionEnabled = true,
            Emission = Colors.White * 0.3f,
            Roughness = 0.2f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };

        var eyeMesh = new SphereMesh { Radius = 0.095f, Height = 0.19f, RadialSegments = 20, Rings = 16 };
        var pupilMesh = new SphereMesh { Radius = 0.048f, Height = 0.096f, RadialSegments = 16, Rings = 12 };

        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.14f, 0.48f, 0.27f);
        leftEye.Scale = new Vector3(0.98f, 1.12f, 0.82f); // Asymmetric for character
        parent.AddChild(leftEye);

        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.14f, 0.48f, 0.34f);
        leftPupil.Scale = new Vector3(1.05f, 0.95f, 1f); // Slightly different
        parent.AddChild(leftPupil);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.13f, 0.48f, 0.27f);
        rightEye.Scale = new Vector3(1.02f, 1.08f, 0.8f); // Slightly different from left
        parent.AddChild(rightEye);

        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.13f, 0.48f, 0.34f);
        rightPupil.Scale = new Vector3(0.95f, 1.05f, 1f);
        parent.AddChild(rightPupil);

        // Small mouth
        var mouthMesh = new SphereMesh { Radius = 0.03f, Height = 0.06f };
        var mouthMat = new StandardMaterial3D { AlbedoColor = slimeColor.Darkened(0.5f) };
        var mouth = new MeshInstance3D { Mesh = mouthMesh, MaterialOverride = mouthMat };
        mouth.Position = new Vector3(0, 0.38f, 0.35f);
        mouth.Scale = new Vector3(1.5f, 0.8f, 0.5f);
        parent.AddChild(mouth);
    }

    private static void CreateSkeletonMesh(Node3D parent, LimbNodes limbs, LODLevel lod = LODLevel.High, float sizeVariation = 1.0f, Color? boneColorOverride = null, float damageLevel = 0.0f)
    {
        // Variation parameters for aged/damaged bones
        float yellowFactor = Mathf.Clamp(damageLevel + (GD.Randf() * 0.2f), 0f, 1f);
        Color baseBoneColor = boneColorOverride ?? new Color(0.9f, 0.88f, 0.8f);
        Color boneColor = baseBoneColor.Lerp(new Color(0.85f, 0.82f, 0.65f), yellowFactor);
        Color darkBone = boneColor.Darkened(0.15f);
        Color toothColor = new Color(0.95f, 0.92f, 0.85f);

        // LOD-based segment counts
        int radialSegs = GetRadialSegments(lod);
        int rings = GetRings(lod);

        var boneMat = new StandardMaterial3D { AlbedoColor = boneColor, Roughness = 0.85f };
        var darkBoneMat = new StandardMaterial3D { AlbedoColor = darkBone, Roughness = 0.9f };
        var toothMat = new StandardMaterial3D { AlbedoColor = toothColor, Roughness = 0.7f };

        // Soul fire in eye sockets - red/orange flames
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.8f, 0.2f, 0.1f),
            EmissionEnabled = true,
            Emission = new Color(1f, 0.3f, 0.1f) * 0.6f
        };

        // Skull
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 1.5f, 0);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        // Main skull
        var skull = new MeshInstance3D();
        var skullMesh = new SphereMesh { Radius = 0.17f, Height = 0.34f };
        skull.Mesh = skullMesh;
        skull.MaterialOverride = boneMat;
        skull.Scale = new Vector3(0.88f, 1f, 0.82f);
        headNode.AddChild(skull);

        // Brow ridge
        var browMesh = new BoxMesh { Size = new Vector3(0.16f, 0.03f, 0.06f) };
        var brow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = boneMat };
        brow.Position = new Vector3(0, 0.06f, 0.1f);
        headNode.AddChild(brow);

        // Cheekbones
        var cheekMesh = new SphereMesh { Radius = 0.04f, Height = 0.08f };
        var leftCheek = new MeshInstance3D { Mesh = cheekMesh, MaterialOverride = boneMat };
        leftCheek.Position = new Vector3(-0.1f, -0.02f, 0.1f);
        leftCheek.Scale = new Vector3(0.8f, 0.6f, 0.5f);
        headNode.AddChild(leftCheek);
        var rightCheek = new MeshInstance3D { Mesh = cheekMesh, MaterialOverride = boneMat };
        rightCheek.Position = new Vector3(0.1f, -0.02f, 0.1f);
        rightCheek.Scale = new Vector3(0.8f, 0.6f, 0.5f);
        headNode.AddChild(rightCheek);

        // Eye sockets (dark recesses)
        var socketMesh = new SphereMesh { Radius = 0.035f, Height = 0.07f };
        var socketMat = new StandardMaterial3D { AlbedoColor = new Color(0.1f, 0.08f, 0.08f) };
        var leftSocketDark = new MeshInstance3D { Mesh = socketMesh, MaterialOverride = socketMat };
        leftSocketDark.Position = new Vector3(-0.055f, 0.02f, 0.11f);
        headNode.AddChild(leftSocketDark);
        var rightSocketDark = new MeshInstance3D { Mesh = socketMesh, MaterialOverride = socketMat };
        rightSocketDark.Position = new Vector3(0.055f, 0.02f, 0.11f);
        headNode.AddChild(rightSocketDark);

        // Glowing eye flames
        var flameMesh = new SphereMesh { Radius = 0.025f, Height = 0.05f };
        var leftFlame = new MeshInstance3D { Mesh = flameMesh, MaterialOverride = eyeMat };
        leftFlame.Position = new Vector3(-0.055f, 0.025f, 0.12f);
        headNode.AddChild(leftFlame);
        var rightFlame = new MeshInstance3D { Mesh = flameMesh, MaterialOverride = eyeMat };
        rightFlame.Position = new Vector3(0.055f, 0.025f, 0.12f);
        headNode.AddChild(rightFlame);

        // Nasal cavity
        var nasalMesh = new CylinderMesh { TopRadius = 0.015f, BottomRadius = 0.025f, Height = 0.04f };
        var nasal = new MeshInstance3D { Mesh = nasalMesh, MaterialOverride = socketMat };
        nasal.Position = new Vector3(0, -0.02f, 0.14f);
        nasal.RotationDegrees = new Vector3(-80, 0, 0);
        headNode.AddChild(nasal);

        // Upper jaw with teeth
        var upperJawMesh = new BoxMesh { Size = new Vector3(0.1f, 0.025f, 0.06f) };
        var upperJaw = new MeshInstance3D { Mesh = upperJawMesh, MaterialOverride = boneMat };
        upperJaw.Position = new Vector3(0, -0.08f, 0.08f);
        headNode.AddChild(upperJaw);

        // Upper teeth
        var toothMesh = new BoxMesh { Size = new Vector3(0.012f, 0.025f, 0.015f) };
        for (int i = 0; i < 6; i++)
        {
            var tooth = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = toothMat };
            tooth.Position = new Vector3(-0.03f + i * 0.012f, -0.1f, 0.085f);
            headNode.AddChild(tooth);
        }

        // Lower jaw (mandible)
        var jawNode = new Node3D();
        jawNode.Position = new Vector3(0, -0.12f, 0.04f);
        headNode.AddChild(jawNode);

        var jawMesh = new BoxMesh { Size = new Vector3(0.1f, 0.03f, 0.07f) };
        var jaw = new MeshInstance3D { Mesh = jawMesh, MaterialOverride = boneMat };
        jaw.Position = new Vector3(0, 0, 0.02f);
        jawNode.AddChild(jaw);

        // Jaw corners (ramus)
        var ramusMesh = new BoxMesh { Size = new Vector3(0.02f, 0.06f, 0.03f) };
        var leftRamus = new MeshInstance3D { Mesh = ramusMesh, MaterialOverride = boneMat };
        leftRamus.Position = new Vector3(-0.055f, 0.03f, -0.01f);
        jawNode.AddChild(leftRamus);
        var rightRamus = new MeshInstance3D { Mesh = ramusMesh, MaterialOverride = boneMat };
        rightRamus.Position = new Vector3(0.055f, 0.03f, -0.01f);
        jawNode.AddChild(rightRamus);

        // Lower teeth
        for (int i = 0; i < 6; i++)
        {
            var tooth = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = toothMat };
            tooth.Position = new Vector3(-0.03f + i * 0.012f, 0.018f, 0.045f);
            jawNode.AddChild(tooth);
        }

        // Neck vertebrae
        var vertebraMesh = new CylinderMesh { TopRadius = 0.025f, BottomRadius = 0.03f, Height = 0.06f };
        for (int i = 0; i < 3; i++)
        {
            var vert = new MeshInstance3D { Mesh = vertebraMesh, MaterialOverride = boneMat };
            vert.Position = new Vector3(0, 1.35f - i * 0.07f, -0.02f);
            parent.AddChild(vert);
        }

        // Spine vertebrae
        var spineVertMesh = new CylinderMesh { TopRadius = 0.028f, BottomRadius = 0.032f, Height = 0.08f };
        for (int i = 0; i < 5; i++)
        {
            var vert = new MeshInstance3D { Mesh = spineVertMesh, MaterialOverride = boneMat };
            vert.Position = new Vector3(0, 1.1f - i * 0.09f, 0);
            parent.AddChild(vert);

            // Spinous process (back spike)
            var processMesh = new CylinderMesh { TopRadius = 0.005f, BottomRadius = 0.01f, Height = 0.04f };
            var process = new MeshInstance3D { Mesh = processMesh, MaterialOverride = boneMat };
            process.Position = new Vector3(0, 1.1f - i * 0.09f, -0.04f);
            process.RotationDegrees = new Vector3(-30, 0, 0);
            parent.AddChild(process);
        }

        // Ribs - curved properly
        for (int i = 0; i < 5; i++)
        {
            float y = 1.12f - i * 0.08f;
            float ribLength = 0.18f - i * 0.015f;
            var ribMesh = new CylinderMesh { TopRadius = 0.012f, BottomRadius = 0.014f, Height = ribLength };

            // Left ribs
            var leftRib1 = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            leftRib1.Position = new Vector3(-0.08f, y, 0.04f);
            leftRib1.RotationDegrees = new Vector3(15, 0, -50);
            parent.AddChild(leftRib1);

            var leftRib2 = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            leftRib2.Position = new Vector3(-0.16f, y - 0.04f, 0.06f);
            leftRib2.RotationDegrees = new Vector3(10, 20, -30);
            parent.AddChild(leftRib2);

            // Right ribs
            var rightRib1 = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            rightRib1.Position = new Vector3(0.08f, y, 0.04f);
            rightRib1.RotationDegrees = new Vector3(15, 0, 50);
            parent.AddChild(rightRib1);

            var rightRib2 = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            rightRib2.Position = new Vector3(0.16f, y - 0.04f, 0.06f);
            rightRib2.RotationDegrees = new Vector3(10, -20, 30);
            parent.AddChild(rightRib2);
        }

        // Sternum
        var sternumMesh = new BoxMesh { Size = new Vector3(0.04f, 0.25f, 0.02f) };
        var sternum = new MeshInstance3D { Mesh = sternumMesh, MaterialOverride = boneMat };
        sternum.Position = new Vector3(0, 0.95f, 0.12f);
        parent.AddChild(sternum);

        // Pelvis - more anatomical
        var pelvisMesh = new SphereMesh { Radius = 0.12f, Height = 0.24f };
        var pelvis = new MeshInstance3D { Mesh = pelvisMesh, MaterialOverride = boneMat };
        pelvis.Position = new Vector3(0, 0.65f, 0);
        pelvis.Scale = new Vector3(1.1f, 0.5f, 0.6f);
        parent.AddChild(pelvis);

        // Hip bones
        var hipMesh = new SphereMesh { Radius = 0.06f, Height = 0.12f };
        var leftHip = new MeshInstance3D { Mesh = hipMesh, MaterialOverride = boneMat };
        leftHip.Position = new Vector3(-0.1f, 0.62f, 0.02f);
        leftHip.Scale = new Vector3(0.8f, 1.2f, 0.6f);
        parent.AddChild(leftHip);
        var rightHip = new MeshInstance3D { Mesh = hipMesh, MaterialOverride = boneMat };
        rightHip.Position = new Vector3(0.1f, 0.62f, 0.02f);
        rightHip.Scale = new Vector3(0.8f, 1.2f, 0.6f);
        parent.AddChild(rightHip);

        // Arms
        CreateSkeletonArm(parent, limbs, boneMat, toothMat, true);
        CreateSkeletonArm(parent, limbs, boneMat, toothMat, false);

        // Legs
        CreateSkeletonLeg(parent, limbs, boneMat, true);
        CreateSkeletonLeg(parent, limbs, boneMat, false);
    }

    private static void CreateSkeletonArm(Node3D parent, LimbNodes limbs, StandardMaterial3D material, StandardMaterial3D fingerMat, bool isLeft)
    {
        float side = isLeft ? -1 : 1;
        var armNode = new Node3D();
        armNode.Position = new Vector3(side * 0.18f, 1.15f, 0);
        parent.AddChild(armNode);

        if (isLeft) limbs.LeftArm = armNode;
        else limbs.RightArm = armNode;

        // Shoulder joint
        var shoulderMesh = new SphereMesh { Radius = 0.03f, Height = 0.06f };
        var shoulder = new MeshInstance3D { Mesh = shoulderMesh, MaterialOverride = material };
        armNode.AddChild(shoulder);

        // Humerus (upper arm)
        var humerusMesh = new CylinderMesh { TopRadius = 0.022f, BottomRadius = 0.018f, Height = 0.22f };
        var humerus = new MeshInstance3D { Mesh = humerusMesh, MaterialOverride = material };
        humerus.Position = new Vector3(0, -0.12f, 0);
        armNode.AddChild(humerus);

        // Elbow joint
        var elbowMesh = new SphereMesh { Radius = 0.022f, Height = 0.044f };
        var elbow = new MeshInstance3D { Mesh = elbowMesh, MaterialOverride = material };
        elbow.Position = new Vector3(0, -0.24f, 0);
        armNode.AddChild(elbow);

        // Radius and Ulna (forearm - two bones)
        var forearmMesh = new CylinderMesh { TopRadius = 0.015f, BottomRadius = 0.012f, Height = 0.2f };
        var radius = new MeshInstance3D { Mesh = forearmMesh, MaterialOverride = material };
        radius.Position = new Vector3(side * 0.01f, -0.36f, 0);
        armNode.AddChild(radius);
        var ulna = new MeshInstance3D { Mesh = forearmMesh, MaterialOverride = material };
        ulna.Position = new Vector3(side * -0.01f, -0.36f, 0.01f);
        armNode.AddChild(ulna);

        // Wrist bones
        var wristMesh = new BoxMesh { Size = new Vector3(0.035f, 0.02f, 0.025f) };
        var wrist = new MeshInstance3D { Mesh = wristMesh, MaterialOverride = material };
        wrist.Position = new Vector3(0, -0.47f, 0);
        armNode.AddChild(wrist);

        // Hand metacarpals
        var metacarpalMesh = new BoxMesh { Size = new Vector3(0.04f, 0.04f, 0.025f) };
        var palm = new MeshInstance3D { Mesh = metacarpalMesh, MaterialOverride = material };
        palm.Position = new Vector3(0, -0.51f, 0);
        armNode.AddChild(palm);

        // Finger bones (phalanges) - 4 fingers
        var phalanxMesh = new CylinderMesh { TopRadius = 0.006f, BottomRadius = 0.008f, Height = 0.04f };
        var tipMesh = new CylinderMesh { TopRadius = 0.004f, BottomRadius = 0.006f, Height = 0.025f };
        for (int f = 0; f < 4; f++)
        {
            float fx = -0.015f + f * 0.01f;
            // Proximal phalanx
            var prox = new MeshInstance3D { Mesh = phalanxMesh, MaterialOverride = fingerMat };
            prox.Position = new Vector3(fx, -0.55f, 0.01f);
            prox.RotationDegrees = new Vector3(-20, 0, 0);
            armNode.AddChild(prox);
            // Distal phalanx
            var dist = new MeshInstance3D { Mesh = tipMesh, MaterialOverride = fingerMat };
            dist.Position = new Vector3(fx, -0.58f, 0.025f);
            dist.RotationDegrees = new Vector3(-35, 0, 0);
            armNode.AddChild(dist);
        }

        // Thumb
        var thumbMesh = new CylinderMesh { TopRadius = 0.007f, BottomRadius = 0.009f, Height = 0.035f };
        var thumb = new MeshInstance3D { Mesh = thumbMesh, MaterialOverride = fingerMat };
        thumb.Position = new Vector3(side * 0.025f, -0.52f, 0.015f);
        thumb.RotationDegrees = new Vector3(-30, side * 40, 0);
        armNode.AddChild(thumb);
    }

    private static void CreateSkeletonLeg(Node3D parent, LimbNodes limbs, StandardMaterial3D material, bool isLeft)
    {
        float side = isLeft ? -1 : 1;
        var legNode = new Node3D();
        legNode.Position = new Vector3(side * 0.08f, 0.58f, 0);
        parent.AddChild(legNode);

        if (isLeft) limbs.LeftLeg = legNode;
        else limbs.RightLeg = legNode;

        // Hip joint
        var hipJointMesh = new SphereMesh { Radius = 0.035f, Height = 0.07f };
        var hipJoint = new MeshInstance3D { Mesh = hipJointMesh, MaterialOverride = material };
        legNode.AddChild(hipJoint);

        // Femur (thigh bone)
        var femurMesh = new CylinderMesh { TopRadius = 0.028f, BottomRadius = 0.022f, Height = 0.28f };
        var femur = new MeshInstance3D { Mesh = femurMesh, MaterialOverride = material };
        femur.Position = new Vector3(0, -0.15f, 0);
        legNode.AddChild(femur);

        // Knee cap (patella)
        var kneeMesh = new SphereMesh { Radius = 0.025f, Height = 0.05f };
        var knee = new MeshInstance3D { Mesh = kneeMesh, MaterialOverride = material };
        knee.Position = new Vector3(0, -0.3f, 0.02f);
        knee.Scale = new Vector3(0.8f, 0.6f, 0.5f);
        legNode.AddChild(knee);

        // Tibia and Fibula (lower leg)
        var tibiaMesh = new CylinderMesh { TopRadius = 0.022f, BottomRadius = 0.018f, Height = 0.26f };
        var tibia = new MeshInstance3D { Mesh = tibiaMesh, MaterialOverride = material };
        tibia.Position = new Vector3(0, -0.45f, 0);
        legNode.AddChild(tibia);

        var fibulaMesh = new CylinderMesh { TopRadius = 0.012f, BottomRadius = 0.01f, Height = 0.24f };
        var fibula = new MeshInstance3D { Mesh = fibulaMesh, MaterialOverride = material };
        fibula.Position = new Vector3(side * 0.02f, -0.44f, -0.01f);
        legNode.AddChild(fibula);

        // Ankle bones
        var ankleMesh = new SphereMesh { Radius = 0.02f, Height = 0.04f };
        var ankle = new MeshInstance3D { Mesh = ankleMesh, MaterialOverride = material };
        ankle.Position = new Vector3(0, -0.58f, 0);
        legNode.AddChild(ankle);

        // Foot bones (tarsals + metatarsals)
        var footMesh = new BoxMesh { Size = new Vector3(0.05f, 0.02f, 0.1f) };
        var foot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = material };
        foot.Position = new Vector3(0, -0.6f, 0.04f);
        legNode.AddChild(foot);

        // Toe bones
        var toeMesh = new CylinderMesh { TopRadius = 0.006f, BottomRadius = 0.008f, Height = 0.03f };
        for (int t = 0; t < 4; t++)
        {
            var toe = new MeshInstance3D { Mesh = toeMesh, MaterialOverride = material };
            toe.Position = new Vector3(-0.015f + t * 0.01f, -0.6f, 0.1f);
            toe.RotationDegrees = new Vector3(-80, 0, 0);
            legNode.AddChild(toe);
        }
    }

    /// <summary>
    /// Create enhanced wolf mesh with LOD support, variation, and animation-ready structure.
    /// Features realistic wolf anatomy with digitigrade legs, elongated snout, and bushy tail.
    /// </summary>
    private static void CreateWolfMesh(Node3D parent, LimbNodes limbs, LODLevel lod = LODLevel.High, float sizeVariation = 1.0f, Color? furColorOverride = null)
    {
        // Variation parameters
        float earSizeVariation = 0.9f + (GD.Randf() * 0.2f); // 0.9-1.1
        float tailBushiness = 0.85f + (GD.Randf() * 0.3f);   // 0.85-1.15

        // Fur color variations (gray-brown wolf)
        Color baseFurColor = furColorOverride ?? new Color(0.5f, 0.45f, 0.4f);
        Color furColor = baseFurColor;
        Color darkFur = furColor.Darkened(0.25f);
        Color lightFur = furColor.Lightened(0.15f);
        Color toothColor = new Color(0.95f, 0.93f, 0.88f);
        Color clawColor = new Color(0.2f, 0.18f, 0.15f);

        // LOD-based segment counts
        int radialSegs = GetRadialSegments(lod);
        int rings = GetRings(lod);

        // Apply size variation
        float scale = sizeVariation;

        var furMat = new StandardMaterial3D { AlbedoColor = baseFurColor, Roughness = 0.95f };
        var darkFurMat = new StandardMaterial3D { AlbedoColor = darkFur, Roughness = 0.9f };
        var lightFurMat = new StandardMaterial3D { AlbedoColor = lightFur, Roughness = 0.95f };
        var noseMat = new StandardMaterial3D { AlbedoColor = new Color(0.12f, 0.1f, 0.08f), Roughness = 0.6f, Metallic = 0.2f }; // Wet nose
        var toothMat = new StandardMaterial3D { AlbedoColor = toothColor, Roughness = 0.7f };
        var clawMat = new StandardMaterial3D { AlbedoColor = clawColor, Roughness = 0.8f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.95f, 0.75f, 0.15f),
            EmissionEnabled = true,
            Emission = new Color(0.95f, 0.7f, 0.1f) * 0.4f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };

        // ===== BODY - Realistic wolf anatomy =====

        // Main body - elongated horizontal capsule tapering from chest to hindquarters
        var body = new MeshInstance3D();
        var bodyMesh = new CapsuleMesh { Radius = 0.23f * scale, Height = 0.75f * scale, RadialSegments = radialSegs, Rings = rings };
        body.Mesh = bodyMesh;
        body.MaterialOverride = furMat;
        body.Position = new Vector3(0, 0.48f * scale, 0);
        body.RotationDegrees = new Vector3(0, 0, 90);
        parent.AddChild(body);

        // Chest/underbelly (lighter colored) - barrel chest
        var chest = new MeshInstance3D();
        var chestMesh = new CapsuleMesh { Radius = 0.15f * scale, Height = 0.4f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
        chest.Mesh = chestMesh;
        chest.MaterialOverride = lightFurMat;
        chest.Position = new Vector3(0, 0.4f * scale, 0.08f * scale);
        chest.RotationDegrees = new Vector3(0, 0, 90);
        parent.AddChild(chest);

        // Muscular shoulder hump (wolves have prominent shoulders)
        var shoulderMesh = new SphereMesh { Radius = 0.12f * scale, Height = 0.24f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
        var shoulder = new MeshInstance3D { Mesh = shoulderMesh, MaterialOverride = furMat };
        shoulder.Position = new Vector3(0, 0.58f * scale, 0.15f * scale);
        shoulder.Scale = new Vector3(1.2f, 0.8f, 0.9f);
        parent.AddChild(shoulder);

        // Narrow waist (wolves taper from chest to hindquarters) - Medium+ LOD
        if (lod >= LODLevel.Medium)
        {
            var waistMesh = new CapsuleMesh { Radius = 0.12f * scale, Height = 0.25f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
            var waist = new MeshInstance3D { Mesh = waistMesh, MaterialOverride = furMat };
            waist.Position = new Vector3(0, 0.46f * scale, -0.25f * scale);
            waist.RotationDegrees = new Vector3(0, 0, 90);
            waist.Scale = new Vector3(0.85f, 1f, 0.9f); // Narrower than chest
            parent.AddChild(waist);
        }

        // Muscular neck
        var neckMesh = new CylinderMesh { TopRadius = 0.1f * scale, BottomRadius = 0.14f * scale, Height = 0.15f * scale, RadialSegments = radialSegs / 2, Rings = rings / 2 };
        var neck = new MeshInstance3D { Mesh = neckMesh, MaterialOverride = furMat };
        neck.Position = new Vector3(0, 0.58f * scale, 0.28f * scale);
        neck.RotationDegrees = new Vector3(-50, 0, 0);
        parent.AddChild(neck);

        // Head
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.62f, 0.38f);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.16f, Height = 0.32f };
        head.Mesh = headMesh;
        head.MaterialOverride = furMat;
        head.Scale = new Vector3(0.88f, 0.9f, 1.05f);
        headNode.AddChild(head);

        // Forehead fur tuft
        var tuftMesh = new CylinderMesh { TopRadius = 0.02f, BottomRadius = 0.08f, Height = 0.08f };
        var tuft = new MeshInstance3D { Mesh = tuftMesh, MaterialOverride = darkFurMat };
        tuft.Position = new Vector3(0, 0.12f, 0.02f);
        tuft.RotationDegrees = new Vector3(20, 0, 0);
        headNode.AddChild(tuft);

        // Cheek fur
        var cheekMesh = new SphereMesh { Radius = 0.06f, Height = 0.12f };
        var leftCheek = new MeshInstance3D { Mesh = cheekMesh, MaterialOverride = lightFurMat };
        leftCheek.Position = new Vector3(-0.1f, -0.02f, 0.08f);
        leftCheek.Scale = new Vector3(0.6f, 0.8f, 0.5f);
        headNode.AddChild(leftCheek);
        var rightCheek = new MeshInstance3D { Mesh = cheekMesh, MaterialOverride = lightFurMat };
        rightCheek.Position = new Vector3(0.1f, -0.02f, 0.08f);
        rightCheek.Scale = new Vector3(0.6f, 0.8f, 0.5f);
        headNode.AddChild(rightCheek);

        // Snout
        var snout = new MeshInstance3D();
        var snoutMesh = new CylinderMesh { TopRadius = 0.05f, BottomRadius = 0.07f, Height = 0.16f };
        snout.Mesh = snoutMesh;
        snout.MaterialOverride = furMat;
        snout.Position = new Vector3(0, -0.04f, 0.16f);
        snout.RotationDegrees = new Vector3(-75, 0, 0);
        headNode.AddChild(snout);

        // Snout top (bridge of nose)
        var bridgeMesh = new BoxMesh { Size = new Vector3(0.06f, 0.03f, 0.12f) };
        var bridge = new MeshInstance3D { Mesh = bridgeMesh, MaterialOverride = darkFurMat };
        bridge.Position = new Vector3(0, 0.02f, 0.18f);
        headNode.AddChild(bridge);

        // Nose (wet, shiny)
        var nose = new MeshInstance3D();
        var noseMesh = new SphereMesh { Radius = 0.035f, Height = 0.07f };
        nose.Mesh = noseMesh;
        nose.MaterialOverride = noseMat;
        nose.Position = new Vector3(0, -0.06f, 0.24f);
        nose.Scale = new Vector3(1.1f, 0.9f, 0.8f);
        headNode.AddChild(nose);

        // Nostrils
        var nostrilMesh = new SphereMesh { Radius = 0.01f, Height = 0.02f };
        var nostrilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };
        var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
        leftNostril.Position = new Vector3(-0.015f, -0.06f, 0.26f);
        headNode.AddChild(leftNostril);
        var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
        rightNostril.Position = new Vector3(0.015f, -0.06f, 0.26f);
        headNode.AddChild(rightNostril);

        // Upper jaw/lip
        var lipMesh = new BoxMesh { Size = new Vector3(0.08f, 0.02f, 0.06f) };
        var upperLip = new MeshInstance3D { Mesh = lipMesh, MaterialOverride = darkFurMat };
        upperLip.Position = new Vector3(0, -0.08f, 0.2f);
        headNode.AddChild(upperLip);

        // Fangs (upper canines)
        var fangMesh = new CylinderMesh { TopRadius = 0.004f, BottomRadius = 0.01f, Height = 0.045f };
        var leftFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = toothMat };
        leftFang.Position = new Vector3(-0.025f, -0.1f, 0.2f);
        leftFang.RotationDegrees = new Vector3(10, 0, 5);
        headNode.AddChild(leftFang);
        var rightFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = toothMat };
        rightFang.Position = new Vector3(0.025f, -0.1f, 0.2f);
        rightFang.RotationDegrees = new Vector3(10, 0, -5);
        headNode.AddChild(rightFang);

        // Lower jaw
        var jawMesh = new BoxMesh { Size = new Vector3(0.06f, 0.025f, 0.08f) };
        var jaw = new MeshInstance3D { Mesh = jawMesh, MaterialOverride = furMat };
        jaw.Position = new Vector3(0, -0.1f, 0.14f);
        headNode.AddChild(jaw);

        // Lower fangs
        var lowerFangMesh = new CylinderMesh { TopRadius = 0.003f, BottomRadius = 0.007f, Height = 0.025f };
        var leftLowerFang = new MeshInstance3D { Mesh = lowerFangMesh, MaterialOverride = toothMat };
        leftLowerFang.Position = new Vector3(-0.018f, -0.085f, 0.18f);
        leftLowerFang.RotationDegrees = new Vector3(-170, 0, 0);
        headNode.AddChild(leftLowerFang);
        var rightLowerFang = new MeshInstance3D { Mesh = lowerFangMesh, MaterialOverride = toothMat };
        rightLowerFang.Position = new Vector3(0.018f, -0.085f, 0.18f);
        rightLowerFang.RotationDegrees = new Vector3(-170, 0, 0);
        headNode.AddChild(rightLowerFang);

        // Eyes with pupils
        var eyeMesh = new SphereMesh { Radius = 0.035f, Height = 0.07f };
        var pupilMesh = new SphereMesh { Radius = 0.015f, Height = 0.03f };

        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.08f, 0.05f, 0.1f);
        headNode.AddChild(leftEye);
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.08f, 0.05f, 0.13f);
        headNode.AddChild(leftPupil);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.08f, 0.05f, 0.1f);
        headNode.AddChild(rightEye);
        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.08f, 0.05f, 0.13f);
        headNode.AddChild(rightPupil);

        // Brow ridge
        var browMesh = new BoxMesh { Size = new Vector3(0.05f, 0.02f, 0.03f) };
        var leftBrow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = darkFurMat };
        leftBrow.Position = new Vector3(-0.07f, 0.08f, 0.09f);
        leftBrow.RotationDegrees = new Vector3(0, 0, 10);
        headNode.AddChild(leftBrow);
        var rightBrow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = darkFurMat };
        rightBrow.Position = new Vector3(0.07f, 0.08f, 0.09f);
        rightBrow.RotationDegrees = new Vector3(0, 0, -10);
        headNode.AddChild(rightBrow);

        // Ears - pointed and alert
        var earMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.05f, Height = 0.12f };
        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = furMat };
        leftEar.Position = new Vector3(-0.09f, 0.16f, -0.02f);
        leftEar.RotationDegrees = new Vector3(10, 0, -20);
        headNode.AddChild(leftEar);
        var innerEarMesh = new CylinderMesh { TopRadius = 0.005f, BottomRadius = 0.025f, Height = 0.06f };
        var leftInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = lightFurMat };
        leftInnerEar.Position = new Vector3(-0.085f, 0.14f, 0.01f);
        leftInnerEar.RotationDegrees = new Vector3(10, 0, -20);
        headNode.AddChild(leftInnerEar);

        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = furMat };
        rightEar.Position = new Vector3(0.09f, 0.16f, -0.02f);
        rightEar.RotationDegrees = new Vector3(10, 0, 20);
        headNode.AddChild(rightEar);
        var rightInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = lightFurMat };
        rightInnerEar.Position = new Vector3(0.085f, 0.14f, 0.01f);
        rightInnerEar.RotationDegrees = new Vector3(10, 0, 20);
        headNode.AddChild(rightInnerEar);

        // Tail - bushy
        var tailBase = new MeshInstance3D();
        var tailBaseMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.07f, Height = 0.2f };
        tailBase.Mesh = tailBaseMesh;
        tailBase.MaterialOverride = furMat;
        tailBase.Position = new Vector3(0, 0.52f, -0.38f);
        tailBase.RotationDegrees = new Vector3(-50, 0, 0);
        parent.AddChild(tailBase);

        var tailTip = new MeshInstance3D();
        var tailTipMesh = new CylinderMesh { TopRadius = 0.015f, BottomRadius = 0.04f, Height = 0.15f };
        tailTip.Mesh = tailTipMesh;
        tailTip.MaterialOverride = darkFurMat;
        tailTip.Position = new Vector3(0, 0.4f, -0.5f);
        tailTip.RotationDegrees = new Vector3(-35, 0, 0);
        parent.AddChild(tailTip);

        // Legs
        CreateWolfLeg(parent, limbs, furMat, lightFurMat, clawMat, true, true);   // Front left
        CreateWolfLeg(parent, limbs, furMat, lightFurMat, clawMat, false, true);  // Front right
        CreateWolfLeg(parent, limbs, furMat, lightFurMat, clawMat, true, false);  // Back left
        CreateWolfLeg(parent, limbs, furMat, lightFurMat, clawMat, false, false); // Back right
    }

    private static void CreateWolfLeg(Node3D parent, LimbNodes limbs, StandardMaterial3D furMat, StandardMaterial3D lightFurMat, StandardMaterial3D clawMat, bool isLeft, bool isFront)
    {
        float side = isLeft ? -1 : 1;
        float front = isFront ? 1 : -1;

        var legNode = new Node3D();
        legNode.Position = new Vector3(side * 0.14f, 0.25f, front * 0.18f);
        parent.AddChild(legNode);

        // Store front legs as arms for animation
        if (isFront)
        {
            if (isLeft) limbs.LeftArm = legNode;
            else limbs.RightArm = legNode;
        }
        else
        {
            if (isLeft) limbs.LeftLeg = legNode;
            else limbs.RightLeg = legNode;
        }

        // Upper leg
        var upperLegMesh = new CylinderMesh { TopRadius = 0.045f, BottomRadius = 0.035f, Height = 0.15f };
        var upperLeg = new MeshInstance3D { Mesh = upperLegMesh, MaterialOverride = furMat };
        upperLeg.Position = new Vector3(0, -0.06f, 0);
        legNode.AddChild(upperLeg);

        // Lower leg
        var lowerLegMesh = new CylinderMesh { TopRadius = 0.032f, BottomRadius = 0.025f, Height = 0.12f };
        var lowerLeg = new MeshInstance3D { Mesh = lowerLegMesh, MaterialOverride = furMat };
        lowerLeg.Position = new Vector3(0, -0.18f, 0);
        legNode.AddChild(lowerLeg);

        // Paw
        var pawMesh = new SphereMesh { Radius = 0.04f, Height = 0.08f };
        var paw = new MeshInstance3D { Mesh = pawMesh, MaterialOverride = lightFurMat };
        paw.Position = new Vector3(0, -0.25f, 0.02f);
        paw.Scale = new Vector3(0.9f, 0.5f, 1.1f);
        legNode.AddChild(paw);

        // Claws
        var clawMesh = new CylinderMesh { TopRadius = 0.003f, BottomRadius = 0.008f, Height = 0.025f };
        for (int c = 0; c < 4; c++)
        {
            var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
            claw.Position = new Vector3(-0.018f + c * 0.012f, -0.27f, 0.045f);
            claw.RotationDegrees = new Vector3(-60, 0, 0);
            legNode.AddChild(claw);
        }
    }

    /// <summary>
    /// Creates an enhanced realistic Bat mesh with LOD support and variation parameters.
    /// Features membranous wings with finger bones, large ears, furry body.
    /// </summary>
    /// <param name="parent">Parent node</param>
    /// <param name="limbs">Limb nodes for animation</param>
    /// <param name="lodLevel">Level of detail: 0=High (full detail), 1=Medium (simplified), 2=Low (silhouette)</param>
    /// <param name="sizeVariation">Overall size multiplier (0.8-1.2)</param>
    /// <param name="wingSpanVariation">Wing span multiplier (0.8-1.3)</param>
    /// <param name="furColorType">Fur color: 0=Brown, 1=Black, 2=Gray, 3=Dark Purple</param>
    private static void CreateBatMesh(Node3D parent, LimbNodes limbs, int lodLevel = 0, float sizeVariation = 1.0f, float wingSpanVariation = 1.0f, int furColorType = 0)
    {
        // Fur color variations
        Color bodyColor = furColorType switch
        {
            1 => new Color(0.12f, 0.10f, 0.12f), // Black
            2 => new Color(0.28f, 0.26f, 0.28f), // Gray
            3 => new Color(0.22f, 0.15f, 0.25f), // Dark Purple
            _ => new Color(0.22f, 0.18f, 0.22f)  // Brown (default)
        };
        Color wingColor = bodyColor.Darkened(0.2f);
        Color earInnerColor = new Color(0.4f, 0.25f, 0.3f);
        Color fangColor = new Color(0.95f, 0.93f, 0.88f);

        var bodyMat = new StandardMaterial3D { AlbedoColor = bodyColor, Roughness = 0.9f };
        var wingMat = new StandardMaterial3D
        {
            AlbedoColor = wingColor,
            Roughness = 0.6f,
            CullMode = BaseMaterial3D.CullModeEnum.Disabled
        };
        var earInnerMat = new StandardMaterial3D { AlbedoColor = earInnerColor, Roughness = 0.7f };
        var fangMat = new StandardMaterial3D { AlbedoColor = fangColor, Roughness = 0.5f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(1f, 0.25f, 0.15f),
            EmissionEnabled = true,
            Emission = new Color(1f, 0.2f, 0.1f) * 0.6f
        };

        // Apply size variation
        float baseSize = sizeVariation;
        float wingSpan = wingSpanVariation;

        // Body (small furry ball) - adjusted for size variation
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh
        {
            Radius = 0.13f * baseSize,
            Height = 0.26f * baseSize,
            RadialSegments = lodLevel == 2 ? 8 : (lodLevel == 1 ? 16 : 32),
            Rings = lodLevel == 2 ? 4 : (lodLevel == 1 ? 8 : 16)
        };
        body.Mesh = bodyMesh;
        body.MaterialOverride = bodyMat;
        body.Position = new Vector3(0, 0.78f * baseSize, 0);
        body.Scale = new Vector3(0.95f, 1.15f, 0.85f);
        parent.AddChild(body);

        // Belly (lighter) - skip on low LOD
        if (lodLevel < 2)
        {
            var bellyMat = new StandardMaterial3D { AlbedoColor = bodyColor.Lightened(0.1f), Roughness = 0.9f };
            var bellyMesh = new SphereMesh
            {
                Radius = 0.08f * baseSize,
                Height = 0.16f * baseSize,
                RadialSegments = lodLevel == 1 ? 12 : 24
            };
            var belly = new MeshInstance3D { Mesh = bellyMesh, MaterialOverride = bellyMat };
            belly.Position = new Vector3(0, 0.72f * baseSize, 0.06f * baseSize);
            parent.AddChild(belly);
        }

        // Head - animation-ready node
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.92f * baseSize, 0.06f * baseSize);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh
        {
            Radius = 0.09f * baseSize,
            Height = 0.18f * baseSize,
            RadialSegments = lodLevel == 2 ? 8 : (lodLevel == 1 ? 16 : 32)
        };
        head.Mesh = headMesh;
        head.MaterialOverride = bodyMat;
        head.Scale = new Vector3(1f, 0.95f, 0.9f);
        headNode.AddChild(head);

        // Facial features - skip fine details on low LOD
        if (lodLevel < 2)
        {
            // Snout/nose
            var snoutMesh = new SphereMesh
            {
                Radius = 0.035f * baseSize,
                Height = 0.07f * baseSize,
                RadialSegments = lodLevel == 1 ? 8 : 16
            };
            var snout = new MeshInstance3D { Mesh = snoutMesh, MaterialOverride = bodyMat };
            snout.Position = new Vector3(0, -0.02f * baseSize, 0.07f * baseSize);
            snout.Scale = new Vector3(0.8f, 0.6f, 0.9f);
            headNode.AddChild(snout);

            // Nose leaf (bat has upturned nose) - high LOD only
            if (lodLevel == 0)
            {
                var noseLeafMesh = new CylinderMesh
                {
                    TopRadius = 0.02f * baseSize,
                    BottomRadius = 0.008f * baseSize,
                    Height = 0.03f * baseSize
                };
                var noseLeaf = new MeshInstance3D { Mesh = noseLeafMesh, MaterialOverride = earInnerMat };
                noseLeaf.Position = new Vector3(0, 0.01f * baseSize, 0.1f * baseSize);
                noseLeaf.RotationDegrees = new Vector3(-60, 0, 0);
                headNode.AddChild(noseLeaf);

                // Nostrils - high LOD only
                var nostrilMesh = new SphereMesh { Radius = 0.008f * baseSize, Height = 0.016f * baseSize };
                var nostrilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };
                var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
                leftNostril.Position = new Vector3(-0.012f * baseSize, -0.01f * baseSize, 0.1f * baseSize);
                headNode.AddChild(leftNostril);
                var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
                rightNostril.Position = new Vector3(0.012f * baseSize, -0.01f * baseSize, 0.1f * baseSize);
                headNode.AddChild(rightNostril);
            }

            // Mouth
            var mouthMesh = new BoxMesh { Size = new Vector3(0.04f * baseSize, 0.01f * baseSize, 0.02f * baseSize) };
            var mouthMat = new StandardMaterial3D { AlbedoColor = new Color(0.15f, 0.08f, 0.1f) };
            var mouth = new MeshInstance3D { Mesh = mouthMesh, MaterialOverride = mouthMat };
            mouth.Position = new Vector3(0, -0.04f * baseSize, 0.08f * baseSize);
            headNode.AddChild(mouth);

            // Fangs
            var fangMesh = new CylinderMesh
            {
                TopRadius = 0.002f * baseSize,
                BottomRadius = 0.006f * baseSize,
                Height = 0.025f * baseSize
            };
            var leftFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = fangMat };
            leftFang.Position = new Vector3(-0.012f * baseSize, -0.05f * baseSize, 0.08f * baseSize);
            leftFang.RotationDegrees = new Vector3(5, 0, 3);
            headNode.AddChild(leftFang);
            var rightFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = fangMat };
            rightFang.Position = new Vector3(0.012f * baseSize, -0.05f * baseSize, 0.08f * baseSize);
            rightFang.RotationDegrees = new Vector3(5, 0, -3);
            headNode.AddChild(rightFang);
        }

        // Big ears (distinctive bat feature) - ANIMATION-READY with separate nodes for twitching
        // Left Ear Node (for animation control)
        var leftEarNode = new Node3D();
        leftEarNode.Position = new Vector3(-0.06f * baseSize, 0.12f * baseSize, -0.02f * baseSize);
        leftEarNode.RotationDegrees = new Vector3(10, 0, -25);
        headNode.AddChild(leftEarNode);

        // Left ear mesh
        var earMesh = new CylinderMesh
        {
            TopRadius = 0.01f * baseSize,
            BottomRadius = 0.045f * baseSize,
            Height = 0.14f * baseSize,
            RadialSegments = lodLevel == 2 ? 6 : (lodLevel == 1 ? 8 : 12)
        };
        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = bodyMat };
        leftEarNode.AddChild(leftEar);

        // Left inner ear - skip on low LOD
        if (lodLevel < 2)
        {
            var innerEarMesh = new CylinderMesh
            {
                TopRadius = 0.005f * baseSize,
                BottomRadius = 0.025f * baseSize,
                Height = 0.08f * baseSize,
                RadialSegments = lodLevel == 1 ? 6 : 10
            };
            var leftInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = earInnerMat };
            leftInnerEar.Position = new Vector3(0.005f * baseSize, -0.02f * baseSize, 0.03f * baseSize);
            leftEarNode.AddChild(leftInnerEar);
        }

        // Right Ear Node (for animation control)
        var rightEarNode = new Node3D();
        rightEarNode.Position = new Vector3(0.06f * baseSize, 0.12f * baseSize, -0.02f * baseSize);
        rightEarNode.RotationDegrees = new Vector3(10, 0, 25);
        headNode.AddChild(rightEarNode);

        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = bodyMat };
        rightEarNode.AddChild(rightEar);

        // Right inner ear - skip on low LOD
        if (lodLevel < 2)
        {
            var innerEarMesh = new CylinderMesh
            {
                TopRadius = 0.005f * baseSize,
                BottomRadius = 0.025f * baseSize,
                Height = 0.08f * baseSize,
                RadialSegments = lodLevel == 1 ? 6 : 10
            };
            var rightInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = earInnerMat };
            rightInnerEar.Position = new Vector3(-0.005f * baseSize, -0.02f * baseSize, 0.03f * baseSize);
            rightEarNode.AddChild(rightInnerEar);
        }

        // Glowing red eyes
        var eyeMesh = new SphereMesh
        {
            Radius = 0.022f * baseSize,
            Height = 0.044f * baseSize,
            RadialSegments = lodLevel == 2 ? 6 : (lodLevel == 1 ? 10 : 16)
        };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.035f * baseSize, 0.02f * baseSize, 0.06f * baseSize);
        headNode.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.035f * baseSize, 0.02f * baseSize, 0.06f * baseSize);
        headNode.AddChild(rightEye);

        // Wings with membrane and finger bones - ANIMATION-READY for flapping
        var leftWing = new Node3D();
        leftWing.Position = new Vector3(-0.12f * baseSize, 0.78f * baseSize, 0);
        parent.AddChild(leftWing);
        limbs.LeftArm = leftWing;

        // Wing arm bone (humerus)
        var wingBoneMesh = new CylinderMesh
        {
            TopRadius = 0.012f * baseSize,
            BottomRadius = 0.008f * baseSize,
            Height = 0.15f * baseSize,
            RadialSegments = lodLevel == 2 ? 4 : (lodLevel == 1 ? 6 : 8)
        };
        var leftWingArm = new MeshInstance3D { Mesh = wingBoneMesh, MaterialOverride = bodyMat };
        leftWingArm.Position = new Vector3(-0.07f * baseSize * wingSpan, 0, 0);
        leftWingArm.RotationDegrees = new Vector3(0, 0, 70);
        leftWing.AddChild(leftWingArm);

        // Wing finger bones (phalanges) - variable count based on LOD
        int fingerCount = lodLevel == 2 ? 2 : 4;
        if (lodLevel < 2)
        {
            var fingerBoneMesh = new CylinderMesh
            {
                TopRadius = 0.006f * baseSize,
                BottomRadius = 0.004f * baseSize,
                Height = 0.18f * baseSize,
                RadialSegments = lodLevel == 1 ? 4 : 6
            };
            for (int f = 0; f < fingerCount; f++)
            {
                var finger = new MeshInstance3D { Mesh = fingerBoneMesh, MaterialOverride = bodyMat };
                finger.Position = new Vector3(
                    (-0.15f - f * 0.03f) * baseSize * wingSpan,
                    (0.02f - f * 0.015f) * baseSize,
                    (-0.06f + f * 0.04f) * baseSize * wingSpan
                );
                finger.RotationDegrees = new Vector3(0, -15 + f * 10, 80 - f * 5);
                leftWing.AddChild(finger);
            }
        }

        // Wing membrane - enhanced with better shape
        if (lodLevel == 2)
        {
            // Low LOD - simple triangle
            var simpleMembrane = new MeshInstance3D { MaterialOverride = wingMat };
            var st = new SurfaceTool();
            st.Begin(Mesh.PrimitiveType.Triangles);
            st.SetNormal(Vector3.Up);
            st.AddVertex(new Vector3(0, 0, 0));
            st.AddVertex(new Vector3(-0.25f * baseSize * wingSpan, 0.05f * baseSize, -0.1f * baseSize * wingSpan));
            st.AddVertex(new Vector3(-0.25f * baseSize * wingSpan, -0.05f * baseSize, 0.1f * baseSize * wingSpan));
            st.GenerateNormals();
            simpleMembrane.Mesh = st.Commit();
            leftWing.AddChild(simpleMembrane);
        }
        else
        {
            // Medium/High LOD - detailed membrane
            var membraneMesh = new BoxMesh
            {
                Size = new Vector3(0.28f * baseSize * wingSpan, 0.008f * baseSize, 0.22f * baseSize * wingSpan)
            };
            var leftMembrane = new MeshInstance3D { Mesh = membraneMesh, MaterialOverride = wingMat };
            leftMembrane.Position = new Vector3(-0.18f * baseSize * wingSpan, 0, 0);
            leftMembrane.RotationDegrees = new Vector3(0, -10, 20);
            leftWing.AddChild(leftMembrane);
        }

        // Right wing - mirror of left wing
        var rightWing = new Node3D();
        rightWing.Position = new Vector3(0.12f * baseSize, 0.78f * baseSize, 0);
        parent.AddChild(rightWing);
        limbs.RightArm = rightWing;

        // Right wing arm bone
        var rightWingArm = new MeshInstance3D { Mesh = wingBoneMesh, MaterialOverride = bodyMat };
        rightWingArm.Position = new Vector3(0.07f * baseSize * wingSpan, 0, 0);
        rightWingArm.RotationDegrees = new Vector3(0, 0, -70);
        rightWing.AddChild(rightWingArm);

        // Right wing finger bones
        if (lodLevel < 2)
        {
            var fingerBoneMesh = new CylinderMesh
            {
                TopRadius = 0.006f * baseSize,
                BottomRadius = 0.004f * baseSize,
                Height = 0.18f * baseSize,
                RadialSegments = lodLevel == 1 ? 4 : 6
            };
            for (int f = 0; f < fingerCount; f++)
            {
                var finger = new MeshInstance3D { Mesh = fingerBoneMesh, MaterialOverride = bodyMat };
                finger.Position = new Vector3(
                    (0.15f + f * 0.03f) * baseSize * wingSpan,
                    (0.02f - f * 0.015f) * baseSize,
                    (-0.06f + f * 0.04f) * baseSize * wingSpan
                );
                finger.RotationDegrees = new Vector3(0, 15 - f * 10, -80 + f * 5);
                rightWing.AddChild(finger);
            }
        }

        // Right wing membrane
        if (lodLevel == 2)
        {
            // Low LOD - simple triangle
            var simpleMembrane = new MeshInstance3D { MaterialOverride = wingMat };
            var st = new SurfaceTool();
            st.Begin(Mesh.PrimitiveType.Triangles);
            st.SetNormal(Vector3.Up);
            st.AddVertex(new Vector3(0, 0, 0));
            st.AddVertex(new Vector3(0.25f * baseSize * wingSpan, 0.05f * baseSize, -0.1f * baseSize * wingSpan));
            st.AddVertex(new Vector3(0.25f * baseSize * wingSpan, -0.05f * baseSize, 0.1f * baseSize * wingSpan));
            st.GenerateNormals();
            simpleMembrane.Mesh = st.Commit();
            rightWing.AddChild(simpleMembrane);
        }
        else
        {
            // Medium/High LOD - detailed membrane
            var membraneMesh = new BoxMesh
            {
                Size = new Vector3(0.28f * baseSize * wingSpan, 0.008f * baseSize, 0.22f * baseSize * wingSpan)
            };
            var rightMembrane = new MeshInstance3D { Mesh = membraneMesh, MaterialOverride = wingMat };
            rightMembrane.Position = new Vector3(0.18f * baseSize * wingSpan, 0, 0);
            rightMembrane.RotationDegrees = new Vector3(0, 10, -20);
            rightWing.AddChild(rightMembrane);
        }

        // Tiny legs with claws - skip claws on low LOD
        var legMesh = new CylinderMesh
        {
            TopRadius = 0.012f * baseSize,
            BottomRadius = 0.008f * baseSize,
            Height = 0.08f * baseSize,
            RadialSegments = lodLevel == 2 ? 4 : (lodLevel == 1 ? 6 : 8)
        };
        var clawMesh = new CylinderMesh
        {
            TopRadius = 0.002f * baseSize,
            BottomRadius = 0.005f * baseSize,
            Height = 0.02f * baseSize,
            RadialSegments = lodLevel == 1 ? 4 : 6
        };
        var clawMat = new StandardMaterial3D { AlbedoColor = new Color(0.15f, 0.12f, 0.1f) };

        // Left leg
        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.04f * baseSize, 0.62f * baseSize, 0);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;
        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = bodyMat };
        leftLegNode.AddChild(leftLeg);

        // Claws - skip on low LOD
        if (lodLevel < 2)
        {
            for (int c = 0; c < 3; c++)
            {
                var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
                claw.Position = new Vector3((-0.01f + c * 0.01f) * baseSize, -0.05f * baseSize, 0);
                claw.RotationDegrees = new Vector3(0, 0, -10 + c * 10);
                leftLegNode.AddChild(claw);
            }
        }

        // Right leg
        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.04f * baseSize, 0.62f * baseSize, 0);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;
        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = bodyMat };
        rightLegNode.AddChild(rightLeg);

        // Claws - skip on low LOD
        if (lodLevel < 2)
        {
            for (int c = 0; c < 3; c++)
            {
                var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
                claw.Position = new Vector3((-0.01f + c * 0.01f) * baseSize, -0.05f * baseSize, 0);
                claw.RotationDegrees = new Vector3(0, 0, -10 + c * 10);
                rightLegNode.AddChild(claw);
            }
        }
    }

    /// <summary>
    /// Creates an enhanced majestic Dragon mesh with LOD support and variation parameters.
    /// Features serpentine neck chain, articulated wings, segmented tail for animation.
    /// </summary>
    /// <param name="parent">Parent node</param>
    /// <param name="limbs">Limb nodes for animation</param>
    /// <param name="lodLevel">Level of detail: 0=High (full detail), 1=Medium (simplified), 2=Low (silhouette)</param>
    /// <param name="scaleColorType">Scale color type: 0=Red, 1=Black, 2=Green, 3=Blue, 4=Gold</param>
    /// <param name="hornStyle">Horn style: 0=Curved, 1=Straight, 2=Branching</param>
    /// <param name="wingSpan">Wing span multiplier (0.8-1.5)</param>
    /// <param name="tailStyle">Tail style: 0=Spade, 1=Spikes, 2=Plain</param>
    /// <param name="sizeScale">Overall size multiplier (default 1.5x enemy size, 2-3x for bosses)</param>
    /// <param name="bossPresence">Enable boss-level effects (chest glow, smoke, etc.)</param>
    private static void CreateDragonMesh(Node3D parent, LimbNodes limbs, int lodLevel = 0,
        int scaleColorType = 0, int hornStyle = 0, float wingSpan = 1.0f, int tailStyle = 1,
        float sizeScale = 1.5f, bool bossPresence = false)
    {
        // Scale color variations
        Color scaleColor = scaleColorType switch
        {
            1 => new Color(0.15f, 0.15f, 0.18f), // Black dragon
            2 => new Color(0.2f, 0.5f, 0.15f),   // Green dragon
            3 => new Color(0.15f, 0.3f, 0.6f),   // Blue dragon
            4 => new Color(0.8f, 0.65f, 0.2f),   // Gold dragon
            _ => new Color(0.7f, 0.2f, 0.15f)    // Red dragon (default)
        };

        Color bellyColor = scaleColorType == 4 ?
            new Color(0.95f, 0.85f, 0.5f) : // Gold belly for gold dragon
            new Color(0.9f, 0.7f, 0.4f);
        Color wingColor = scaleColor.Darkened(0.2f);
        Color hornColor = scaleColor.Darkened(0.3f);
        Color clawColor = new Color(0.2f, 0.15f, 0.12f);

        // Glow colors based on scale type
        Color glowColor = scaleColorType switch
        {
            1 => new Color(0.6f, 0.2f, 0.8f),  // Black = purple fire
            2 => new Color(0.2f, 0.8f, 0.2f),  // Green = poison fire
            3 => new Color(0.3f, 0.5f, 1.0f),  // Blue = ice/lightning
            4 => new Color(1.0f, 0.9f, 0.4f),  // Gold = divine fire
            _ => new Color(1.0f, 0.6f, 0.1f)   // Red = classic fire
        };

        // Materials
        var scaleMat = new StandardMaterial3D
        {
            AlbedoColor = scaleColor,
            Roughness = 0.6f,
            Metallic = scaleColorType == 4 ? 0.5f : 0.2f // Gold is more metallic
        };
        var bellyMat = new StandardMaterial3D { AlbedoColor = bellyColor, Roughness = 0.7f };
        var hornMat = new StandardMaterial3D { AlbedoColor = hornColor, Roughness = 0.5f, Metallic = 0.1f };
        var clawMat = new StandardMaterial3D { AlbedoColor = clawColor, Roughness = 0.6f };
        var wingMat = new StandardMaterial3D
        {
            AlbedoColor = wingColor,
            CullMode = BaseMaterial3D.CullModeEnum.Disabled,
            Transparency = lodLevel == 2 ? BaseMaterial3D.TransparencyEnum.Alpha : BaseMaterial3D.TransparencyEnum.Disabled
        };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(1f, 0.8f, 0.2f),
            EmissionEnabled = true,
            Emission = glowColor * (bossPresence ? 0.8f : 0.6f)
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };
        var toothMat = new StandardMaterial3D { AlbedoColor = new Color(0.95f, 0.93f, 0.85f), Roughness = 0.5f };

        // Chest glow material for boss presence (fire within)
        var chestGlowMat = new StandardMaterial3D
        {
            AlbedoColor = glowColor,
            EmissionEnabled = true,
            Emission = glowColor * 1.2f,
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha
        };

        float scale = sizeScale; // Default 1.5x, 2-3x for bosses

        // LOD-based mesh quality
        int bodySegments = lodLevel == 0 ? 24 : (lodLevel == 1 ? 16 : 8);
        int bodyRings = lodLevel == 0 ? 12 : (lodLevel == 1 ? 8 : 4);
        int headSegments = lodLevel == 0 ? 28 : (lodLevel == 1 ? 16 : 10);
        int headRings = lodLevel == 0 ? 20 : (lodLevel == 1 ? 12 : 8);
        int hornSegments = lodLevel == 0 ? 16 : (lodLevel == 1 ? 10 : 6);
        int spineCount = lodLevel == 0 ? 8 : (lodLevel == 1 ? 5 : 0);
        int neckSpineCount = lodLevel == 0 ? 3 : (lodLevel == 1 ? 2 : 0);
        int wingFingers = lodLevel == 0 ? 4 : (lodLevel == 1 ? 3 : 0);
        int neckSegments = lodLevel == 0 ? 3 : (lodLevel == 1 ? 2 : 1);
        int tailSegments = lodLevel == 0 ? 5 : (lodLevel == 1 ? 3 : 1);

        // === BODY ===
        var body = new MeshInstance3D();
        var bodyMesh = new CapsuleMesh {
            Radius = 0.34f * scale,
            Height = 0.98f * scale,
            RadialSegments = bodySegments,
            Rings = bodyRings
        };
        body.Mesh = bodyMesh;
        body.MaterialOverride = scaleMat;
        body.Position = new Vector3(0, 0.7f * scale, 0);
        body.RotationDegrees = new Vector3(0, 0, 90);
        body.Scale = new Vector3(1f, 1f, 1.02f);
        parent.AddChild(body);

        // Belly - vulnerable underbelly
        if (lodLevel < 2)
        {
            var belly = new MeshInstance3D();
            var bellyMesh = new CapsuleMesh {
                Radius = 0.25f * scale,
                Height = 0.58f * scale,
                RadialSegments = bodySegments - 4,
                Rings = bodyRings - 2
            };
            belly.Mesh = bellyMesh;
            belly.MaterialOverride = bellyMat;
            belly.Position = new Vector3(0, 0.55f * scale, 0.13f * scale);
            belly.RotationDegrees = new Vector3(0, 0, 90);
            parent.AddChild(belly);

            // Boss presence: Glowing chest (fire within)
            if (bossPresence)
            {
                var chestGlow = new MeshInstance3D();
                var glowMesh = new SphereMesh { Radius = 0.12f * scale, Height = 0.24f * scale };
                chestGlow.Mesh = glowMesh;
                chestGlow.MaterialOverride = chestGlowMat;
                chestGlow.Position = new Vector3(0, 0.65f * scale, 0.18f * scale);
                parent.AddChild(chestGlow);

                // Pulsing light from chest
                var chestLight = new OmniLight3D();
                chestLight.LightColor = glowColor;
                chestLight.LightEnergy = 0.8f;
                chestLight.OmniRange = 4f * scale;
                chestLight.Position = new Vector3(0, 0.65f * scale, 0.18f * scale);
                parent.AddChild(chestLight);
            }
        }

        // Back spines - scale ridges
        if (lodLevel < 2 && spineCount > 0)
        {
            var spineMesh = new CylinderMesh {
                TopRadius = 0.005f * scale,
                BottomRadius = 0.025f * scale,
                Height = 0.12f * scale
            };
            for (int i = 0; i < spineCount; i++)
            {
                var spine = new MeshInstance3D { Mesh = spineMesh, MaterialOverride = hornMat };
                float zPos = 0.35f - i * 0.11f;
                spine.Position = new Vector3(0, 0.92f * scale - i * 0.03f * scale, zPos * scale);
                spine.RotationDegrees = new Vector3(-15 - i * 3, 0, 0);
                parent.AddChild(spine);
            }
        }

        // === SERPENTINE NECK (Animation Chain) ===
        var neckChain = new Node3D();
        neckChain.Position = new Vector3(0, 0.95f * scale, 0.3f * scale);
        parent.AddChild(neckChain);

        Vector3 neckPos = Vector3.Zero;
        float neckAngle = -25f;
        Node3D previousNeckSegment = neckChain;

        for (int i = 0; i < neckSegments; i++)
        {
            var neckSegNode = new Node3D();
            neckSegNode.Position = neckPos;
            neckSegNode.RotationDegrees = new Vector3(neckAngle, 0, 0);
            previousNeckSegment.AddChild(neckSegNode);

            var neckSeg = new MeshInstance3D();
            var neckMesh = new CylinderMesh {
                TopRadius = (0.11f - i * 0.02f) * scale,
                BottomRadius = (0.17f - i * 0.02f) * scale,
                Height = 0.22f * scale
            };
            neckSeg.Mesh = neckMesh;
            neckSeg.MaterialOverride = scaleMat;
            neckSeg.Position = new Vector3(0, 0.11f * scale, 0);
            neckSegNode.AddChild(neckSeg);

            // Neck spines on each segment
            if (lodLevel == 0 && neckSpineCount > 0 && i < neckSegments - 1)
            {
                var spineMesh = new CylinderMesh {
                    TopRadius = 0.004f * scale,
                    BottomRadius = 0.02f * scale,
                    Height = 0.1f * scale
                };
                var neckSpine = new MeshInstance3D { Mesh = spineMesh, MaterialOverride = hornMat };
                neckSpine.Position = new Vector3(0, 0.16f * scale, -0.03f * scale);
                neckSpine.RotationDegrees = new Vector3(-15, 0, 0);
                neckSegNode.AddChild(neckSpine);
            }

            neckPos = new Vector3(0, 0.22f * scale, 0);
            neckAngle = -8f + i * 2f;
            previousNeckSegment = neckSegNode;
        }

        // === HEAD (Animation Node) ===
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.15f * scale, 0);
        previousNeckSegment.AddChild(headNode);
        limbs.Head = headNode;

        // Head mesh
        var head = new MeshInstance3D();
        var headMesh = new SphereMesh {
            Radius = 0.18f * scale,
            Height = 0.36f * scale,
            RadialSegments = headSegments,
            Rings = headRings
        };
        head.Mesh = headMesh;
        head.MaterialOverride = scaleMat;
        head.Scale = new Vector3(0.86f, 0.76f, 1.18f); // Elongated dragon skull
        headNode.AddChild(head);

        // Head crest (dorsal ridge)
        if (lodLevel < 2)
        {
            var crestMesh = new BoxMesh { Size = new Vector3(0.12f * scale, 0.04f * scale, 0.1f * scale) };
            var crest = new MeshInstance3D { Mesh = crestMesh, MaterialOverride = scaleMat };
            crest.Position = new Vector3(0, 0.12f * scale, -0.05f * scale);
            crest.RotationDegrees = new Vector3(10, 0, 0);
            headNode.AddChild(crest);

            // Brow ridges
            var browMesh = new BoxMesh { Size = new Vector3(0.08f * scale, 0.025f * scale, 0.04f * scale) };
            var leftBrow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = scaleMat };
            leftBrow.Position = new Vector3(-0.08f * scale, 0.08f * scale, 0.08f * scale);
            leftBrow.RotationDegrees = new Vector3(0, 0, 15);
            headNode.AddChild(leftBrow);
            var rightBrow = new MeshInstance3D { Mesh = browMesh, MaterialOverride = scaleMat };
            rightBrow.Position = new Vector3(0.08f * scale, 0.08f * scale, 0.08f * scale);
            rightBrow.RotationDegrees = new Vector3(0, 0, -15);
            headNode.AddChild(rightBrow);
        }

        // Long snout
        var snout = new MeshInstance3D();
        var snoutMesh = new CylinderMesh {
            TopRadius = 0.055f * scale,
            BottomRadius = 0.09f * scale,
            Height = 0.22f * scale
        };
        snout.Mesh = snoutMesh;
        snout.MaterialOverride = scaleMat;
        snout.Position = new Vector3(0, -0.02f * scale, 0.18f * scale);
        snout.RotationDegrees = new Vector3(-72, 0, 0);
        headNode.AddChild(snout);

        // Nostrils
        if (lodLevel < 2)
        {
            var nostrilMesh = new SphereMesh { Radius = 0.02f * scale, Height = 0.04f * scale };
            var nostrilMat = new StandardMaterial3D { AlbedoColor = new Color(0.1f, 0.05f, 0.05f) };
            var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
            leftNostril.Position = new Vector3(-0.035f * scale, -0.02f * scale, 0.28f * scale);
            headNode.AddChild(leftNostril);
            var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
            rightNostril.Position = new Vector3(0.035f * scale, -0.02f * scale, 0.28f * scale);
            headNode.AddChild(rightNostril);

            // Smoke/ember wisps from nostrils (boss presence)
            if (bossPresence)
            {
                var smokeMat = new StandardMaterial3D
                {
                    AlbedoColor = new Color(glowColor.R, glowColor.G, glowColor.B, 0.4f),
                    EmissionEnabled = true,
                    Emission = glowColor * 0.5f,
                    Transparency = BaseMaterial3D.TransparencyEnum.Alpha
                };
                var smokeMesh = new SphereMesh { Radius = 0.015f * scale, Height = 0.03f * scale };
                var smokeLeft = new MeshInstance3D { Mesh = smokeMesh, MaterialOverride = smokeMat };
                smokeLeft.Position = new Vector3(-0.04f * scale, 0.01f * scale, 0.32f * scale);
                headNode.AddChild(smokeLeft);
                var smokeRight = new MeshInstance3D { Mesh = smokeMesh, MaterialOverride = smokeMat };
                smokeRight.Position = new Vector3(0.04f * scale, 0.01f * scale, 0.32f * scale);
                headNode.AddChild(smokeRight);
            }
        }

        // Jaw (animation-ready for roaring)
        if (lodLevel < 2)
        {
            var jawMesh = new BoxMesh { Size = new Vector3(0.1f * scale, 0.02f * scale, 0.08f * scale) };
            var upperJaw = new MeshInstance3D { Mesh = jawMesh, MaterialOverride = scaleMat };
            upperJaw.Position = new Vector3(0, -0.06f * scale, 0.22f * scale);
            headNode.AddChild(upperJaw);

            var lowerJaw = new MeshInstance3D { Mesh = jawMesh, MaterialOverride = scaleMat };
            lowerJaw.Position = new Vector3(0, -0.09f * scale, 0.20f * scale);
            headNode.AddChild(lowerJaw);
        }

        // Sharp fangs - visible and menacing
        var fangMesh = new CylinderMesh {
            TopRadius = 0.004f * scale,
            BottomRadius = 0.012f * scale,
            Height = 0.05f * scale
        };
        var leftFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = toothMat };
        leftFang.Position = new Vector3(-0.035f * scale, -0.09f * scale, 0.24f * scale);
        leftFang.RotationDegrees = new Vector3(10, 0, 5);
        headNode.AddChild(leftFang);
        var rightFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = toothMat };
        rightFang.Position = new Vector3(0.035f * scale, -0.09f * scale, 0.24f * scale);
        rightFang.RotationDegrees = new Vector3(10, 0, -5);
        headNode.AddChild(rightFang);

        // Additional teeth (high LOD only)
        if (lodLevel == 0)
        {
            var smallToothMesh = new CylinderMesh {
                TopRadius = 0.002f * scale,
                BottomRadius = 0.006f * scale,
                Height = 0.025f * scale
            };
            for (int t = 0; t < 4; t++)
            {
                var tooth = new MeshInstance3D { Mesh = smallToothMesh, MaterialOverride = toothMat };
                tooth.Position = new Vector3((-0.015f + t * 0.01f) * scale, -0.075f * scale, 0.23f * scale);
                tooth.RotationDegrees = new Vector3(8, 0, 0);
                headNode.AddChild(tooth);
            }
        }

        // Glowing reptilian eyes with slit pupils
        var eyeMesh = new SphereMesh {
            Radius = 0.048f * scale,
            Height = 0.096f * scale,
            RadialSegments = 20,
            Rings = 16
        };
        var pupilMesh = new CylinderMesh {
            TopRadius = 0.009f * scale,
            BottomRadius = 0.009f * scale,
            Height = 0.025f * scale,
            RadialSegments = 12
        };

        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.095f * scale, 0.05f * scale, 0.1f * scale);
        leftEye.Scale = new Vector3(0.98f, 1f, 1.02f);
        headNode.AddChild(leftEye);
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.095f * scale, 0.05f * scale, 0.145f * scale);
        leftPupil.RotationDegrees = new Vector3(90, 0, 0);
        leftPupil.Scale = new Vector3(0.9f, 1f, 3.2f); // Narrow vertical slit
        headNode.AddChild(leftPupil);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.09f * scale, 0.05f * scale, 0.1f * scale);
        rightEye.Scale = new Vector3(1.02f, 1f, 0.98f);
        headNode.AddChild(rightEye);
        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.09f * scale, 0.05f * scale, 0.145f * scale);
        rightPupil.RotationDegrees = new Vector3(90, 0, 0);
        rightPupil.Scale = new Vector3(1.1f, 1f, 3.2f);
        headNode.AddChild(rightPupil);

        // === HORNS (Style Variations) ===
        if (lodLevel < 2)
        {
            switch (hornStyle)
            {
                case 0: // Curved (default)
                    {
                        var hornMesh = new CylinderMesh {
                            TopRadius = 0.008f * scale,
                            BottomRadius = 0.042f * scale,
                            Height = 0.24f * scale,
                            RadialSegments = hornSegments,
                            Rings = 8
                        };
                        var leftHorn = new MeshInstance3D { Mesh = hornMesh, MaterialOverride = hornMat };
                        leftHorn.Position = new Vector3(-0.1f * scale, 0.15f * scale, -0.04f * scale);
                        leftHorn.RotationDegrees = new Vector3(28, 18, -28);
                        leftHorn.Scale = new Vector3(1.05f, 1f, 0.98f);
                        headNode.AddChild(leftHorn);

                        var rightHorn = new MeshInstance3D { Mesh = hornMesh, MaterialOverride = hornMat };
                        rightHorn.Position = new Vector3(0.1f * scale, 0.15f * scale, -0.04f * scale);
                        rightHorn.RotationDegrees = new Vector3(25, -15, 25);
                        rightHorn.Scale = new Vector3(0.98f, 1f, 1.02f);
                        headNode.AddChild(rightHorn);

                        // Secondary horns
                        var smallHornMesh = new CylinderMesh {
                            TopRadius = 0.004f * scale,
                            BottomRadius = 0.022f * scale,
                            Height = 0.12f * scale,
                            RadialSegments = hornSegments - 4,
                            Rings = 5
                        };
                        var leftSmallHorn = new MeshInstance3D { Mesh = smallHornMesh, MaterialOverride = hornMat };
                        leftSmallHorn.Position = new Vector3(-0.13f * scale, 0.06f * scale, -0.02f * scale);
                        leftSmallHorn.RotationDegrees = new Vector3(42, 22, -42);
                        headNode.AddChild(leftSmallHorn);
                        var rightSmallHorn = new MeshInstance3D { Mesh = smallHornMesh, MaterialOverride = hornMat };
                        rightSmallHorn.Position = new Vector3(0.12f * scale, 0.06f * scale, -0.02f * scale);
                        rightSmallHorn.RotationDegrees = new Vector3(38, -18, 38);
                        headNode.AddChild(rightSmallHorn);
                    }
                    break;

                case 1: // Straight (forward-pointing)
                    {
                        var hornMesh = new CylinderMesh {
                            TopRadius = 0.005f * scale,
                            BottomRadius = 0.04f * scale,
                            Height = 0.28f * scale,
                            RadialSegments = hornSegments,
                            Rings = 6
                        };
                        var leftHorn = new MeshInstance3D { Mesh = hornMesh, MaterialOverride = hornMat };
                        leftHorn.Position = new Vector3(-0.09f * scale, 0.14f * scale, -0.03f * scale);
                        leftHorn.RotationDegrees = new Vector3(-12, 5, -8);
                        headNode.AddChild(leftHorn);

                        var rightHorn = new MeshInstance3D { Mesh = hornMesh, MaterialOverride = hornMat };
                        rightHorn.Position = new Vector3(0.09f * scale, 0.14f * scale, -0.03f * scale);
                        rightHorn.RotationDegrees = new Vector3(-12, -5, 8);
                        headNode.AddChild(rightHorn);
                    }
                    break;

                case 2: // Branching (antler-like)
                    {
                        var mainHornMesh = new CylinderMesh {
                            TopRadius = 0.012f * scale,
                            BottomRadius = 0.04f * scale,
                            Height = 0.2f * scale,
                            RadialSegments = hornSegments,
                            Rings = 5
                        };
                        var branchMesh = new CylinderMesh {
                            TopRadius = 0.004f * scale,
                            BottomRadius = 0.015f * scale,
                            Height = 0.1f * scale,
                            RadialSegments = hornSegments - 4
                        };

                        // Left main horn
                        var leftMainHorn = new MeshInstance3D { Mesh = mainHornMesh, MaterialOverride = hornMat };
                        leftMainHorn.Position = new Vector3(-0.1f * scale, 0.15f * scale, -0.04f * scale);
                        leftMainHorn.RotationDegrees = new Vector3(20, 10, -20);
                        headNode.AddChild(leftMainHorn);

                        // Left branches
                        var leftBranch1 = new MeshInstance3D { Mesh = branchMesh, MaterialOverride = hornMat };
                        leftBranch1.Position = new Vector3(-0.12f * scale, 0.24f * scale, -0.08f * scale);
                        leftBranch1.RotationDegrees = new Vector3(35, 15, -35);
                        headNode.AddChild(leftBranch1);
                        var leftBranch2 = new MeshInstance3D { Mesh = branchMesh, MaterialOverride = hornMat };
                        leftBranch2.Position = new Vector3(-0.14f * scale, 0.28f * scale, -0.06f * scale);
                        leftBranch2.RotationDegrees = new Vector3(15, 20, -45);
                        headNode.AddChild(leftBranch2);

                        // Right main horn
                        var rightMainHorn = new MeshInstance3D { Mesh = mainHornMesh, MaterialOverride = hornMat };
                        rightMainHorn.Position = new Vector3(0.1f * scale, 0.15f * scale, -0.04f * scale);
                        rightMainHorn.RotationDegrees = new Vector3(20, -10, 20);
                        headNode.AddChild(rightMainHorn);

                        // Right branches
                        var rightBranch1 = new MeshInstance3D { Mesh = branchMesh, MaterialOverride = hornMat };
                        rightBranch1.Position = new Vector3(0.12f * scale, 0.24f * scale, -0.08f * scale);
                        rightBranch1.RotationDegrees = new Vector3(35, -15, 35);
                        headNode.AddChild(rightBranch1);
                        var rightBranch2 = new MeshInstance3D { Mesh = branchMesh, MaterialOverride = hornMat };
                        rightBranch2.Position = new Vector3(0.14f * scale, 0.28f * scale, -0.06f * scale);
                        rightBranch2.RotationDegrees = new Vector3(15, -20, 45);
                        headNode.AddChild(rightBranch2);
                    }
                    break;
            }
        }

        // === MASSIVE WINGS (Animation-Ready with Fingers) ===
        float wingScale = wingSpan;

        // Left Wing
        var leftWing = new Node3D();
        leftWing.Position = new Vector3(-0.33f * scale, 0.88f * scale, -0.1f * scale);
        parent.AddChild(leftWing);
        limbs.LeftArm = leftWing;

        if (lodLevel < 2)
        {
            // Wing arm bone
            var wingBoneMesh = new CylinderMesh {
                TopRadius = 0.02f * scale,
                BottomRadius = 0.03f * scale,
                Height = 0.25f * scale * wingScale
            };
            var leftWingArm = new MeshInstance3D { Mesh = wingBoneMesh, MaterialOverride = scaleMat };
            leftWingArm.Position = new Vector3(-0.12f * scale * wingScale, 0, 0);
            leftWingArm.RotationDegrees = new Vector3(0, 0, 60);
            leftWing.AddChild(leftWingArm);

            // Wing fingers (bat-like structure)
            if (wingFingers > 0)
            {
                var fingerMesh = new CylinderMesh {
                    TopRadius = 0.008f * scale,
                    BottomRadius = 0.015f * scale,
                    Height = 0.35f * scale * wingScale
                };
                for (int f = 0; f < wingFingers; f++)
                {
                    var finger = new MeshInstance3D { Mesh = fingerMesh, MaterialOverride = scaleMat };
                    finger.Position = new Vector3(
                        (-0.28f - f * 0.08f) * scale * wingScale,
                        0.02f * scale,
                        (-0.05f + f * 0.08f) * scale
                    );
                    finger.RotationDegrees = new Vector3(0, -10 + f * 12, 70);
                    leftWing.AddChild(finger);
                }
            }
        }

        // Wing membrane
        var wingBoxMesh = new BoxMesh {
            Size = new Vector3(0.55f * scale * wingScale, 0.015f * scale, 0.38f * scale)
        };
        var leftWingMesh = new MeshInstance3D { Mesh = wingBoxMesh, MaterialOverride = wingMat };
        leftWingMesh.Position = new Vector3(-0.32f * scale * wingScale, 0, 0);
        leftWingMesh.RotationDegrees = new Vector3(0, 0, 28);
        leftWing.AddChild(leftWingMesh);

        // Right Wing
        var rightWing = new Node3D();
        rightWing.Position = new Vector3(0.33f * scale, 0.88f * scale, -0.1f * scale);
        parent.AddChild(rightWing);
        limbs.RightArm = rightWing;

        if (lodLevel < 2)
        {
            var rightWingArm = new MeshInstance3D {
                Mesh = new CylinderMesh {
                    TopRadius = 0.02f * scale,
                    BottomRadius = 0.03f * scale,
                    Height = 0.25f * scale * wingScale
                },
                MaterialOverride = scaleMat
            };
            rightWingArm.Position = new Vector3(0.12f * scale * wingScale, 0, 0);
            rightWingArm.RotationDegrees = new Vector3(0, 0, -60);
            rightWing.AddChild(rightWingArm);

            if (wingFingers > 0)
            {
                var fingerMesh = new CylinderMesh {
                    TopRadius = 0.008f * scale,
                    BottomRadius = 0.015f * scale,
                    Height = 0.35f * scale * wingScale
                };
                for (int f = 0; f < wingFingers; f++)
                {
                    var finger = new MeshInstance3D { Mesh = fingerMesh, MaterialOverride = scaleMat };
                    finger.Position = new Vector3(
                        (0.28f + f * 0.08f) * scale * wingScale,
                        0.02f * scale,
                        (-0.05f + f * 0.08f) * scale
                    );
                    finger.RotationDegrees = new Vector3(0, 10 - f * 12, -70);
                    rightWing.AddChild(finger);
                }
            }
        }

        var rightWingMesh = new MeshInstance3D { Mesh = wingBoxMesh, MaterialOverride = wingMat };
        rightWingMesh.Position = new Vector3(0.32f * scale * wingScale, 0, 0);
        rightWingMesh.RotationDegrees = new Vector3(0, 0, -28);
        rightWing.AddChild(rightWingMesh);

        // === POWERFUL LEGS (All Four Separate) ===
        CreateDragonLeg(parent, limbs, scaleMat, clawMat, scale, true, lodLevel);  // Front left
        CreateDragonLeg(parent, limbs, scaleMat, clawMat, scale, false, lodLevel); // Front right

        // Rear legs (slightly back and smaller)
        if (lodLevel < 2)
        {
            var rearLeftLeg = new Node3D();
            rearLeftLeg.Position = new Vector3(-0.22f * scale, 0.28f * scale, -0.25f * scale);
            parent.AddChild(rearLeftLeg);

            var rearLegMesh = new CylinderMesh {
                TopRadius = 0.07f * scale,
                BottomRadius = 0.055f * scale,
                Height = 0.25f * scale
            };
            var rearLeftUpper = new MeshInstance3D { Mesh = rearLegMesh, MaterialOverride = scaleMat };
            rearLeftUpper.Position = new Vector3(0, -0.12f * scale, 0);
            rearLeftLeg.AddChild(rearLeftUpper);

            var footMesh = new BoxMesh { Size = new Vector3(0.09f * scale, 0.03f * scale, 0.13f * scale) };
            var rearLeftFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = scaleMat };
            rearLeftFoot.Position = new Vector3(0, -0.26f * scale, 0.04f * scale);
            rearLeftLeg.AddChild(rearLeftFoot);

            // Rear claws
            var clawMesh = new CylinderMesh {
                TopRadius = 0.003f * scale,
                BottomRadius = 0.012f * scale,
                Height = 0.05f * scale
            };
            for (int c = 0; c < 3; c++)
            {
                var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
                claw.Position = new Vector3((-0.03f + c * 0.03f) * scale, -0.28f * scale, 0.11f * scale);
                claw.RotationDegrees = new Vector3(-55, 0, -8 + c * 8);
                rearLeftLeg.AddChild(claw);
            }

            // Rear right leg (mirrored)
            var rearRightLeg = new Node3D();
            rearRightLeg.Position = new Vector3(0.22f * scale, 0.28f * scale, -0.25f * scale);
            parent.AddChild(rearRightLeg);

            var rearRightUpper = new MeshInstance3D { Mesh = rearLegMesh, MaterialOverride = scaleMat };
            rearRightUpper.Position = new Vector3(0, -0.12f * scale, 0);
            rearRightLeg.AddChild(rearRightUpper);

            var rearRightFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = scaleMat };
            rearRightFoot.Position = new Vector3(0, -0.26f * scale, 0.04f * scale);
            rearRightLeg.AddChild(rearRightFoot);

            for (int c = 0; c < 3; c++)
            {
                var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
                claw.Position = new Vector3((-0.03f + c * 0.03f) * scale, -0.28f * scale, 0.11f * scale);
                claw.RotationDegrees = new Vector3(-55, 0, -8 + c * 8);
                rearRightLeg.AddChild(claw);
            }
        }

        // === LONG TAIL (Segmented Chain for Animation) ===
        var tailChain = new Node3D();
        tailChain.Position = new Vector3(0, 0.55f * scale, -0.4f * scale);
        tailChain.RotationDegrees = new Vector3(-55, 0, 0);
        parent.AddChild(tailChain);

        Node3D previousTailSegment = tailChain;
        float tailRadius = 0.12f;

        for (int i = 0; i < tailSegments; i++)
        {
            var tailSegNode = new Node3D();
            tailSegNode.Position = new Vector3(0, -0.18f * scale, 0);
            tailSegNode.RotationDegrees = new Vector3(-5 + i * 2, 0, 0);
            previousTailSegment.AddChild(tailSegNode);

            float topRadius = (tailRadius * 0.3f - i * 0.015f) * scale;
            float bottomRadius = (tailRadius - i * 0.015f) * scale;
            var tailSegMesh = new CylinderMesh {
                TopRadius = topRadius,
                BottomRadius = bottomRadius,
                Height = 0.2f * scale
            };

            var tailSeg = new MeshInstance3D { Mesh = tailSegMesh, MaterialOverride = scaleMat };
            tailSeg.Position = new Vector3(0, -0.1f * scale, 0);
            tailSegNode.AddChild(tailSeg);

            // Tail spines (style variation)
            if (lodLevel == 0 && tailStyle == 1 && i < tailSegments - 1) // Spikes style
            {
                var tailSpineMesh = new CylinderMesh {
                    TopRadius = 0.004f * scale,
                    BottomRadius = 0.018f * scale,
                    Height = 0.08f * scale
                };
                var tailSpine = new MeshInstance3D { Mesh = tailSpineMesh, MaterialOverride = hornMat };
                tailSpine.Position = new Vector3(0, -0.05f * scale, -bottomRadius * 0.8f);
                tailSpine.RotationDegrees = new Vector3(-25, 0, 0);
                tailSegNode.AddChild(tailSpine);
            }

            previousTailSegment = tailSegNode;
            tailRadius -= 0.02f;
        }

        // Tail end (style variation)
        switch (tailStyle)
        {
            case 0: // Spade
                {
                    var spadeMesh = new BoxMesh { Size = new Vector3(0.15f * scale, 0.02f * scale, 0.12f * scale) };
                    var spade = new MeshInstance3D { Mesh = spadeMesh, MaterialOverride = scaleMat };
                    spade.Position = new Vector3(0, -0.15f * scale, 0);
                    spade.Scale = new Vector3(1f, 1f, 1.5f);
                    previousTailSegment.AddChild(spade);
                }
                break;

            case 1: // Large spike
                {
                    var tailSpikeMesh = new CylinderMesh {
                        TopRadius = 0.003f * scale,
                        BottomRadius = 0.025f * scale,
                        Height = 0.1f * scale
                    };
                    var tailSpike = new MeshInstance3D { Mesh = tailSpikeMesh, MaterialOverride = hornMat };
                    tailSpike.Position = new Vector3(0, -0.12f * scale, 0);
                    tailSpike.RotationDegrees = new Vector3(-15, 0, 0);
                    previousTailSegment.AddChild(tailSpike);
                }
                break;

            case 2: // Plain tapered end (already created by segments)
                break;
        }
    }

    private static void CreateDragonLeg(Node3D parent, LimbNodes limbs, StandardMaterial3D scaleMat,
        StandardMaterial3D clawMat, float scale, bool isLeft, int lodLevel = 0)
    {
        float side = isLeft ? -1 : 1;

        var legNode = new Node3D();
        legNode.Position = new Vector3(side * 0.24f * scale, 0.32f * scale, 0.05f * scale);
        parent.AddChild(legNode);

        if (isLeft) limbs.LeftLeg = legNode;
        else limbs.RightLeg = legNode;

        int legSegments = lodLevel == 0 ? 12 : (lodLevel == 1 ? 8 : 6);

        // Upper leg (thigh)
        var upperLegMesh = new CylinderMesh {
            TopRadius = 0.08f * scale,
            BottomRadius = 0.065f * scale,
            Height = 0.2f * scale,
            RadialSegments = legSegments
        };
        var upperLeg = new MeshInstance3D { Mesh = upperLegMesh, MaterialOverride = scaleMat };
        upperLeg.Position = new Vector3(0, -0.08f * scale, 0);
        legNode.AddChild(upperLeg);

        // Lower leg (shin)
        var lowerLegMesh = new CylinderMesh {
            TopRadius = 0.06f * scale,
            BottomRadius = 0.05f * scale,
            Height = 0.18f * scale,
            RadialSegments = legSegments
        };
        var lowerLeg = new MeshInstance3D { Mesh = lowerLegMesh, MaterialOverride = scaleMat };
        lowerLeg.Position = new Vector3(0, -0.22f * scale, 0);
        legNode.AddChild(lowerLeg);

        // Foot
        var footMesh = new BoxMesh { Size = new Vector3(0.1f * scale, 0.035f * scale, 0.15f * scale) };
        var foot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = scaleMat };
        foot.Position = new Vector3(0, -0.32f * scale, 0.04f * scale);
        legNode.AddChild(foot);

        // Sharp claws
        var clawMesh = new CylinderMesh {
            TopRadius = 0.003f * scale,
            BottomRadius = 0.012f * scale,
            Height = 0.05f * scale
        };
        for (int c = 0; c < 3; c++)
        {
            var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = clawMat };
            claw.Position = new Vector3((-0.03f + c * 0.03f) * scale, -0.34f * scale, 0.12f * scale);
            claw.RotationDegrees = new Vector3(-55, 0, -8 + c * 8);
            legNode.AddChild(claw);
        }

        // Knee spike (high LOD only)
        if (lodLevel == 0)
        {
            var kneeSpikeMesh = new CylinderMesh {
                TopRadius = 0.004f * scale,
                BottomRadius = 0.015f * scale,
                Height = 0.06f * scale
            };
            var kneeSpike = new MeshInstance3D { Mesh = kneeSpikeMesh, MaterialOverride = scaleMat };
            kneeSpike.Position = new Vector3(side * 0.04f * scale, -0.16f * scale, -0.02f * scale);
            kneeSpike.RotationDegrees = new Vector3(0, 0, side * 45);
            legNode.AddChild(kneeSpike);
        }
    }


    /// <summary>
    /// Creates an enhanced anatomically accurate floating Eye creature with LOD support.
    /// </summary>
    /// <param name="parent">Parent node</param>
    /// <param name="limbs">Limb nodes for animation</param>
    /// <param name="colorOverride">Optional iris color override</param>
    /// <param name="lodLevel">Level of detail: 0=High, 1=Medium, 2=Low</param>
    /// <param name="pupilShape">Pupil shape: 0=Round, 1=Slit, 2=Star</param>
    /// <param name="bloodshotIntensity">Blood vessel intensity 0-1</param>
    /// <param name="nerveTendrilCount">Number of trailing nerve tendrils (3-8)</param>
    /// <param name="sizeVariation">Size multiplier (0.8-1.5)</param>
    private static void CreateEyeMesh(Node3D parent, LimbNodes limbs, Color? colorOverride = null,
        int lodLevel = 0, int pupilShape = 1, float bloodshotIntensity = 0.7f,
        int nerveTendrilCount = 6, float sizeVariation = 1.0f)
    {
        // Vary iris color for different eye types
        Color irisColor = colorOverride ?? GetRandomIrisColor();
        Color veinColor = new Color(0.8f, 0.2f, 0.2f) * bloodshotIntensity;

        // Scale all dimensions
        float scale = sizeVariation;

        // LOD-based mesh quality
        int scleraSegments = lodLevel == 0 ? 32 : (lodLevel == 1 ? 20 : 12);
        int scleraRings = lodLevel == 0 ? 24 : (lodLevel == 1 ? 16 : 10);
        int irisSegments = lodLevel == 0 ? 24 : (lodLevel == 1 ? 16 : 10);
        int irisRings = lodLevel == 0 ? 18 : (lodLevel == 1 ? 12 : 8);

        // Materials
        var scleraMat = new StandardMaterial3D {
            AlbedoColor = new Color(0.95f, 0.93f, 0.88f), // Slightly off-white, more realistic
            Roughness = 0.3f,
            Metallic = 0.05f
        };
        var irisMat = new StandardMaterial3D
        {
            AlbedoColor = irisColor,
            EmissionEnabled = true,
            Emission = irisColor * 0.5f,
            Roughness = 0.4f
        };
        var pupilMat = new StandardMaterial3D {
            AlbedoColor = Colors.Black,
            Roughness = 0.1f
        };
        var corneaMat = new StandardMaterial3D {
            AlbedoColor = new Color(0.9f, 0.9f, 0.95f, 0.3f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.05f,
            Metallic = 0.1f
        };
        var veinMat = new StandardMaterial3D {
            AlbedoColor = veinColor,
            EmissionEnabled = bloodshotIntensity > 0.5f,
            Emission = veinColor * 0.2f
        };
        var eyelidMat = new StandardMaterial3D {
            AlbedoColor = new Color(0.65f, 0.45f, 0.45f),
            Roughness = 0.8f
        };
        var nerveMat = new StandardMaterial3D {
            AlbedoColor = new Color(0.75f, 0.55f, 0.55f),
            Roughness = 0.7f
        };

        // SCLERA (white outer sphere) - slightly asymmetric for creepy effect
        var sclera = new MeshInstance3D();
        var scleraMesh = new SphereMesh {
            Radius = 0.36f * scale,
            Height = 0.72f * scale,
            RadialSegments = scleraSegments,
            Rings = scleraRings
        };
        sclera.Mesh = scleraMesh;
        sclera.MaterialOverride = scleraMat;
        sclera.Position = new Vector3(0, 0.6f * scale, 0);
        sclera.Scale = new Vector3(1.03f, 0.97f, 1.02f); // Asymmetric for unnatural look
        parent.AddChild(sclera);
        limbs.Head = sclera;

        // BLOOD VESSELS - elaborate network on sclera surface (LOD-dependent)
        int veinCount = lodLevel == 0 ? 16 : (lodLevel == 1 ? 10 : 6);
        if (bloodshotIntensity > 0.1f)
        {
            for (int i = 0; i < veinCount; i++)
            {
                float angle = i * Mathf.Pi * 2f / veinCount;
                float yOffset = (i % 2 == 0) ? 0.1f : -0.05f;

                // Main vein with pulsing appearance
                var vein = new MeshInstance3D();
                var veinMesh = new CylinderMesh {
                    TopRadius = 0.003f * scale * bloodshotIntensity,
                    BottomRadius = 0.015f * scale * bloodshotIntensity,
                    Height = 0.2f * scale
                };
                vein.Mesh = veinMesh;
                vein.MaterialOverride = veinMat;
                vein.Position = new Vector3(
                    Mathf.Cos(angle) * 0.28f * scale,
                    0.6f * scale + yOffset * scale,
                    Mathf.Sin(angle) * 0.28f * scale
                );
                vein.LookAt(new Vector3(0, 0.6f * scale, 0), Vector3.Up);
                vein.RotateObjectLocal(Vector3.Right, Mathf.Pi / 2f);
                parent.AddChild(vein);

                // Branch veins (only on high/medium LOD)
                if (lodLevel <= 1 && i % 2 == 0)
                {
                    var branch = new MeshInstance3D();
                    var branchMesh = new CylinderMesh {
                        TopRadius = 0.002f * scale * bloodshotIntensity,
                        BottomRadius = 0.008f * scale * bloodshotIntensity,
                        Height = 0.1f * scale
                    };
                    branch.Mesh = branchMesh;
                    branch.MaterialOverride = veinMat;
                    branch.Position = new Vector3(
                        Mathf.Cos(angle + 0.25f) * 0.22f * scale,
                        0.6f * scale + yOffset * scale + 0.08f * scale,
                        Mathf.Sin(angle + 0.25f) * 0.22f * scale
                    );
                    branch.RotationDegrees = new Vector3(30, angle * 57.3f, 20);
                    parent.AddChild(branch);

                    // Capillaries (only high LOD)
                    if (lodLevel == 0)
                    {
                        var capillary = new MeshInstance3D();
                        var capMesh = new CylinderMesh {
                            TopRadius = 0.001f * scale * bloodshotIntensity,
                            BottomRadius = 0.004f * scale * bloodshotIntensity,
                            Height = 0.06f * scale
                        };
                        capillary.Mesh = capMesh;
                        capillary.MaterialOverride = veinMat;
                        capillary.Position = new Vector3(
                            Mathf.Cos(angle - 0.2f) * 0.25f * scale,
                            0.6f * scale + yOffset * scale + 0.05f * scale,
                            Mathf.Sin(angle - 0.2f) * 0.25f * scale
                        );
                        capillary.RotationDegrees = new Vector3(-25, angle * 57.3f, -15);
                        parent.AddChild(capillary);
                    }
                }
            }
        }

        // IRIS - colored disk with radial pattern detail
        var iris = new MeshInstance3D();
        var irisMesh = new SphereMesh {
            Radius = 0.18f * scale,
            Height = 0.36f * scale,
            RadialSegments = irisSegments,
            Rings = irisRings
        };
        iris.Mesh = irisMesh;
        iris.MaterialOverride = irisMat;
        iris.Position = new Vector3(0, 0.6f * scale, 0.26f * scale);
        parent.AddChild(iris);

        // Iris radial pattern rings (only high/medium LOD)
        if (lodLevel <= 1)
        {
            int ringCount = lodLevel == 0 ? 3 : 2;
            for (int r = 0; r < ringCount; r++)
            {
                var irisRing = new MeshInstance3D();
                float ringRadius = (0.11f + r * 0.03f) * scale;
                var irisRingMesh = new TorusMesh {
                    InnerRadius = ringRadius,
                    OuterRadius = (ringRadius + 0.015f * scale),
                    RingSegments = irisSegments,
                    Rings = 8
                };
                irisRing.Mesh = irisRingMesh;
                irisRing.MaterialOverride = new StandardMaterial3D {
                    AlbedoColor = irisColor.Darkened(0.2f + r * 0.15f),
                    Roughness = 0.4f,
                    EmissionEnabled = true,
                    Emission = irisColor.Darkened(0.5f) * 0.3f
                };
                irisRing.Position = new Vector3(0, 0.6f * scale, 0.28f * scale);
                irisRing.RotationDegrees = new Vector3(90, 0, 0);
                irisRing.Scale = new Vector3(1, 1, 0.2f);
                parent.AddChild(irisRing);
            }
        }

        // PUPIL - separate node for dilation animation, shape varies
        var pupilNode = new Node3D();
        pupilNode.Name = "Pupil";
        pupilNode.Position = new Vector3(0, 0.6f * scale, 0.32f * scale);
        parent.AddChild(pupilNode);

        var pupil = new MeshInstance3D();
        var pupilMesh = new SphereMesh {
            Radius = 0.07f * scale,
            Height = 0.14f * scale,
            RadialSegments = lodLevel == 0 ? 16 : 10,
            Rings = lodLevel == 0 ? 12 : 8
        };
        pupil.Mesh = pupilMesh;
        pupil.MaterialOverride = pupilMat;

        // Shape pupil based on type
        switch (pupilShape)
        {
            case 0: // Round
                pupil.Scale = new Vector3(1f, 1f, 1f);
                break;
            case 1: // Slit (cat-like, menacing)
                pupil.Scale = new Vector3(0.3f, 1.5f, 1f);
                break;
            case 2: // Star (alien/eldritch)
                pupil.Scale = new Vector3(1f, 1f, 1f);
                // Add star points with extra geometry (high LOD only)
                if (lodLevel == 0)
                {
                    for (int s = 0; s < 5; s++)
                    {
                        float starAngle = s * Mathf.Pi * 2f / 5f;
                        var point = new MeshInstance3D();
                        var pointMesh = new CylinderMesh {
                            TopRadius = 0.002f * scale,
                            BottomRadius = 0.015f * scale,
                            Height = 0.04f * scale
                        };
                        point.Mesh = pointMesh;
                        point.MaterialOverride = pupilMat;
                        point.Position = new Vector3(
                            Mathf.Cos(starAngle) * 0.05f * scale,
                            0,
                            Mathf.Sin(starAngle) * 0.05f * scale
                        );
                        point.RotationDegrees = new Vector3(0, 0, starAngle * 57.3f);
                        pupilNode.AddChild(point);
                    }
                }
                break;
        }
        pupilNode.AddChild(pupil);

        // CORNEA - clear bulge over iris (only high LOD for performance)
        if (lodLevel == 0)
        {
            var cornea = new MeshInstance3D();
            var corneaMesh = new SphereMesh {
                Radius = 0.19f * scale,
                Height = 0.38f * scale,
                RadialSegments = 20,
                Rings = 16
            };
            cornea.Mesh = corneaMesh;
            cornea.MaterialOverride = corneaMat;
            cornea.Position = new Vector3(0, 0.6f * scale, 0.3f * scale);
            cornea.Scale = new Vector3(1f, 1f, 0.6f); // Flattened dome
            parent.AddChild(cornea);
        }

        // EYELID FRAGMENTS - torn, ragged, hanging (creepy effect)
        if (lodLevel <= 1)
        {
            int lidFragments = lodLevel == 0 ? 8 : 5;
            for (int i = 0; i < lidFragments; i++)
            {
                float angle = i * Mathf.Pi * 2f / lidFragments;
                bool isUpper = i % 2 == 0;
                float yPos = isUpper ? 0.78f : 0.42f;
                float hangAmount = 0.02f + (i % 3) * 0.015f;

                var lidFrag = new MeshInstance3D();
                var fragMesh = new BoxMesh {
                    Size = new Vector3(0.1f * scale, 0.08f * scale, 0.05f * scale)
                };
                lidFrag.Mesh = fragMesh;
                lidFrag.MaterialOverride = eyelidMat;
                lidFrag.Position = new Vector3(
                    Mathf.Cos(angle) * 0.32f * scale,
                    yPos * scale - hangAmount * scale,
                    Mathf.Sin(angle) * 0.32f * scale
                );
                lidFrag.RotationDegrees = new Vector3(
                    isUpper ? -15 : 15,
                    angle * 57.3f,
                    (i % 2) * 10 - 5
                );
                lidFrag.Scale = new Vector3(1f, 1f + hangAmount * 3f, 0.8f); // Stretched/torn
                parent.AddChild(lidFrag);
            }
        }

        // NERVE TENDRILS - trailing optic nerve fragments (like jellyfish tentacles)
        int tendrilCount = Mathf.Clamp(nerveTendrilCount, 3, 8);
        for (int i = 0; i < tendrilCount; i++)
        {
            float angle = i * Mathf.Pi * 2f / tendrilCount + Mathf.Pi / tendrilCount;
            float tendrilLength = (0.25f + (i % 3) * 0.05f) * scale;

            // Main nerve tendril - tapers from thick to thin
            var tendril = new MeshInstance3D();
            var tendrilMesh = new CylinderMesh {
                TopRadius = 0.04f * scale,
                BottomRadius = 0.008f * scale,
                Height = tendrilLength
            };
            tendril.Mesh = tendrilMesh;
            tendril.MaterialOverride = nerveMat;
            tendril.Position = new Vector3(
                Mathf.Cos(angle) * 0.12f * scale,
                0.24f * scale,
                Mathf.Sin(angle) * 0.12f * scale
            );
            tendril.RotationDegrees = new Vector3(
                12 * Mathf.Cos(angle * 2f),
                angle * 57.3f,
                12 * Mathf.Sin(angle * 2f)
            );
            parent.AddChild(tendril);

            // Pulsing veins on nerve tendrils (high LOD only)
            if (lodLevel == 0)
            {
                int veinSegments = 3;
                for (int j = 0; j < veinSegments; j++)
                {
                    var tendrilVein = new MeshInstance3D();
                    var veinSegMesh = new CylinderMesh {
                        TopRadius = 0.002f * scale,
                        BottomRadius = 0.006f * scale,
                        Height = 0.06f * scale
                    };
                    tendrilVein.Mesh = veinSegMesh;
                    tendrilVein.MaterialOverride = veinMat;
                    float veinY = 0.32f * scale - j * 0.07f * scale;
                    tendrilVein.Position = new Vector3(
                        Mathf.Cos(angle) * 0.12f * scale + Mathf.Cos(angle + Mathf.Pi / 2f) * 0.03f * scale,
                        veinY,
                        Mathf.Sin(angle) * 0.12f * scale + Mathf.Sin(angle + Mathf.Pi / 2f) * 0.03f * scale
                    );
                    tendrilVein.RotationDegrees = new Vector3(0, angle * 57.3f, 25);
                    parent.AddChild(tendrilVein);
                }
            }

            // Tendril tips with slight bulb (only medium/high LOD)
            if (lodLevel <= 1)
            {
                var tip = new MeshInstance3D();
                var tipMesh = new SphereMesh {
                    Radius = 0.015f * scale,
                    Height = 0.03f * scale,
                    RadialSegments = 8,
                    Rings = 6
                };
                tip.Mesh = tipMesh;
                tip.MaterialOverride = new StandardMaterial3D {
                    AlbedoColor = nerveMat.AlbedoColor.Darkened(0.3f),
                    Roughness = 0.6f
                };
                tip.Position = new Vector3(
                    Mathf.Cos(angle) * 0.12f * scale,
                    0.24f * scale - tendrilLength / 2f - 0.02f * scale,
                    Mathf.Sin(angle) * 0.12f * scale
                );
                parent.AddChild(tip);
            }
        }

        // SMALL SECONDARY EYES - unnatural growths around main eye (only high/medium LOD)
        if (lodLevel <= 1)
        {
            int smallEyeCount = lodLevel == 0 ? 5 : 3;
            var smallEyeMat = new StandardMaterial3D
            {
                AlbedoColor = new Color(0.88f, 0.88f, 0.83f),
                Roughness = 0.35f
            };

            for (int i = 0; i < smallEyeCount; i++)
            {
                float angle = i * Mathf.Pi * 2f / smallEyeCount + Mathf.Pi / 4f;
                float eyeSize = (0.05f + (i % 2) * 0.015f) * scale;

                var smallEye = new MeshInstance3D();
                var smallEyeMesh = new SphereMesh {
                    Radius = eyeSize,
                    Height = eyeSize * 2f,
                    RadialSegments = lodLevel == 0 ? 12 : 8,
                    Rings = lodLevel == 0 ? 10 : 6
                };
                smallEye.Mesh = smallEyeMesh;
                smallEye.MaterialOverride = smallEyeMat;
                smallEye.Position = new Vector3(
                    Mathf.Cos(angle) * 0.3f * scale,
                    0.72f * scale + (i % 2) * 0.05f * scale,
                    Mathf.Sin(angle) * 0.3f * scale
                );
                smallEye.Scale = new Vector3(1f, 0.95f, 1.02f); // Slightly deformed
                parent.AddChild(smallEye);

                // Small iris
                var smallIris = new MeshInstance3D();
                var smallIrisMesh = new SphereMesh {
                    Radius = eyeSize * 0.6f,
                    Height = eyeSize * 1.2f,
                    RadialSegments = 8,
                    Rings = 6
                };
                smallIris.Mesh = smallIrisMesh;
                smallIris.MaterialOverride = new StandardMaterial3D {
                    AlbedoColor = irisColor,
                    EmissionEnabled = true,
                    Emission = irisColor * 0.3f
                };
                smallIris.Position = new Vector3(
                    Mathf.Cos(angle) * 0.32f * scale,
                    0.72f * scale + (i % 2) * 0.05f * scale,
                    Mathf.Sin(angle) * 0.32f * scale
                );
                parent.AddChild(smallIris);

                // Small pupil
                var smallPupil = new MeshInstance3D();
                var smallPupilMesh = new SphereMesh {
                    Radius = eyeSize * 0.3f,
                    Height = eyeSize * 0.6f,
                    RadialSegments = 6,
                    Rings = 4
                };
                smallPupil.Mesh = smallPupilMesh;
                smallPupil.MaterialOverride = pupilMat;
                smallPupil.Position = new Vector3(
                    Mathf.Cos(angle) * 0.34f * scale,
                    0.72f * scale + (i % 2) * 0.05f * scale,
                    Mathf.Sin(angle) * 0.34f * scale
                );
                parent.AddChild(smallPupil);
            }
        }

        // OPTIC NERVE STUMP - thick nerve bundle at rear of eye
        var opticNerve = new MeshInstance3D();
        var opticNerveMesh = new CylinderMesh {
            TopRadius = 0.09f * scale,
            BottomRadius = 0.06f * scale,
            Height = 0.18f * scale,
            RadialSegments = lodLevel == 0 ? 16 : 10
        };
        opticNerve.Mesh = opticNerveMesh;
        opticNerve.MaterialOverride = nerveMat;
        opticNerve.Position = new Vector3(0, 0.6f * scale, -0.4f * scale);
        opticNerve.RotationDegrees = new Vector3(90, 0, 0);
        parent.AddChild(opticNerve);

        // Nerve fiber details on optic nerve (high LOD only)
        if (lodLevel == 0)
        {
            for (int i = 0; i < 6; i++)
            {
                float angle = i * Mathf.Pi * 2f / 6f;
                var fiber = new MeshInstance3D();
                var fiberMesh = new CylinderMesh {
                    TopRadius = 0.008f * scale,
                    BottomRadius = 0.005f * scale,
                    Height = 0.15f * scale
                };
                fiber.Mesh = fiberMesh;
                fiber.MaterialOverride = new StandardMaterial3D {
                    AlbedoColor = nerveMat.AlbedoColor.Lightened(0.15f),
                    Roughness = 0.6f
                };
                fiber.Position = new Vector3(
                    Mathf.Cos(angle) * 0.05f * scale,
                    0.6f * scale,
                    -0.4f * scale
                );
                fiber.RotationDegrees = new Vector3(90, 0, 0);
                parent.AddChild(fiber);
            }
        }
    }

    /// <summary>
    /// Helper method to generate random iris colors for variety
    /// </summary>
    private static Color GetRandomIrisColor()
    {
        int colorType = GD.RandRange(0, 4);
        return colorType switch
        {
            0 => new Color(0.9f, 0.2f, 0.2f),    // Red (default)
            1 => new Color(0.9f, 0.85f, 0.2f),   // Yellow/Gold
            2 => new Color(0.2f, 0.8f, 0.3f),    // Green
            3 => new Color(0.6f, 0.2f, 0.9f),    // Purple
            4 => new Color(0.2f, 0.6f, 0.9f),    // Blue
            _ => new Color(0.9f, 0.2f, 0.2f)
        };
    }

    private static void CreateMushroomMesh(Node3D parent, LimbNodes limbs, Color? colorOverride)
    {
        Color capColor = colorOverride ?? new Color(0.6f, 0.4f, 0.5f);
        Color stemColor = new Color(0.9f, 0.85f, 0.75f);
        Color spotColor = Colors.White;
        Color gillColor = capColor.Darkened(0.3f);

        var capMat = new StandardMaterial3D { AlbedoColor = capColor, Roughness = 0.8f };
        var stemMat = new StandardMaterial3D { AlbedoColor = stemColor, Roughness = 0.9f };
        var spotMat = new StandardMaterial3D { AlbedoColor = spotColor };
        var gillMat = new StandardMaterial3D { AlbedoColor = gillColor, Roughness = 0.9f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.2f, 0.8f, 0.3f),
            EmissionEnabled = true,
            Emission = new Color(0.2f, 0.8f, 0.3f) * 0.3f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };
        var mouthMat = new StandardMaterial3D { AlbedoColor = new Color(0.3f, 0.15f, 0.15f) };
        var sporeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.8f, 0.9f, 0.5f),
            EmissionEnabled = true,
            Emission = new Color(0.6f, 0.8f, 0.3f) * 0.2f,
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha
        };

        // Stem with texture rings
        var stem = new MeshInstance3D();
        var stemMesh = new CylinderMesh { TopRadius = 0.12f, BottomRadius = 0.18f, Height = 0.5f };
        stem.Mesh = stemMesh;
        stem.MaterialOverride = stemMat;
        stem.Position = new Vector3(0, 0.25f, 0);
        parent.AddChild(stem);

        // Stem rings for texture
        for (int i = 0; i < 3; i++)
        {
            var ring = new MeshInstance3D();
            var ringMesh = new TorusMesh { InnerRadius = 0.11f + i * 0.015f, OuterRadius = 0.14f + i * 0.01f };
            ring.Mesh = ringMesh;
            ring.MaterialOverride = new StandardMaterial3D { AlbedoColor = stemColor.Darkened(0.1f) };
            ring.Position = new Vector3(0, 0.12f + i * 0.12f, 0);
            ring.Scale = new Vector3(1, 0.3f, 1);
            parent.AddChild(ring);
        }

        // Stem bulge at base
        var bulge = new MeshInstance3D();
        var bulgeMesh = new SphereMesh { Radius = 0.15f, Height = 0.3f };
        bulge.Mesh = bulgeMesh;
        bulge.MaterialOverride = stemMat;
        bulge.Position = new Vector3(0, 0.05f, 0);
        bulge.Scale = new Vector3(1.2f, 0.6f, 1.2f);
        parent.AddChild(bulge);

        // Cap (head for animation)
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.55f, 0);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var cap = new MeshInstance3D();
        var capMesh = new SphereMesh { Radius = 0.35f, Height = 0.7f };
        cap.Mesh = capMesh;
        cap.MaterialOverride = capMat;
        cap.Scale = new Vector3(1f, 0.5f, 1f);
        headNode.AddChild(cap);

        // Cap edge/lip
        var capEdge = new MeshInstance3D();
        var capEdgeMesh = new TorusMesh { InnerRadius = 0.28f, OuterRadius = 0.36f };
        capEdge.Mesh = capEdgeMesh;
        capEdge.MaterialOverride = new StandardMaterial3D { AlbedoColor = capColor.Darkened(0.15f), Roughness = 0.85f };
        capEdge.Position = new Vector3(0, -0.02f, 0);
        capEdge.Scale = new Vector3(1, 0.4f, 1);
        headNode.AddChild(capEdge);

        // Gills under cap
        for (int i = 0; i < 16; i++)
        {
            float angle = i * Mathf.Pi * 2f / 16f;
            var gill = new MeshInstance3D();
            var gillMesh = new BoxMesh { Size = new Vector3(0.01f, 0.08f, 0.2f) };
            gill.Mesh = gillMesh;
            gill.MaterialOverride = gillMat;
            gill.Position = new Vector3(Mathf.Cos(angle) * 0.12f, -0.06f, Mathf.Sin(angle) * 0.12f);
            gill.RotationDegrees = new Vector3(0, -angle * 57.3f, 0);
            headNode.AddChild(gill);
        }

        // Spots on cap - varied sizes
        float[] spotSizes = { 0.06f, 0.045f, 0.07f, 0.05f, 0.055f, 0.04f, 0.065f, 0.038f };
        float[] spotAngles = { 0, 0.9f, 1.6f, 2.5f, 3.3f, 4.0f, 4.9f, 5.6f };
        float[] spotRadii = { 0.2f, 0.25f, 0.18f, 0.22f, 0.15f, 0.28f, 0.2f, 0.24f };
        for (int i = 0; i < 8; i++)
        {
            var spot = new MeshInstance3D();
            var spotMesh = new SphereMesh { Radius = spotSizes[i], Height = spotSizes[i] * 2f };
            spot.Mesh = spotMesh;
            spot.MaterialOverride = spotMat;
            spot.Position = new Vector3(
                Mathf.Cos(spotAngles[i]) * spotRadii[i],
                0.1f + (i % 2) * 0.04f,
                Mathf.Sin(spotAngles[i]) * spotRadii[i]
            );
            spot.Scale = new Vector3(1, 0.5f, 1);
            headNode.AddChild(spot);
        }

        // Top spot
        var topSpot = new MeshInstance3D();
        var topSpotMesh = new SphereMesh { Radius = 0.05f, Height = 0.1f };
        topSpot.Mesh = topSpotMesh;
        topSpot.MaterialOverride = spotMat;
        topSpot.Position = new Vector3(0, 0.2f, 0);
        topSpot.Scale = new Vector3(1, 0.4f, 1);
        headNode.AddChild(topSpot);

        // Eyes on stem - larger with pupils
        var eyeMesh = new SphereMesh { Radius = 0.05f, Height = 0.1f };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.09f, 0.38f, 0.08f);
        parent.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.09f, 0.38f, 0.08f);
        parent.AddChild(rightEye);

        // Pupils
        var pupilMesh = new SphereMesh { Radius = 0.02f, Height = 0.04f };
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.09f, 0.38f, 0.12f);
        parent.AddChild(leftPupil);

        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.09f, 0.38f, 0.12f);
        parent.AddChild(rightPupil);

        // Mouth
        var mouth = new MeshInstance3D();
        var mouthMesh = new SphereMesh { Radius = 0.03f, Height = 0.06f };
        mouth.Mesh = mouthMesh;
        mouth.MaterialOverride = mouthMat;
        mouth.Position = new Vector3(0, 0.3f, 0.11f);
        mouth.Scale = new Vector3(1.5f, 0.6f, 0.8f);
        parent.AddChild(mouth);

        // Little arms
        var armMesh = new CapsuleMesh { Radius = 0.025f, Height = 0.12f };

        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.12f, 0.28f, 0.02f);
        leftArmNode.RotationDegrees = new Vector3(0, 0, -45);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;
        var leftArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = stemMat };
        leftArmNode.AddChild(leftArm);

        // Left hand
        var handMesh = new SphereMesh { Radius = 0.02f, Height = 0.04f };
        var leftHand = new MeshInstance3D { Mesh = handMesh, MaterialOverride = stemMat };
        leftHand.Position = new Vector3(0, -0.07f, 0);
        leftArmNode.AddChild(leftHand);

        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.12f, 0.28f, 0.02f);
        rightArmNode.RotationDegrees = new Vector3(0, 0, 45);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;
        var rightArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = stemMat };
        rightArmNode.AddChild(rightArm);

        var rightHand = new MeshInstance3D { Mesh = handMesh, MaterialOverride = stemMat };
        rightHand.Position = new Vector3(0, -0.07f, 0);
        rightArmNode.AddChild(rightHand);

        // Little legs with feet
        var legMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.04f, Height = 0.15f };
        var footMesh = new SphereMesh { Radius = 0.04f, Height = 0.08f };

        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.1f, 0.08f, 0);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;
        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = stemMat };
        leftLegNode.AddChild(leftLeg);
        var leftFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = stemMat };
        leftFoot.Position = new Vector3(0, -0.08f, 0.02f);
        leftFoot.Scale = new Vector3(1, 0.5f, 1.3f);
        leftLegNode.AddChild(leftFoot);

        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.1f, 0.08f, 0);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;
        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = stemMat };
        rightLegNode.AddChild(rightLeg);
        var rightFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = stemMat };
        rightFoot.Position = new Vector3(0, -0.08f, 0.02f);
        rightFoot.Scale = new Vector3(1, 0.5f, 1.3f);
        rightLegNode.AddChild(rightFoot);

        // Spores floating around
        for (int i = 0; i < 5; i++)
        {
            float angle = i * Mathf.Pi * 2f / 5f + 0.5f;
            var spore = new MeshInstance3D();
            var sporeMesh = new SphereMesh { Radius = 0.015f, Height = 0.03f };
            spore.Mesh = sporeMesh;
            spore.MaterialOverride = sporeMat;
            spore.Position = new Vector3(
                Mathf.Cos(angle) * 0.4f,
                0.4f + i * 0.08f,
                Mathf.Sin(angle) * 0.4f
            );
            parent.AddChild(spore);
        }
    }

    /// <summary>
    /// Create an anatomically accurate Spider mesh with proper body segments, 8 legs,
    /// 8 eyes, chelicerae (fangs), pedipalps, and spinnerets.
    /// Supports size/color variation and multiple abdomen pattern types.
    /// </summary>
    private static void CreateSpiderMesh(Node3D parent, LimbNodes limbs, Color? colorOverride)
    {
        // Default color with variation support
        Color bodyColor = colorOverride ?? new Color(0.2f, 0.2f, 0.25f);

        // Add random color variation for natural look
        Random rng = new Random();
        float colorVariation = (float)(rng.NextDouble() * 0.1 - 0.05); // 5% variation
        bodyColor = new Color(
            Mathf.Clamp(bodyColor.R + colorVariation, 0f, 1f),
            Mathf.Clamp(bodyColor.G + colorVariation, 0f, 1f),
            Mathf.Clamp(bodyColor.B + colorVariation, 0f, 1f)
        );

        Color hairColor = bodyColor.Lightened(0.15f);
        Color patternColor = bodyColor.Lightened(0.3f);
        Color darkBodyColor = bodyColor.Darkened(0.2f);

        // Size variation (0.85x to 1.15x)
        float sizeVariation = 0.85f + (float)(rng.NextDouble() * 0.3);

        // Leg thickness variation
        float legThickness = 0.9f + (float)(rng.NextDouble() * 0.2);

        // Pattern type (0-2: different abdomen patterns)
        int patternType = rng.Next(0, 3);

        var bodyMat = new StandardMaterial3D { AlbedoColor = bodyColor, Roughness = 0.7f };
        var hairMat = new StandardMaterial3D { AlbedoColor = hairColor, Roughness = 0.9f };
        var darkBodyMat = new StandardMaterial3D { AlbedoColor = darkBodyColor, Roughness = 0.75f };
        var patternMat = new StandardMaterial3D { AlbedoColor = patternColor, Roughness = 0.8f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.9f, 0.2f, 0.2f),
            EmissionEnabled = true,
            Emission = new Color(1f, 0.2f, 0.2f) * 0.5f,
            Metallic = 0.3f
        };
        var fangMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.1f, 0.08f, 0.08f),
            Metallic = 0.3f,
            Roughness = 0.5f
        };

        // ABDOMEN (back body section) - larger, bulbous, anatomically accurate
        var abdomen = new MeshInstance3D();
        var abdomenMesh = new SphereMesh { Radius = 0.24f * sizeVariation, Height = 0.48f * sizeVariation, RadialSegments = 28, Rings = 20 };
        abdomen.Mesh = abdomenMesh;
        abdomen.MaterialOverride = bodyMat;
        abdomen.Position = new Vector3(0, 0.32f * sizeVariation, -0.24f * sizeVariation);
        abdomen.Scale = new Vector3(0.95f, 0.75f, 1.18f); // More bulbous
        parent.AddChild(abdomen);

        // Abdomen breathing/animation offset
        abdomen.Position += new Vector3(0, (float)(rng.NextDouble() * 0.01 - 0.005), 0);

        // Abdomen pattern markings (3 different pattern types)
        switch (patternType)
        {
            case 0: // Classic stripe pattern
                var stripeMesh = new SphereMesh { Radius = 0.07f * sizeVariation, Height = 0.14f * sizeVariation, RadialSegments = 16, Rings = 12 };
                for (int i = 0; i < 3; i++)
                {
                    var stripe = new MeshInstance3D { Mesh = stripeMesh, MaterialOverride = patternMat };
                    stripe.Position = new Vector3(0, 0.38f * sizeVariation, (-0.28f - i * 0.08f) * sizeVariation);
                    stripe.Scale = new Vector3(0.8f, 0.4f, 0.6f);
                    parent.AddChild(stripe);
                }
                break;
            case 1: // Spotted pattern (widow-like)
                var spotMesh = new SphereMesh { Radius = 0.05f * sizeVariation, Height = 0.1f * sizeVariation };
                var centerSpot = new MeshInstance3D { Mesh = spotMesh, MaterialOverride = patternMat };
                centerSpot.Position = new Vector3(0, 0.4f * sizeVariation, -0.32f * sizeVariation);
                parent.AddChild(centerSpot);
                // Side spots
                var leftSpot = new MeshInstance3D { Mesh = spotMesh, MaterialOverride = patternMat };
                leftSpot.Position = new Vector3(-0.08f * sizeVariation, 0.36f * sizeVariation, -0.38f * sizeVariation);
                leftSpot.Scale = new Vector3(0.7f, 0.7f, 0.7f);
                parent.AddChild(leftSpot);
                var rightSpot = new MeshInstance3D { Mesh = spotMesh, MaterialOverride = patternMat };
                rightSpot.Position = new Vector3(0.08f * sizeVariation, 0.36f * sizeVariation, -0.38f * sizeVariation);
                rightSpot.Scale = new Vector3(0.7f, 0.7f, 0.7f);
                parent.AddChild(rightSpot);
                break;
            case 2: // Banded pattern (tarantula-like)
                var bandMesh = new CylinderMesh { TopRadius = 0.18f * sizeVariation, BottomRadius = 0.18f * sizeVariation, Height = 0.06f * sizeVariation };
                var band1 = new MeshInstance3D { Mesh = bandMesh, MaterialOverride = darkBodyMat };
                band1.Position = new Vector3(0, 0.38f * sizeVariation, -0.3f * sizeVariation);
                band1.RotationDegrees = new Vector3(90, 0, 0);
                band1.Scale = new Vector3(0.9f, 1.2f, 0.7f);
                parent.AddChild(band1);
                var band2 = new MeshInstance3D { Mesh = bandMesh, MaterialOverride = darkBodyMat };
                band2.Position = new Vector3(0, 0.32f * sizeVariation, -0.4f * sizeVariation);
                band2.RotationDegrees = new Vector3(90, 0, 0);
                band2.Scale = new Vector3(0.85f, 1f, 0.6f);
                parent.AddChild(band2);
                break;
        }

        // Spinnerets at rear (3 pairs for anatomical accuracy)
        var spinneretMesh = new CylinderMesh { TopRadius = 0.012f * sizeVariation, BottomRadius = 0.022f * sizeVariation, Height = 0.05f * sizeVariation, RadialSegments = 8 };
        for (int i = 0; i < 3; i++)
        {
            float xOffset = (i - 1) * 0.025f * sizeVariation;
            var spinneret = new MeshInstance3D { Mesh = spinneretMesh, MaterialOverride = bodyMat };
            spinneret.Position = new Vector3(xOffset, 0.26f * sizeVariation, -0.42f * sizeVariation);
            spinneret.RotationDegrees = new Vector3(-75 + i * 5, 0, 0);
            parent.AddChild(spinneret);
        }

        // CEPHALOTHORAX (front body/head section) - proper shape and detail
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.32f * sizeVariation, 0.09f * sizeVariation);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var cephalo = new MeshInstance3D();
        var cephaloMesh = new SphereMesh { Radius = 0.17f * sizeVariation, Height = 0.34f * sizeVariation, RadialSegments = 24, Rings = 18 };
        cephalo.Mesh = cephaloMesh;
        cephalo.MaterialOverride = bodyMat;
        cephalo.Scale = new Vector3(1.05f, 0.8f, 1.15f); // Wider, flatter
        headNode.AddChild(cephalo);

        // Carapace detail (darker top section)
        var carapace = new MeshInstance3D();
        var carapaceMesh = new SphereMesh { Radius = 0.14f * sizeVariation, Height = 0.28f * sizeVariation, RadialSegments = 20, Rings = 14 };
        carapace.Mesh = carapaceMesh;
        carapace.MaterialOverride = darkBodyMat;
        carapace.Position = new Vector3(0, 0.04f, 0);
        carapace.Scale = new Vector3(0.9f, 0.6f, 0.95f);
        headNode.AddChild(carapace);

        // 8 EYES - proper spider arrangement (2 large primary, 6 smaller secondary)
        var largeEyeMesh = new SphereMesh { Radius = 0.032f * sizeVariation, Height = 0.064f * sizeVariation, RadialSegments = 20, Rings = 14 };
        var mediumEyeMesh = new SphereMesh { Radius = 0.024f * sizeVariation, Height = 0.048f * sizeVariation, RadialSegments = 16, Rings = 12 };
        var smallEyeMesh = new SphereMesh { Radius = 0.018f * sizeVariation, Height = 0.036f * sizeVariation, RadialSegments = 12, Rings = 10 };

        // Front row - 2 large principal eyes (forward-facing)
        var eye1 = new MeshInstance3D { Mesh = largeEyeMesh, MaterialOverride = eyeMat };
        eye1.Position = new Vector3(-0.045f * sizeVariation, 0.05f, 0.13f * sizeVariation);
        headNode.AddChild(eye1);
        var eye2 = new MeshInstance3D { Mesh = largeEyeMesh, MaterialOverride = eyeMat };
        eye2.Position = new Vector3(0.045f * sizeVariation, 0.05f, 0.13f * sizeVariation);
        headNode.AddChild(eye2);

        // Middle row - 2 medium lateral eyes
        var eye3 = new MeshInstance3D { Mesh = mediumEyeMesh, MaterialOverride = eyeMat };
        eye3.Position = new Vector3(-0.08f * sizeVariation, 0.07f, 0.09f * sizeVariation);
        headNode.AddChild(eye3);
        var eye4 = new MeshInstance3D { Mesh = mediumEyeMesh, MaterialOverride = eyeMat };
        eye4.Position = new Vector3(0.08f * sizeVariation, 0.07f, 0.09f * sizeVariation);
        headNode.AddChild(eye4);

        // Back row - 4 small posterior eyes
        var eye5 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye5.Position = new Vector3(-0.07f * sizeVariation, 0.1f, 0.04f * sizeVariation);
        headNode.AddChild(eye5);
        var eye6 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye6.Position = new Vector3(-0.025f * sizeVariation, 0.11f, 0.05f * sizeVariation);
        headNode.AddChild(eye6);
        var eye7 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye7.Position = new Vector3(0.025f * sizeVariation, 0.11f, 0.05f * sizeVariation);
        headNode.AddChild(eye7);
        var eye8 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye8.Position = new Vector3(0.07f * sizeVariation, 0.1f, 0.04f * sizeVariation);
        headNode.AddChild(eye8);

        // CHELICERAE (fangs) - anatomically accurate with joints
        // Base chelicerae segment
        var cheliceraeMesh = new CylinderMesh { TopRadius = 0.018f * sizeVariation, BottomRadius = 0.024f * sizeVariation, Height = 0.06f * sizeVariation, RadialSegments = 12 };
        var leftChelicerae = new MeshInstance3D { Mesh = cheliceraeMesh, MaterialOverride = darkBodyMat };
        leftChelicerae.Position = new Vector3(-0.035f * sizeVariation, -0.01f, 0.13f * sizeVariation);
        leftChelicerae.RotationDegrees = new Vector3(15, 0, 0);
        headNode.AddChild(leftChelicerae);
        var rightChelicerae = new MeshInstance3D { Mesh = cheliceraeMesh, MaterialOverride = darkBodyMat };
        rightChelicerae.Position = new Vector3(0.035f * sizeVariation, -0.01f, 0.13f * sizeVariation);
        rightChelicerae.RotationDegrees = new Vector3(15, 0, 0);
        headNode.AddChild(rightChelicerae);

        // Fangs (curved, pointed)
        var fangMesh = new CylinderMesh { TopRadius = 0.006f * sizeVariation, BottomRadius = 0.016f * sizeVariation, Height = 0.09f * sizeVariation, RadialSegments = 10 };
        var leftFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = fangMat };
        leftFang.Position = new Vector3(-0.035f * sizeVariation, -0.04f, 0.14f * sizeVariation);
        leftFang.RotationDegrees = new Vector3(30, 0, 8);
        headNode.AddChild(leftFang);
        var rightFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = fangMat };
        rightFang.Position = new Vector3(0.035f * sizeVariation, -0.04f, 0.14f * sizeVariation);
        rightFang.RotationDegrees = new Vector3(30, 0, -8);
        headNode.AddChild(rightFang);

        // PEDIPALPS (sensory appendages near mouth) - 2 segments each
        var palpSegment1Mesh = new CylinderMesh { TopRadius = 0.014f * sizeVariation, BottomRadius = 0.019f * sizeVariation, Height = 0.07f * sizeVariation, RadialSegments = 10 };
        var palpSegment2Mesh = new CylinderMesh { TopRadius = 0.01f * sizeVariation, BottomRadius = 0.013f * sizeVariation, Height = 0.06f * sizeVariation, RadialSegments = 8 };

        // Left pedipalp
        var leftPalp1 = new MeshInstance3D { Mesh = palpSegment1Mesh, MaterialOverride = bodyMat };
        leftPalp1.Position = new Vector3(-0.07f * sizeVariation, -0.01f, 0.11f * sizeVariation);
        leftPalp1.RotationDegrees = new Vector3(-25, -15, 0);
        headNode.AddChild(leftPalp1);
        var leftPalp2 = new MeshInstance3D { Mesh = palpSegment2Mesh, MaterialOverride = bodyMat };
        leftPalp2.Position = new Vector3(-0.1f * sizeVariation, -0.04f, 0.13f * sizeVariation);
        leftPalp2.RotationDegrees = new Vector3(-35, -10, 0);
        headNode.AddChild(leftPalp2);

        // Right pedipalp
        var rightPalp1 = new MeshInstance3D { Mesh = palpSegment1Mesh, MaterialOverride = bodyMat };
        rightPalp1.Position = new Vector3(0.07f * sizeVariation, -0.01f, 0.11f * sizeVariation);
        rightPalp1.RotationDegrees = new Vector3(-25, 15, 0);
        headNode.AddChild(rightPalp1);
        var rightPalp2 = new MeshInstance3D { Mesh = palpSegment2Mesh, MaterialOverride = bodyMat };
        rightPalp2.Position = new Vector3(0.1f * sizeVariation, -0.04f, 0.13f * sizeVariation);
        rightPalp2.RotationDegrees = new Vector3(-35, 10, 0);
        headNode.AddChild(rightPalp2);

        // 8 LEGS - anatomically accurate with 3 segments each (coxa, femur, tarsus)
        // Proper spider leg placement and proportions
        var coxaMesh = new CylinderMesh {
            TopRadius = 0.026f * sizeVariation * legThickness,
            BottomRadius = 0.022f * sizeVariation * legThickness,
            Height = 0.18f * sizeVariation,
            RadialSegments = 14, Rings = 6
        };
        var femurMesh = new CylinderMesh {
            TopRadius = 0.022f * sizeVariation * legThickness,
            BottomRadius = 0.015f * sizeVariation * legThickness,
            Height = 0.24f * sizeVariation,
            RadialSegments = 12, Rings = 8
        };
        var tarsusMesh = new CylinderMesh {
            TopRadius = 0.013f * sizeVariation * legThickness,
            BottomRadius = 0.008f * sizeVariation * legThickness,
            Height = 0.14f * sizeVariation,
            RadialSegments = 10, Rings = 6
        };

        // Leg positions (front to back attachment points)
        float[] legZPositions = { 0.07f, 0.02f, -0.04f, -0.1f };
        float[] legOutAngles = { 60f, 45f, 45f, 60f }; // Spread angle
        float[] legForwardAngles = { 25f, 10f, -5f, -25f }; // Forward/back tilt

        for (int side = -1; side <= 1; side += 2)
        {
            for (int i = 0; i < 4; i++)
            {
                // Main leg node (root joint)
                var legNode = new Node3D();
                legNode.Position = new Vector3(side * 0.11f * sizeVariation, 0.32f * sizeVariation, legZPositions[i] * sizeVariation);
                legNode.RotationDegrees = new Vector3(legForwardAngles[i], 0, side * legOutAngles[i]);
                parent.AddChild(legNode);

                // Coxa (base segment attached to body)
                var coxa = new MeshInstance3D { Mesh = coxaMesh, MaterialOverride = bodyMat };
                coxa.Position = new Vector3(side * 0.09f * sizeVariation, 0, 0);
                legNode.AddChild(coxa);

                // Coxa-femur joint
                var joint1Mesh = new SphereMesh { Radius = 0.024f * sizeVariation * legThickness, Height = 0.048f * sizeVariation * legThickness, RadialSegments = 12, Rings = 8 };
                var joint1 = new MeshInstance3D { Mesh = joint1Mesh, MaterialOverride = darkBodyMat };
                joint1.Position = new Vector3(side * 0.18f * sizeVariation, -0.01f, 0);
                legNode.AddChild(joint1);

                // Femur (main leg segment)
                var femur = new MeshInstance3D { Mesh = femurMesh, MaterialOverride = bodyMat };
                femur.Position = new Vector3(side * 0.3f * sizeVariation, -0.08f, 0);
                femur.RotationDegrees = new Vector3(0, 0, side * -22);
                legNode.AddChild(femur);

                // Femur-tarsus joint
                var joint2Mesh = new SphereMesh { Radius = 0.018f * sizeVariation * legThickness, Height = 0.036f * sizeVariation * legThickness, RadialSegments = 10, Rings = 6 };
                var joint2 = new MeshInstance3D { Mesh = joint2Mesh, MaterialOverride = darkBodyMat };
                joint2.Position = new Vector3(side * 0.41f * sizeVariation, -0.17f, 0);
                legNode.AddChild(joint2);

                // Tarsus (foot/tip segment)
                var tarsus = new MeshInstance3D { Mesh = tarsusMesh, MaterialOverride = bodyMat };
                tarsus.Position = new Vector3(side * 0.48f * sizeVariation, -0.25f, 0);
                tarsus.RotationDegrees = new Vector3(0, 0, side * -30);
                legNode.AddChild(tarsus);

                // Foot claws (tiny hooks at tip)
                var clawMesh = new CylinderMesh { TopRadius = 0.002f * sizeVariation, BottomRadius = 0.005f * sizeVariation, Height = 0.02f * sizeVariation };
                var claw = new MeshInstance3D { Mesh = clawMesh, MaterialOverride = fangMat };
                claw.Position = new Vector3(side * 0.55f * sizeVariation, -0.32f, 0);
                claw.RotationDegrees = new Vector3(0, 0, side * -45);
                legNode.AddChild(claw);

                // Hair/spines on legs (detailed)
                for (int h = 0; h < 4; h++)
                {
                    var hairMesh = new CylinderMesh {
                        TopRadius = 0.001f * sizeVariation,
                        BottomRadius = 0.003f * sizeVariation,
                        Height = 0.025f * sizeVariation,
                        RadialSegments = 6
                    };
                    var hair = new MeshInstance3D { Mesh = hairMesh, MaterialOverride = hairMat };
                    float hairPos = 0.1f + h * 0.12f;
                    hair.Position = new Vector3(side * hairPos * sizeVariation, 0.01f, (float)(rng.NextDouble() * 0.01 - 0.005));
                    hair.RotationDegrees = new Vector3(0, 0, side * 15 + (float)(rng.NextDouble() * 10));
                    legNode.AddChild(hair);
                }

                // Store first and last pair for animation
                if (i == 0)
                {
                    if (side == -1) limbs.LeftArm = legNode;
                    else limbs.RightArm = legNode;
                }
                else if (i == 3)
                {
                    if (side == -1) limbs.LeftLeg = legNode;
                    else limbs.RightLeg = legNode;
                }
            }
        }
    }

    private static void CreateLizardMesh(Node3D parent, LimbNodes limbs, Color? colorOverride)
    {
        // Variation parameters
        var random = new Random();
        float sizeVariation = 0.9f + (float)random.NextDouble() * 0.25f; // 0.9-1.15x
        bool hasFrill = random.NextDouble() > 0.5f;
        float spineRidgeSize = 0.8f + (float)random.NextDouble() * 0.4f; // 0.8-1.2x
        float tailLength = 0.9f + (float)random.NextDouble() * 0.3f; // 0.9-1.2x

        // Color variations
        Color scaleColor = colorOverride ?? GetRandomLizardScaleColor(random);
        Color bellyColor = scaleColor.Lightened(0.3f);
        Color clawColor = new Color(0.2f, 0.15f, 0.1f);
        Color tongueColor = new Color(0.9f, 0.3f, 0.4f);

        // LOD determination (based on distance - placeholder, would be set by caller)
        int lodLevel = 0; // 0 = high, 1 = medium, 2 = low

        var scaleMat = new StandardMaterial3D { AlbedoColor = scaleColor, Roughness = 0.6f, Metallic = 0.1f };
        var bellyMat = new StandardMaterial3D { AlbedoColor = bellyColor, Roughness = 0.7f };
        var darkScaleMat = new StandardMaterial3D { AlbedoColor = scaleColor.Darkened(0.2f), Roughness = 0.5f, Metallic = 0.15f };
        var clawMat = new StandardMaterial3D { AlbedoColor = clawColor, Roughness = 0.4f };
        var tongueMat = new StandardMaterial3D { AlbedoColor = tongueColor, Roughness = 0.3f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.9f, 0.8f, 0.2f),
            EmissionEnabled = true,
            Emission = new Color(0.9f, 0.7f, 0.1f) * 0.3f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };

        // Body - muscular humanoid torso
        var body = new MeshInstance3D();
        var bodyMesh = new CapsuleMesh { Radius = 0.2f * sizeVariation, Height = 0.6f * sizeVariation };
        body.Mesh = bodyMesh;
        body.MaterialOverride = scaleMat;
        body.Position = new Vector3(0, 0.5f * sizeVariation, 0);
        body.Scale = new Vector3(0.8f, 1f, 1f);
        parent.AddChild(body);

        // Belly - lighter colored underbelly
        var belly = new MeshInstance3D();
        var bellyMesh = new CapsuleMesh { Radius = 0.15f * sizeVariation, Height = 0.4f * sizeVariation };
        belly.Mesh = bellyMesh;
        belly.MaterialOverride = bellyMat;
        belly.Position = new Vector3(0, 0.45f * sizeVariation, 0.08f * sizeVariation);
        belly.Scale = new Vector3(0.8f, 1f, 0.6f);
        parent.AddChild(belly);

        // Enhanced spine ridges along back (LOD high/medium only)
        if (lodLevel < 2)
        {
            int ridgeCount = lodLevel == 0 ? 8 : 5; // More detail at high LOD
            for (int i = 0; i < ridgeCount; i++)
            {
                var ridge = new MeshInstance3D();
                float ridgeSize = (0.005f + i * 0.002f) * spineRidgeSize * sizeVariation;
                var ridgeMesh = new CylinderMesh
                {
                    TopRadius = ridgeSize * 0.3f,
                    BottomRadius = ridgeSize * 1.2f,
                    Height = 0.06f * spineRidgeSize * sizeVariation
                };
                ridge.Mesh = ridgeMesh;
                ridge.MaterialOverride = darkScaleMat;
                ridge.Position = new Vector3(0, (0.65f - i * 0.05f) * sizeVariation, (-0.15f + i * 0.015f) * sizeVariation);
                ridge.RotationDegrees = new Vector3(-25 - i * 2, 0, 0);
                parent.AddChild(ridge);
            }
        }

        // Scale texture suggestion (visual detail bumps) - high LOD only
        if (lodLevel == 0)
        {
            // Add small scale bumps on shoulders and chest
            for (int sx = -1; sx <= 1; sx += 2)
            {
                for (int i = 0; i < 3; i++)
                {
                    var scaleBump = new MeshInstance3D();
                    var bumpMesh = new SphereMesh { Radius = 0.015f * sizeVariation, Height = 0.008f * sizeVariation };
                    scaleBump.Mesh = bumpMesh;
                    scaleBump.MaterialOverride = darkScaleMat;
                    scaleBump.Position = new Vector3(sx * (0.12f + i * 0.02f) * sizeVariation, (0.62f - i * 0.04f) * sizeVariation, 0.06f * sizeVariation);
                    parent.AddChild(scaleBump);
                }
            }
        }

        // Head - reptilian with separate neck
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.85f * sizeVariation, 0.1f * sizeVariation);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        // Neck (separate for animation)
        var neck = new MeshInstance3D();
        var neckMesh = new CylinderMesh { TopRadius = 0.08f * sizeVariation, BottomRadius = 0.1f * sizeVariation, Height = 0.12f * sizeVariation };
        neck.Mesh = neckMesh;
        neck.MaterialOverride = scaleMat;
        neck.Position = new Vector3(0, -0.08f * sizeVariation, -0.02f * sizeVariation);
        headNode.AddChild(neck);

        var head = new MeshInstance3D();
        var headMesh = new SphereMesh { Radius = 0.15f * sizeVariation, Height = 0.3f * sizeVariation };
        head.Mesh = headMesh;
        head.MaterialOverride = scaleMat;
        head.Scale = new Vector3(0.9f, 0.8f, 1.1f);
        headNode.AddChild(head);

        // Neck frill (optional variation)
        if (hasFrill && lodLevel < 2)
        {
            for (int side = -1; side <= 1; side += 2)
            {
                for (int i = 0; i < 4; i++)
                {
                    var frillSegment = new MeshInstance3D();
                    var frillMesh = new CylinderMesh
                    {
                        TopRadius = 0.001f * sizeVariation,
                        BottomRadius = 0.025f * sizeVariation,
                        Height = 0.08f * sizeVariation
                    };
                    frillSegment.Mesh = frillMesh;
                    frillSegment.MaterialOverride = new StandardMaterial3D
                    {
                        AlbedoColor = new Color(scaleColor.Lightened(0.2f), 0.8f),
                        Roughness = 0.5f,
                        Transparency = BaseMaterial3D.TransparencyEnum.Alpha
                    };
                    frillSegment.Position = new Vector3(side * (0.08f + i * 0.02f) * sizeVariation, -0.02f * sizeVariation, -0.05f * sizeVariation);
                    frillSegment.RotationDegrees = new Vector3(10, side * (60 + i * 15), 0);
                    headNode.AddChild(frillSegment);
                }
            }
        }

        // Head ridges - more prominent
        if (lodLevel < 2)
        {
            int ridgeCount = lodLevel == 0 ? 5 : 3;
            for (int i = 0; i < ridgeCount; i++)
            {
                var ridge = new MeshInstance3D();
                var ridgeMesh = new CylinderMesh
                {
                    TopRadius = (0.005f + i * 0.003f) * spineRidgeSize * sizeVariation,
                    BottomRadius = (0.012f + i * 0.005f) * spineRidgeSize * sizeVariation,
                    Height = 0.05f * spineRidgeSize * sizeVariation
                };
                ridge.Mesh = ridgeMesh;
                ridge.MaterialOverride = darkScaleMat;
                ridge.Position = new Vector3(0, (0.08f - i * 0.015f) * sizeVariation, (-0.02f - i * 0.03f) * sizeVariation);
                ridge.RotationDegrees = new Vector3(-15 - i * 5, 0, 0);
                headNode.AddChild(ridge);
            }
        }

        // Snout - prominent reptilian
        var snout = new MeshInstance3D();
        var snoutMesh = new CylinderMesh
        {
            TopRadius = 0.04f * sizeVariation,
            BottomRadius = 0.08f * sizeVariation,
            Height = 0.15f * sizeVariation
        };
        snout.Mesh = snoutMesh;
        snout.MaterialOverride = scaleMat;
        snout.Position = new Vector3(0, -0.02f * sizeVariation, 0.12f * sizeVariation);
        snout.RotationDegrees = new Vector3(-70, 0, 0);
        headNode.AddChild(snout);

        // Nostrils - high LOD only
        if (lodLevel == 0)
        {
            var nostrilMesh = new SphereMesh { Radius = 0.012f * sizeVariation, Height = 0.024f * sizeVariation };
            var nostrilMat = new StandardMaterial3D { AlbedoColor = scaleColor.Darkened(0.4f) };
            var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
            leftNostril.Position = new Vector3(-0.025f * sizeVariation, 0.02f * sizeVariation, 0.22f * sizeVariation);
            headNode.AddChild(leftNostril);

            var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
            rightNostril.Position = new Vector3(0.025f * sizeVariation, 0.02f * sizeVariation, 0.22f * sizeVariation);
            headNode.AddChild(rightNostril);

            // Forked tongue - high LOD only
            var tongue = new MeshInstance3D();
            var tongueMesh = new CylinderMesh
            {
                TopRadius = 0.003f * sizeVariation,
                BottomRadius = 0.008f * sizeVariation,
                Height = 0.08f * sizeVariation
            };
            tongue.Mesh = tongueMesh;
            tongue.MaterialOverride = tongueMat;
            tongue.Position = new Vector3(0, -0.04f * sizeVariation, 0.2f * sizeVariation);
            tongue.RotationDegrees = new Vector3(-80, 0, 0);
            headNode.AddChild(tongue);

            // Tongue forks
            var forkMesh = new CylinderMesh
            {
                TopRadius = 0.001f * sizeVariation,
                BottomRadius = 0.003f * sizeVariation,
                Height = 0.03f * sizeVariation
            };
            var leftFork = new MeshInstance3D { Mesh = forkMesh, MaterialOverride = tongueMat };
            leftFork.Position = new Vector3(-0.008f * sizeVariation, -0.04f * sizeVariation, 0.26f * sizeVariation);
            leftFork.RotationDegrees = new Vector3(-75, 0, -20);
            headNode.AddChild(leftFork);

            var rightFork = new MeshInstance3D { Mesh = forkMesh, MaterialOverride = tongueMat };
            rightFork.Position = new Vector3(0.008f * sizeVariation, -0.04f * sizeVariation, 0.26f * sizeVariation);
            rightFork.RotationDegrees = new Vector3(-75, 0, 20);
            headNode.AddChild(rightFork);
        }

        // Eyes with slit pupils (reptilian)
        var eyeMesh = new SphereMesh { Radius = 0.045f * sizeVariation, Height = 0.09f * sizeVariation };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.09f * sizeVariation, 0.04f * sizeVariation, 0.06f * sizeVariation);
        headNode.AddChild(leftEye);

        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.09f * sizeVariation, 0.04f * sizeVariation, 0.06f * sizeVariation);
        headNode.AddChild(rightEye);

        // Slit pupils - vertical like a reptile
        var slitMesh = new SphereMesh { Radius = 0.02f * sizeVariation, Height = 0.04f * sizeVariation };
        var leftPupil = new MeshInstance3D { Mesh = slitMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.09f * sizeVariation, 0.04f * sizeVariation, 0.1f * sizeVariation);
        leftPupil.Scale = new Vector3(0.3f, 1.2f, 1f);
        headNode.AddChild(leftPupil);

        var rightPupil = new MeshInstance3D { Mesh = slitMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.09f * sizeVariation, 0.04f * sizeVariation, 0.1f * sizeVariation);
        rightPupil.Scale = new Vector3(0.3f, 1.2f, 1f);
        headNode.AddChild(rightPupil);

        // Tail - multi-segment for balance animation
        float tailY = 0.3f * sizeVariation;
        float tailZ = -0.2f * sizeVariation;
        float tailAngle = -40f;
        int tailSegments = lodLevel == 0 ? 6 : (lodLevel == 1 ? 4 : 2);

        for (int i = 0; i < tailSegments; i++)
        {
            var tailSeg = new MeshInstance3D();
            float segRadius = (0.08f - i * 0.014f) * sizeVariation * tailLength;
            var tailMesh = new CylinderMesh
            {
                TopRadius = segRadius * 0.7f,
                BottomRadius = segRadius,
                Height = 0.12f * sizeVariation * tailLength
            };
            tailSeg.Mesh = tailMesh;
            tailSeg.MaterialOverride = scaleMat;
            tailSeg.Position = new Vector3(0, tailY, tailZ);
            tailSeg.RotationDegrees = new Vector3(tailAngle, 0, 0);
            parent.AddChild(tailSeg);

            // Add small spine ridges along tail (high LOD only)
            if (lodLevel == 0 && i % 2 == 0 && i < 4)
            {
                var tailRidge = new MeshInstance3D();
                var tailRidgeMesh = new CylinderMesh
                {
                    TopRadius = 0.002f * sizeVariation * spineRidgeSize,
                    BottomRadius = 0.008f * sizeVariation * spineRidgeSize,
                    Height = 0.03f * sizeVariation * spineRidgeSize
                };
                tailRidge.Mesh = tailRidgeMesh;
                tailRidge.MaterialOverride = darkScaleMat;
                tailRidge.Position = new Vector3(0, tailY + 0.06f * sizeVariation, tailZ - 0.03f * sizeVariation);
                tailRidge.RotationDegrees = new Vector3(tailAngle - 20, 0, 0);
                parent.AddChild(tailRidge);
            }

            // Update for next segment
            tailY -= 0.06f * sizeVariation * tailLength;
            tailZ -= 0.08f * sizeVariation * tailLength;
            tailAngle -= 6f;
        }

        // Tail tip - sharp point
        var tailTip = new MeshInstance3D();
        var tipMesh = new CylinderMesh
        {
            TopRadius = 0.002f * sizeVariation,
            BottomRadius = 0.015f * sizeVariation * tailLength,
            Height = 0.1f * sizeVariation * tailLength
        };
        tailTip.Mesh = tipMesh;
        tailTip.MaterialOverride = scaleMat;
        tailTip.Position = new Vector3(0, tailY - 0.02f * sizeVariation, tailZ - 0.04f * sizeVariation);
        tailTip.RotationDegrees = new Vector3(tailAngle, 0, 0);
        parent.AddChild(tailTip);

        // Arms with claws - muscular, separate elbows for animation
        var armMesh = new CapsuleMesh { Radius = 0.04f * sizeVariation, Height = 0.2f * sizeVariation };
        var forearmMesh = new CapsuleMesh { Radius = 0.03f * sizeVariation, Height = 0.12f * sizeVariation };

        // Left arm
        var leftArmNode = new Node3D();
        leftArmNode.Position = new Vector3(-0.18f * sizeVariation, 0.48f * sizeVariation, 0.05f * sizeVariation);
        leftArmNode.RotationDegrees = new Vector3(0, 0, -40);
        parent.AddChild(leftArmNode);
        limbs.LeftArm = leftArmNode;
        var leftArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = scaleMat };
        leftArmNode.AddChild(leftArm);

        // Left shoulder muscle (high LOD only)
        if (lodLevel == 0)
        {
            var leftShoulder = new MeshInstance3D();
            var shoulderMesh = new SphereMesh { Radius = 0.05f * sizeVariation, Height = 0.1f * sizeVariation };
            leftShoulder.Mesh = shoulderMesh;
            leftShoulder.MaterialOverride = scaleMat;
            leftShoulder.Position = new Vector3(0, 0.02f * sizeVariation, 0);
            leftArmNode.AddChild(leftShoulder);
        }

        // Left forearm with elbow joint
        var leftForearm = new MeshInstance3D { Mesh = forearmMesh, MaterialOverride = scaleMat };
        leftForearm.Position = new Vector3(-0.04f * sizeVariation, -0.12f * sizeVariation, 0);
        leftForearm.RotationDegrees = new Vector3(0, 0, 30);
        leftArmNode.AddChild(leftForearm);
        AddLizardClaws(leftArmNode, clawMat, new Vector3(-0.06f * sizeVariation, -0.2f * sizeVariation, 0), true, sizeVariation, lodLevel);

        // Right arm
        var rightArmNode = new Node3D();
        rightArmNode.Position = new Vector3(0.18f * sizeVariation, 0.48f * sizeVariation, 0.05f * sizeVariation);
        rightArmNode.RotationDegrees = new Vector3(0, 0, 40);
        parent.AddChild(rightArmNode);
        limbs.RightArm = rightArmNode;
        var rightArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = scaleMat };
        rightArmNode.AddChild(rightArm);

        // Right shoulder muscle (high LOD only)
        if (lodLevel == 0)
        {
            var rightShoulder = new MeshInstance3D();
            var shoulderMesh = new SphereMesh { Radius = 0.05f * sizeVariation, Height = 0.1f * sizeVariation };
            rightShoulder.Mesh = shoulderMesh;
            rightShoulder.MaterialOverride = scaleMat;
            rightShoulder.Position = new Vector3(0, 0.02f * sizeVariation, 0);
            rightArmNode.AddChild(rightShoulder);
        }

        // Right forearm with elbow joint
        var rightForearm = new MeshInstance3D { Mesh = forearmMesh, MaterialOverride = scaleMat };
        rightForearm.Position = new Vector3(0.04f * sizeVariation, -0.12f * sizeVariation, 0);
        rightForearm.RotationDegrees = new Vector3(0, 0, -30);
        rightArmNode.AddChild(rightForearm);
        AddLizardClaws(rightArmNode, clawMat, new Vector3(0.06f * sizeVariation, -0.2f * sizeVariation, 0), false, sizeVariation, lodLevel);

        // Legs - digitigrade (lizard-like) with separate knee joints
        var legMesh = new CapsuleMesh { Radius = 0.05f * sizeVariation, Height = 0.22f * sizeVariation };
        var calfMesh = new CapsuleMesh { Radius = 0.04f * sizeVariation, Height = 0.15f * sizeVariation };

        // Left leg - digitigrade stance
        var leftLegNode = new Node3D();
        leftLegNode.Position = new Vector3(-0.14f * sizeVariation, 0.22f * sizeVariation, -0.05f * sizeVariation);
        leftLegNode.RotationDegrees = new Vector3(15, 0, -15);
        parent.AddChild(leftLegNode);
        limbs.LeftLeg = leftLegNode;
        var leftLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = scaleMat };
        leftLegNode.AddChild(leftLeg);

        // Left knee joint (high LOD only)
        if (lodLevel == 0)
        {
            var leftKnee = new MeshInstance3D();
            var kneeMesh = new SphereMesh { Radius = 0.045f * sizeVariation, Height = 0.09f * sizeVariation };
            leftKnee.Mesh = kneeMesh;
            leftKnee.MaterialOverride = scaleMat;
            leftKnee.Position = new Vector3(-0.02f * sizeVariation, -0.11f * sizeVariation, 0);
            leftLegNode.AddChild(leftKnee);
        }

        // Left calf - angled for digitigrade posture
        var leftCalf = new MeshInstance3D { Mesh = calfMesh, MaterialOverride = scaleMat };
        leftCalf.Position = new Vector3(-0.02f * sizeVariation, -0.15f * sizeVariation, 0.03f * sizeVariation);
        leftCalf.RotationDegrees = new Vector3(-35, 0, 10);
        leftLegNode.AddChild(leftCalf);

        // Left foot - elongated lizard foot
        var footMesh = new SphereMesh { Radius = 0.04f * sizeVariation, Height = 0.08f * sizeVariation };
        var leftFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = scaleMat };
        leftFoot.Position = new Vector3(-0.02f * sizeVariation, -0.22f * sizeVariation, 0.06f * sizeVariation);
        leftFoot.Scale = new Vector3(1, 0.5f, 1.8f); // Longer for digitigrade
        leftLegNode.AddChild(leftFoot);
        AddLizardClaws(leftLegNode, clawMat, new Vector3(-0.02f * sizeVariation, -0.24f * sizeVariation, 0.1f * sizeVariation), true, sizeVariation, lodLevel);

        // Right leg - digitigrade stance
        var rightLegNode = new Node3D();
        rightLegNode.Position = new Vector3(0.14f * sizeVariation, 0.22f * sizeVariation, -0.05f * sizeVariation);
        rightLegNode.RotationDegrees = new Vector3(15, 0, 15);
        parent.AddChild(rightLegNode);
        limbs.RightLeg = rightLegNode;
        var rightLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = scaleMat };
        rightLegNode.AddChild(rightLeg);

        // Right knee joint (high LOD only)
        if (lodLevel == 0)
        {
            var rightKnee = new MeshInstance3D();
            var kneeMesh = new SphereMesh { Radius = 0.045f * sizeVariation, Height = 0.09f * sizeVariation };
            rightKnee.Mesh = kneeMesh;
            rightKnee.MaterialOverride = scaleMat;
            rightKnee.Position = new Vector3(0.02f * sizeVariation, -0.11f * sizeVariation, 0);
            rightLegNode.AddChild(rightKnee);
        }

        // Right calf - angled for digitigrade posture
        var rightCalf = new MeshInstance3D { Mesh = calfMesh, MaterialOverride = scaleMat };
        rightCalf.Position = new Vector3(0.02f * sizeVariation, -0.15f * sizeVariation, 0.03f * sizeVariation);
        rightCalf.RotationDegrees = new Vector3(-35, 0, -10);
        rightLegNode.AddChild(rightCalf);

        // Right foot - elongated lizard foot
        var rightFoot = new MeshInstance3D { Mesh = footMesh, MaterialOverride = scaleMat };
        rightFoot.Position = new Vector3(0.02f * sizeVariation, -0.22f * sizeVariation, 0.06f * sizeVariation);
        rightFoot.Scale = new Vector3(1, 0.5f, 1.8f); // Longer for digitigrade
        rightLegNode.AddChild(rightFoot);
        AddLizardClaws(rightLegNode, clawMat, new Vector3(0.02f * sizeVariation, -0.24f * sizeVariation, 0.1f * sizeVariation), false, sizeVariation, lodLevel);
    }

    private static void AddLizardClaws(Node3D parent, StandardMaterial3D clawMat, Vector3 basePos, bool isLeft, float sizeVariation = 1f, int lodLevel = 0)
    {
        // 3-4 claws depending on LOD
        int clawCount = lodLevel < 2 ? 4 : 3;
        var clawMesh = new CylinderMesh
        {
            TopRadius = 0.002f * sizeVariation,
            BottomRadius = 0.008f * sizeVariation,
            Height = 0.03f * sizeVariation
        };
        float[] xOffsets = { -0.02f, -0.007f, 0.007f, 0.02f };
        float[] zOffsets = { 0.008f, 0.015f, 0.015f, 0.008f };

        for (int i = 0; i < clawCount; i++)
        {
            var claw = new MeshInstance3D();
            claw.Mesh = clawMesh;
            claw.MaterialOverride = clawMat;
            float xOff = isLeft ? xOffsets[i] : -xOffsets[i];
            claw.Position = basePos + new Vector3(xOff * sizeVariation, 0, zOffsets[i] * sizeVariation);
            claw.RotationDegrees = new Vector3(-60, 0, isLeft ? -15 + i * 10 : 15 - i * 10);
            parent.AddChild(claw);
        }
    }

    private static Color GetRandomLizardScaleColor(Random random)
    {
        // Color variations: green, brown, blue, red
        int colorType = random.Next(0, 4);
        return colorType switch
        {
            0 => new Color(0.3f + (float)random.NextDouble() * 0.2f, 0.5f + (float)random.NextDouble() * 0.2f, 0.25f), // Green
            1 => new Color(0.45f + (float)random.NextDouble() * 0.15f, 0.35f + (float)random.NextDouble() * 0.15f, 0.2f), // Brown
            2 => new Color(0.2f, 0.35f + (float)random.NextDouble() * 0.2f, 0.5f + (float)random.NextDouble() * 0.2f), // Blue
            _ => new Color(0.55f + (float)random.NextDouble() * 0.15f, 0.25f, 0.2f) // Red
        };
    }

    // ==========================================
    // BOSS MONSTERS
    // ==========================================

    private static void CreateSkeletonLordMesh(Node3D parent, LimbNodes limbs)
    {
        // Larger, more menacing skeleton with crown and cape
        Color boneColor = new Color(0.85f, 0.82f, 0.7f);
        Color crownColor = new Color(0.9f, 0.75f, 0.2f);
        Color capeColor = new Color(0.3f, 0.1f, 0.15f);

        var boneMat = new StandardMaterial3D { AlbedoColor = boneColor, Roughness = 0.8f };
        var crownMat = new StandardMaterial3D
        {
            AlbedoColor = crownColor,
            Metallic = 0.8f,
            Roughness = 0.2f,
            EmissionEnabled = true,
            Emission = crownColor * 0.2f
        };
        var capeMat = new StandardMaterial3D { AlbedoColor = capeColor, Roughness = 0.9f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.2f, 1f, 0.4f),
            EmissionEnabled = true,
            Emission = new Color(0.2f, 1f, 0.4f) * 0.8f
        };

        float scale = 1.4f;

        // Create base skeleton (scaled up)
        // Skull
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 1.5f * scale, 0);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var skull = new MeshInstance3D();
        var skullMesh = new SphereMesh { Radius = 0.22f * scale, Height = 0.44f * scale };
        skull.Mesh = skullMesh;
        skull.MaterialOverride = boneMat;
        skull.Scale = new Vector3(0.9f, 1f, 0.85f);
        headNode.AddChild(skull);

        // Crown
        var crown = new MeshInstance3D();
        var crownMesh = new CylinderMesh { TopRadius = 0.18f * scale, BottomRadius = 0.15f * scale, Height = 0.12f * scale };
        crown.Mesh = crownMesh;
        crown.MaterialOverride = crownMat;
        crown.Position = new Vector3(0, 0.18f * scale, 0);
        headNode.AddChild(crown);

        // Crown spikes
        var spikeMesh = new CylinderMesh { TopRadius = 0.01f * scale, BottomRadius = 0.03f * scale, Height = 0.15f * scale };
        for (int i = 0; i < 5; i++)
        {
            var spike = new MeshInstance3D { Mesh = spikeMesh, MaterialOverride = crownMat };
            float angle = i * Mathf.Pi * 2f / 5f;
            spike.Position = new Vector3(Mathf.Cos(angle) * 0.12f * scale, 0.28f * scale, Mathf.Sin(angle) * 0.12f * scale);
            headNode.AddChild(spike);
        }

        // Glowing green eyes
        var socketMesh = new SphereMesh { Radius = 0.06f * scale, Height = 0.12f * scale };
        var leftSocket = new MeshInstance3D { Mesh = socketMesh, MaterialOverride = eyeMat };
        leftSocket.Position = new Vector3(-0.07f * scale, 0.02f, 0.14f * scale);
        headNode.AddChild(leftSocket);

        var rightSocket = new MeshInstance3D { Mesh = socketMesh, MaterialOverride = eyeMat };
        rightSocket.Position = new Vector3(0.07f * scale, 0.02f, 0.14f * scale);
        headNode.AddChild(rightSocket);

        // Spine
        var spineMesh = new CylinderMesh { TopRadius = 0.04f * scale, BottomRadius = 0.04f * scale, Height = 0.6f * scale };
        var spine = new MeshInstance3D { Mesh = spineMesh, MaterialOverride = boneMat };
        spine.Position = new Vector3(0, 1.0f * scale, 0);
        parent.AddChild(spine);

        // Cape
        var cape = new MeshInstance3D();
        var capeMesh = new BoxMesh { Size = new Vector3(0.6f * scale, 0.8f * scale, 0.05f * scale) };
        cape.Mesh = capeMesh;
        cape.MaterialOverride = capeMat;
        cape.Position = new Vector3(0, 0.9f * scale, -0.15f * scale);
        parent.AddChild(cape);

        // Ribs (bigger)
        for (int i = 0; i < 5; i++)
        {
            float y = 1.2f * scale - i * 0.1f * scale;
            var ribMesh = new CylinderMesh { TopRadius = 0.02f * scale, BottomRadius = 0.02f * scale, Height = 0.25f * scale };

            var leftRib = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            leftRib.Position = new Vector3(-0.12f * scale, y, 0.05f * scale);
            leftRib.RotationDegrees = new Vector3(0, 0, -45);
            parent.AddChild(leftRib);

            var rightRib = new MeshInstance3D { Mesh = ribMesh, MaterialOverride = boneMat };
            rightRib.Position = new Vector3(0.12f * scale, y, 0.05f * scale);
            rightRib.RotationDegrees = new Vector3(0, 0, 45);
            parent.AddChild(rightRib);
        }

        // Pelvis
        var pelvisMesh = new BoxMesh { Size = new Vector3(0.3f * scale, 0.12f * scale, 0.12f * scale) };
        var pelvis = new MeshInstance3D { Mesh = pelvisMesh, MaterialOverride = boneMat };
        pelvis.Position = new Vector3(0, 0.6f * scale, 0);
        parent.AddChild(pelvis);

        // Arms with sword
        CreateSkeletonLordArm(parent, limbs, boneMat, scale, true);
        CreateSkeletonLordArm(parent, limbs, boneMat, scale, false);

        // Legs
        CreateSkeletonLeg(parent, limbs, boneMat, true);
        CreateSkeletonLeg(parent, limbs, boneMat, false);
    }

    private static void CreateSkeletonLordArm(Node3D parent, LimbNodes limbs, StandardMaterial3D material, float scale, bool isLeft)
    {
        float side = isLeft ? -1 : 1;
        var armNode = new Node3D();
        armNode.Position = new Vector3(side * 0.25f * scale, 1.2f * scale, 0);
        parent.AddChild(armNode);

        if (isLeft) limbs.LeftArm = armNode;
        else limbs.RightArm = armNode;

        var armMesh = new CylinderMesh { TopRadius = 0.03f * scale, BottomRadius = 0.025f * scale, Height = 0.3f * scale };

        var upperArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = material };
        upperArm.Position = new Vector3(0, -0.15f * scale, 0);
        armNode.AddChild(upperArm);

        var lowerArm = new MeshInstance3D { Mesh = armMesh, MaterialOverride = material };
        lowerArm.Position = new Vector3(0, -0.4f * scale, 0);
        armNode.AddChild(lowerArm);

        // Right hand holds a sword
        if (!isLeft)
        {
            var swordMat = new StandardMaterial3D
            {
                AlbedoColor = new Color(0.7f, 0.7f, 0.75f),
                Metallic = 0.9f,
                Roughness = 0.3f
            };
            var sword = new MeshInstance3D();
            var swordMesh = new BoxMesh { Size = new Vector3(0.04f * scale, 0.6f * scale, 0.01f * scale) };
            sword.Mesh = swordMesh;
            sword.MaterialOverride = swordMat;
            sword.Position = new Vector3(0, -0.8f * scale, 0);
            armNode.AddChild(sword);
            limbs.Weapon = sword;
        }
    }

    /// <summary>
    /// Creates the Dragon King boss - a massive, imposing dragon with crown and battle scars.
    /// Uses the enhanced CreateDragonMesh with boss-level parameters (3x scale, branching horns, max wingspan).
    /// </summary>
    private static void CreateDragonKingMesh(Node3D parent, LimbNodes limbs)
    {
        // Dragon King: Massive black dragon with branching horns, max wing span, and boss presence
        // scaleColorType: 1=Black (dark menacing appearance)
        // hornStyle: 2=Branching (antler-like, regal appearance)
        // wingSpan: 1.3f (30% larger wings for dramatic silhouette)
        // tailStyle: 1=Spikes (dangerous tail)
        // sizeScale: 3.0f (3x normal size for true boss presence)
        // bossPresence: true (glowing chest, smoke effects)
        CreateDragonMesh(
            parent,
            limbs,
            lodLevel: 0,                // High detail for boss
            scaleColorType: 1,          // Black dragon with purple fire
            hornStyle: 2,               // Branching antler horns (regal)
            wingSpan: 1.3f,             // 30% larger wingspan
            tailStyle: 1,               // Spiked tail
            sizeScale: 3.0f,            // 3x scale = massive boss
            bossPresence: true          // Chest glow, smoke, enhanced effects
        );

        // Add battle scars (only on high-detail boss)
        AddDragonKingBattleScars(parent, limbs, 3.0f);

        // Add golden crown (boss identifier)
        AddDragonKingCrown(parent, limbs, 3.0f);
    }

    /// <summary>
    /// Adds battle scars to Dragon King showing it's a veteran of many fights.
    /// </summary>
    private static void AddDragonKingBattleScars(Node3D parent, LimbNodes limbs, float scale)
    {
        // Battle scar material (darker, rougher)
        var scarMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.1f, 0.08f, 0.12f),
            Roughness = 0.9f
        };

        // Wing tear/scar (left wing)
        if (limbs.LeftArm != null)
        {
            var tearMesh = new BoxMesh { Size = new Vector3(0.1f * scale, 0.02f * scale, 0.08f * scale) };
            var tear = new MeshInstance3D { Mesh = tearMesh, MaterialOverride = scarMat };
            tear.Position = new Vector3(-0.25f * scale, 0.05f * scale, 0.1f * scale);
            tear.RotationDegrees = new Vector3(15, 0, 35);
            limbs.LeftArm.AddChild(tear);
        }

        // Body scar (slash across body)
        var bodyScarMesh = new BoxMesh { Size = new Vector3(0.15f * scale, 0.025f * scale, 0.35f * scale) };
        var bodyScar = new MeshInstance3D { Mesh = bodyScarMesh, MaterialOverride = scarMat };
        bodyScar.Position = new Vector3(0.1f * scale, 0.75f * scale, 0.05f * scale);
        bodyScar.RotationDegrees = new Vector3(0, 25, 35);
        parent.AddChild(bodyScar);

        // Broken horn tip (optional dramatic flair)
        // Could add a jagged break to one of the horns
    }

    /// <summary>
    /// Adds ornate golden crown to Dragon King's head.
    /// </summary>
    private static void AddDragonKingCrown(Node3D parent, LimbNodes limbs, float scale)
    {
        if (limbs.Head == null) return;

        var crownColor = new Color(0.9f, 0.75f, 0.2f);
        var crownMat = new StandardMaterial3D
        {
            AlbedoColor = crownColor,
            Metallic = 0.9f,
            Roughness = 0.2f,
            EmissionEnabled = true,
            Emission = crownColor * 0.4f
        };

        // Crown base (circular band)
        var crownBase = new MeshInstance3D();
        var crownBaseMesh = new CylinderMesh {
            TopRadius = 0.19f * scale,
            BottomRadius = 0.16f * scale,
            Height = 0.1f * scale,
            RadialSegments = 24
        };
        crownBase.Mesh = crownBaseMesh;
        crownBase.MaterialOverride = crownMat;
        crownBase.Position = new Vector3(0, 0.22f * scale, -0.08f * scale);
        limbs.Head.AddChild(crownBase);

        // Crown spikes (7 majestic points)
        var spikeMesh = new CylinderMesh {
            TopRadius = 0.008f * scale,
            BottomRadius = 0.032f * scale,
            Height = 0.15f * scale,
            RadialSegments = 12
        };

        for (int i = 0; i < 7; i++)
        {
            var spike = new MeshInstance3D { Mesh = spikeMesh, MaterialOverride = crownMat };
            float angle = i * Mathf.Pi * 2f / 7f;
            float radius = 0.14f * scale;
            spike.Position = new Vector3(
                Mathf.Cos(angle) * radius,
                0.33f * scale,
                -0.08f * scale + Mathf.Sin(angle) * radius
            );
            spike.RotationDegrees = new Vector3(8, 0, 0); // Slight outward tilt
            limbs.Head.AddChild(spike);

            // Glowing orbs on alternating spikes
            if (i % 2 == 0)
            {
                var orbMesh = new SphereMesh { Radius = 0.022f * scale, Height = 0.044f * scale };
                var orb = new MeshInstance3D { Mesh = orbMesh, MaterialOverride = crownMat };
                orb.Position = new Vector3(
                    Mathf.Cos(angle) * radius * 0.95f,
                    0.40f * scale,
                    -0.08f * scale + Mathf.Sin(angle) * radius * 0.95f
                );
                limbs.Head.AddChild(orb);

                // Add point light to orb for extra drama
                var orbLight = new OmniLight3D();
                orbLight.LightColor = crownColor;
                orbLight.LightEnergy = 0.4f;
                orbLight.OmniRange = 2f * scale;
                orbLight.Position = orb.Position;
                limbs.Head.AddChild(orbLight);
            }
        }

        // Center crown jewel
        var jewelMesh = new SphereMesh { Radius = 0.045f * scale, Height = 0.09f * scale, RadialSegments = 20 };
        var jewelMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.8f, 0.2f, 0.9f), // Purple gem
            EmissionEnabled = true,
            Emission = new Color(0.8f, 0.2f, 0.9f) * 1.2f,
            Metallic = 0.3f,
            Roughness = 0.1f
        };
        var jewel = new MeshInstance3D { Mesh = jewelMesh, MaterialOverride = jewelMat };
        jewel.Position = new Vector3(0, 0.42f * scale, 0.05f * scale);
        limbs.Head.AddChild(jewel);

        // Jewel light
        var jewelLight = new OmniLight3D();
        jewelLight.LightColor = new Color(0.8f, 0.2f, 0.9f);
        jewelLight.LightEnergy = 0.6f;
        jewelLight.OmniRange = 3f * scale;
        jewelLight.Position = jewel.Position;
        limbs.Head.AddChild(jewelLight);
    }

    private static void CreateSpiderQueenMesh(Node3D parent, LimbNodes limbs)
    {
        Color bodyColor = new Color(0.15f, 0.05f, 0.1f); // Dark purple-red
        Color markingColor = new Color(0.8f, 0.2f, 0.3f);

        var bodyMat = new StandardMaterial3D { AlbedoColor = bodyColor, Roughness = 0.6f, Metallic = 0.1f };
        var markingMat = new StandardMaterial3D
        {
            AlbedoColor = markingColor,
            EmissionEnabled = true,
            Emission = markingColor * 0.3f
        };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(1f, 0.8f, 0.2f),
            EmissionEnabled = true,
            Emission = new Color(1f, 0.8f, 0.2f) * 0.6f
        };

        float scale = 1.8f;

        // Large abdomen
        var abdomen = new MeshInstance3D();
        var abdomenMesh = new SphereMesh { Radius = 0.35f * scale, Height = 0.7f * scale };
        abdomen.Mesh = abdomenMesh;
        abdomen.MaterialOverride = bodyMat;
        abdomen.Position = new Vector3(0, 0.45f * scale, -0.3f * scale);
        abdomen.Scale = new Vector3(1f, 0.8f, 1.3f);
        parent.AddChild(abdomen);

        // Red markings on abdomen
        var markMesh = new SphereMesh { Radius = 0.08f * scale, Height = 0.16f * scale };
        var mark1 = new MeshInstance3D { Mesh = markMesh, MaterialOverride = markingMat };
        mark1.Position = new Vector3(0, 0.55f * scale, -0.5f * scale);
        parent.AddChild(mark1);

        var mark2 = new MeshInstance3D { Mesh = markMesh, MaterialOverride = markingMat };
        mark2.Position = new Vector3(-0.1f * scale, 0.45f * scale, -0.55f * scale);
        mark2.Scale = new Vector3(0.7f, 0.7f, 0.7f);
        parent.AddChild(mark2);

        var mark3 = new MeshInstance3D { Mesh = markMesh, MaterialOverride = markingMat };
        mark3.Position = new Vector3(0.1f * scale, 0.45f * scale, -0.55f * scale);
        mark3.Scale = new Vector3(0.7f, 0.7f, 0.7f);
        parent.AddChild(mark3);

        // Cephalothorax (front body/head)
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 0.45f * scale, 0.2f * scale);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var cephalo = new MeshInstance3D();
        var cephaloMesh = new SphereMesh { Radius = 0.22f * scale, Height = 0.44f * scale };
        cephalo.Mesh = cephaloMesh;
        cephalo.MaterialOverride = bodyMat;
        headNode.AddChild(cephalo);

        // Crown of small spikes
        var spikeMesh = new CylinderMesh { TopRadius = 0.005f * scale, BottomRadius = 0.02f * scale, Height = 0.1f * scale };
        for (int i = 0; i < 6; i++)
        {
            var spike = new MeshInstance3D { Mesh = spikeMesh, MaterialOverride = markingMat };
            float angle = i * Mathf.Pi * 2f / 6f;
            spike.Position = new Vector3(Mathf.Cos(angle) * 0.15f * scale, 0.18f * scale, Mathf.Sin(angle) * 0.15f * scale);
            headNode.AddChild(spike);
        }

        // 8 glowing eyes
        var eyeMesh = new SphereMesh { Radius = 0.04f * scale, Height = 0.08f * scale };
        float[] eyeX = { -0.1f, -0.05f, 0.05f, 0.1f };
        float[] eyeY = { 0.08f, 0.12f, 0.12f, 0.08f };
        foreach (int i in new int[] { 0, 1, 2, 3 })
        {
            var eye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
            eye.Position = new Vector3(eyeX[i] * scale, eyeY[i] * scale, 0.15f * scale);
            headNode.AddChild(eye);
        }
        // Second row of smaller eyes
        var smallEyeMesh = new SphereMesh { Radius = 0.025f * scale, Height = 0.05f * scale };
        var eye5 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye5.Position = new Vector3(-0.07f * scale, 0.02f * scale, 0.18f * scale);
        headNode.AddChild(eye5);
        var eye6 = new MeshInstance3D { Mesh = smallEyeMesh, MaterialOverride = eyeMat };
        eye6.Position = new Vector3(0.07f * scale, 0.02f * scale, 0.18f * scale);
        headNode.AddChild(eye6);

        // Fangs
        var fangMesh = new CylinderMesh { TopRadius = 0.01f * scale, BottomRadius = 0.025f * scale, Height = 0.12f * scale };
        var leftFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = markingMat };
        leftFang.Position = new Vector3(-0.06f * scale, -0.08f * scale, 0.15f * scale);
        leftFang.RotationDegrees = new Vector3(20, 0, 10);
        headNode.AddChild(leftFang);

        var rightFang = new MeshInstance3D { Mesh = fangMesh, MaterialOverride = markingMat };
        rightFang.Position = new Vector3(0.06f * scale, -0.08f * scale, 0.15f * scale);
        rightFang.RotationDegrees = new Vector3(20, 0, -10);
        headNode.AddChild(rightFang);

        // 8 long legs
        var legMesh = new CylinderMesh { TopRadius = 0.025f * scale, BottomRadius = 0.02f * scale, Height = 0.45f * scale };
        float[] legAngles = { 25f, 55f, 125f, 155f };

        for (int side = -1; side <= 1; side += 2)
        {
            for (int i = 0; i < 4; i++)
            {
                var legNode = new Node3D();
                float angle = legAngles[i] * Mathf.Pi / 180f;
                legNode.Position = new Vector3(side * 0.15f * scale, 0.45f * scale, Mathf.Cos(angle) * 0.12f * scale);
                legNode.RotationDegrees = new Vector3(0, 0, side * (35 + i * 12));
                parent.AddChild(legNode);

                var leg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = bodyMat };
                leg.Position = new Vector3(side * 0.22f * scale, 0, 0);
                legNode.AddChild(leg);

                // Lower leg segment
                var lowerLeg = new MeshInstance3D { Mesh = legMesh, MaterialOverride = bodyMat };
                lowerLeg.Position = new Vector3(side * 0.42f * scale, -0.15f * scale, 0);
                lowerLeg.RotationDegrees = new Vector3(0, 0, side * -30);
                legNode.AddChild(lowerLeg);

                if (i == 0)
                {
                    if (side == -1) limbs.LeftArm = legNode;
                    else limbs.RightArm = legNode;
                }
                else if (i == 3)
                {
                    if (side == -1) limbs.LeftLeg = legNode;
                    else limbs.RightLeg = legNode;
                }
            }
        }
    }

    /// <summary>
    /// Create a Badlama mesh - a fire-breathing llama monster.
    /// Badlamas are ornery creatures that can breathe fire and have a nasty bite.
    /// </summary>
    private static void CreateBadlamaMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride)
    {
        // Llama colors - brownish fur with cream/white markings
        Color furColor = skinColorOverride ?? new Color(0.55f, 0.4f, 0.25f);
        Color lightFur = furColor.Lightened(0.35f);
        Color darkFur = furColor.Darkened(0.2f);
        Color hoofColor = new Color(0.2f, 0.15f, 0.1f);
        Color eyeColor = new Color(0.95f, 0.4f, 0.1f); // Fiery orange eyes
        Color noseColor = new Color(0.18f, 0.12f, 0.1f);
        Color teethColor = new Color(0.95f, 0.92f, 0.85f);

        var furMat = new StandardMaterial3D { AlbedoColor = furColor, Roughness = 0.95f };
        var lightFurMat = new StandardMaterial3D { AlbedoColor = lightFur, Roughness = 0.9f };
        var darkFurMat = new StandardMaterial3D { AlbedoColor = darkFur, Roughness = 0.95f };
        var hoofMat = new StandardMaterial3D { AlbedoColor = hoofColor, Roughness = 0.7f };
        var noseMat = new StandardMaterial3D { AlbedoColor = noseColor, Roughness = 0.6f };
        var teethMat = new StandardMaterial3D { AlbedoColor = teethColor, Roughness = 0.5f };
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = eyeColor,
            EmissionEnabled = true,
            Emission = eyeColor * 0.6f,
            EmissionEnergyMultiplier = 1.5f
        };
        var pupilMat = new StandardMaterial3D { AlbedoColor = Colors.Black };

        // Body (horizontal oval) - llama body is longer and barrel-shaped
        var body = new MeshInstance3D();
        var bodyMesh = new CapsuleMesh { Radius = 0.28f, Height = 0.85f };
        body.Mesh = bodyMesh;
        body.MaterialOverride = furMat;
        body.Position = new Vector3(0, 0.7f, 0);
        body.RotationDegrees = new Vector3(0, 0, 90);
        parent.AddChild(body);

        // Fluffy underbelly/chest
        var chest = new MeshInstance3D();
        var chestMesh = new CapsuleMesh { Radius = 0.2f, Height = 0.5f };
        chest.Mesh = chestMesh;
        chest.MaterialOverride = lightFurMat;
        chest.Position = new Vector3(0, 0.6f, 0.1f);
        chest.RotationDegrees = new Vector3(0, 0, 90);
        parent.AddChild(chest);

        // Back hump (llamas have a slight hump)
        var humpMesh = new SphereMesh { Radius = 0.15f, Height = 0.3f };
        var hump = new MeshInstance3D { Mesh = humpMesh, MaterialOverride = furMat };
        hump.Position = new Vector3(0, 0.85f, 0);
        hump.Scale = new Vector3(1f, 0.7f, 0.9f);
        parent.AddChild(hump);

        // Long neck (llamas have very long necks)
        var neck = new MeshInstance3D();
        var neckMesh = new CylinderMesh { TopRadius = 0.08f, BottomRadius = 0.12f, Height = 0.55f };
        neck.Mesh = neckMesh;
        neck.MaterialOverride = furMat;
        neck.Position = new Vector3(0, 1.05f, 0.3f);
        neck.RotationDegrees = new Vector3(-25, 0, 0);
        parent.AddChild(neck);

        // Fluffy neck wool
        var neckWool = new MeshInstance3D();
        var neckWoolMesh = new CylinderMesh { TopRadius = 0.1f, BottomRadius = 0.14f, Height = 0.45f };
        neckWool.Mesh = neckWoolMesh;
        neckWool.MaterialOverride = lightFurMat;
        neckWool.Position = new Vector3(0, 0.95f, 0.28f);
        neckWool.RotationDegrees = new Vector3(-25, 0, 0);
        parent.AddChild(neckWool);

        // Head (llama head is elongated)
        var headNode = new Node3D();
        headNode.Position = new Vector3(0, 1.4f, 0.5f);
        parent.AddChild(headNode);
        limbs.Head = headNode;

        var head = new MeshInstance3D();
        var headMesh = new CapsuleMesh { Radius = 0.1f, Height = 0.25f };
        head.Mesh = headMesh;
        head.MaterialOverride = furMat;
        head.RotationDegrees = new Vector3(-70, 0, 0);
        headNode.AddChild(head);

        // Snout/muzzle (llamas have elongated faces)
        var snout = new MeshInstance3D();
        var snoutMesh = new CylinderMesh { TopRadius = 0.045f, BottomRadius = 0.06f, Height = 0.12f };
        snout.Mesh = snoutMesh;
        snout.MaterialOverride = lightFurMat;
        snout.Position = new Vector3(0, -0.03f, 0.16f);
        snout.RotationDegrees = new Vector3(-80, 0, 0);
        headNode.AddChild(snout);

        // Upper lip (slightly split like llama)
        var lipMesh = new SphereMesh { Radius = 0.04f, Height = 0.08f };
        var upperLip = new MeshInstance3D { Mesh = lipMesh, MaterialOverride = lightFurMat };
        upperLip.Position = new Vector3(0, -0.08f, 0.22f);
        upperLip.Scale = new Vector3(1.2f, 0.7f, 0.8f);
        headNode.AddChild(upperLip);

        // Nose
        var nose = new MeshInstance3D();
        var noseMesh = new SphereMesh { Radius = 0.025f, Height = 0.05f };
        nose.Mesh = noseMesh;
        nose.MaterialOverride = noseMat;
        nose.Position = new Vector3(0, -0.06f, 0.25f);
        headNode.AddChild(nose);

        // Nostrils (smoke may come from here!)
        var nostrilMesh = new SphereMesh { Radius = 0.008f, Height = 0.016f };
        var nostrilMat = new StandardMaterial3D
        {
            AlbedoColor = Colors.Black,
            EmissionEnabled = true,
            Emission = new Color(1f, 0.3f, 0.1f) * 0.3f // Slight orange glow
        };
        var leftNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
        leftNostril.Position = new Vector3(-0.015f, -0.065f, 0.26f);
        headNode.AddChild(leftNostril);
        var rightNostril = new MeshInstance3D { Mesh = nostrilMesh, MaterialOverride = nostrilMat };
        rightNostril.Position = new Vector3(0.015f, -0.065f, 0.26f);
        headNode.AddChild(rightNostril);

        // Big front teeth (for biting!)
        var toothMesh = new BoxMesh { Size = new Vector3(0.015f, 0.025f, 0.01f) };
        var leftTooth = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = teethMat };
        leftTooth.Position = new Vector3(-0.02f, -0.1f, 0.2f);
        headNode.AddChild(leftTooth);
        var rightTooth = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = teethMat };
        rightTooth.Position = new Vector3(0.02f, -0.1f, 0.2f);
        headNode.AddChild(rightTooth);

        // Fiery eyes (menacing orange glow)
        var eyeMesh = new SphereMesh { Radius = 0.03f, Height = 0.06f };
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.055f, 0.04f, 0.1f);
        headNode.AddChild(leftEye);
        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.055f, 0.04f, 0.1f);
        headNode.AddChild(rightEye);

        // Pupils (slitted like angry animal)
        var pupilMesh = new BoxMesh { Size = new Vector3(0.008f, 0.025f, 0.005f) };
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.055f, 0.04f, 0.125f);
        headNode.AddChild(leftPupil);
        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.055f, 0.04f, 0.125f);
        headNode.AddChild(rightPupil);

        // Long pointy ears (llama ears)
        var earMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.03f, Height = 0.12f };
        var leftEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = furMat };
        leftEar.Position = new Vector3(-0.08f, 0.12f, -0.02f);
        leftEar.RotationDegrees = new Vector3(-15, 0, -25);
        headNode.AddChild(leftEar);
        var rightEar = new MeshInstance3D { Mesh = earMesh, MaterialOverride = furMat };
        rightEar.Position = new Vector3(0.08f, 0.12f, -0.02f);
        rightEar.RotationDegrees = new Vector3(-15, 0, 25);
        headNode.AddChild(rightEar);

        // Inner ear (pink)
        var innerEarMesh = new CylinderMesh { TopRadius = 0.005f, BottomRadius = 0.018f, Height = 0.08f };
        var innerEarMat = new StandardMaterial3D { AlbedoColor = new Color(0.85f, 0.6f, 0.6f), Roughness = 0.9f };
        var leftInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = innerEarMat };
        leftInnerEar.Position = new Vector3(-0.08f, 0.11f, 0f);
        leftInnerEar.RotationDegrees = new Vector3(-15, 0, -25);
        headNode.AddChild(leftInnerEar);
        var rightInnerEar = new MeshInstance3D { Mesh = innerEarMesh, MaterialOverride = innerEarMat };
        rightInnerEar.Position = new Vector3(0.08f, 0.11f, 0f);
        rightInnerEar.RotationDegrees = new Vector3(-15, 0, 25);
        headNode.AddChild(rightInnerEar);

        // Fluffy forelock (tuft of fur on head)
        var forelockMesh = new SphereMesh { Radius = 0.06f, Height = 0.12f };
        var forelock = new MeshInstance3D { Mesh = forelockMesh, MaterialOverride = lightFurMat };
        forelock.Position = new Vector3(0, 0.12f, 0.02f);
        forelock.Scale = new Vector3(0.8f, 1f, 0.7f);
        headNode.AddChild(forelock);

        // Tail (llamas have short fluffy tails)
        var tailNode = new Node3D();
        tailNode.Position = new Vector3(0, 0.75f, -0.4f);
        parent.AddChild(tailNode);

        var tailMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.05f, Height = 0.15f };
        var tail = new MeshInstance3D { Mesh = tailMesh, MaterialOverride = furMat };
        tail.RotationDegrees = new Vector3(30, 0, 0);
        tailNode.AddChild(tail);

        var tailFluff = new MeshInstance3D();
        var tailFluffMesh = new SphereMesh { Radius = 0.05f, Height = 0.1f };
        tailFluff.Mesh = tailFluffMesh;
        tailFluff.MaterialOverride = lightFurMat;
        tailFluff.Position = new Vector3(0, 0.12f, 0);
        tailNode.AddChild(tailFluff);

        // 4 legs (llamas have long spindly legs)
        CreateBadlamaLeg(parent, limbs, furMat, hoofMat, true, true);   // Front left
        CreateBadlamaLeg(parent, limbs, furMat, hoofMat, false, true);  // Front right
        CreateBadlamaLeg(parent, limbs, furMat, hoofMat, true, false);  // Back left
        CreateBadlamaLeg(parent, limbs, furMat, hoofMat, false, false); // Back right
    }

    private static void CreateBadlamaLeg(Node3D parent, LimbNodes limbs, StandardMaterial3D furMat, StandardMaterial3D hoofMat, bool isLeft, bool isFront)
    {
        float xOffset = isLeft ? -0.18f : 0.18f;
        float zOffset = isFront ? 0.25f : -0.28f;

        var legNode = new Node3D();
        legNode.Position = new Vector3(xOffset, 0.55f, zOffset);
        parent.AddChild(legNode);

        // Upper leg
        var upperLeg = new MeshInstance3D();
        var upperLegMesh = new CylinderMesh { TopRadius = 0.055f, BottomRadius = 0.04f, Height = 0.28f };
        upperLeg.Mesh = upperLegMesh;
        upperLeg.MaterialOverride = furMat;
        upperLeg.Position = new Vector3(0, -0.14f, 0);
        legNode.AddChild(upperLeg);

        // Lower leg (thinner)
        var lowerLeg = new MeshInstance3D();
        var lowerLegMesh = new CylinderMesh { TopRadius = 0.035f, BottomRadius = 0.025f, Height = 0.25f };
        lowerLeg.Mesh = lowerLegMesh;
        lowerLeg.MaterialOverride = furMat;
        lowerLeg.Position = new Vector3(0, -0.4f, 0);
        legNode.AddChild(lowerLeg);

        // Hoof
        var hoof = new MeshInstance3D();
        var hoofMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.035f, Height = 0.06f };
        hoof.Mesh = hoofMesh;
        hoof.MaterialOverride = hoofMat;
        hoof.Position = new Vector3(0, -0.55f, 0);
        legNode.AddChild(hoof);

        // Store limb references
        if (isFront)
        {
            if (isLeft) limbs.LeftArm = legNode;
            else limbs.RightArm = legNode;
        }
        else
        {
            if (isLeft) limbs.LeftLeg = legNode;
            else limbs.RightLeg = legNode;
        }
    }

    /// <summary>
    /// Create Slime King boss mesh - larger, more menacing slime with crown and toxic effects
    /// </summary>
    private static void CreateSlimeKingMesh(Node3D parent, LimbNodes limbs, Color? skinColorOverride = null)
    {
        float bossScale = 2.5f; // 2.5x larger than normal slime
        Color bossColor = skinColorOverride ?? new Color(0.15f, 0.6f, 0.25f); // Darker, more toxic green
        Color toxicGlow = new Color(0.4f, 1f, 0.2f); // Bright toxic green
        Color bubbleColor = bossColor.Lightened(0.3f);

        int bodySegments = 40; // Extra smooth for boss
        int bodyRings = 32;

        var slimeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(bossColor.R, bossColor.G, bossColor.B, 0.7f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.12f,
            Metallic = 0.2f,
            RimEnabled = true,
            Rim = 0.4f,
            RimTint = 0.3f
        };

        var coreMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(bossColor.Darkened(0.4f).R, bossColor.Darkened(0.4f).G, bossColor.Darkened(0.4f).B, 0.85f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.2f,
            EmissionEnabled = true,
            Emission = toxicGlow * 0.15f
        };

        // Main body - massive asymmetric blob
        var body = new MeshInstance3D();
        var bodyMesh = new SphereMesh { Radius = 0.38f, Height = 0.76f, RadialSegments = bodySegments, Rings = bodyRings };
        body.Mesh = bodyMesh;
        body.MaterialOverride = slimeMat;
        body.Position = new Vector3(0, 0.38f * bossScale, 0);
        body.Scale = new Vector3(bossScale * 1.15f, bossScale * 0.8f, bossScale * 1.1f);
        parent.AddChild(body);
        limbs.Head = body;

        // Multiple overlapping body layers for depth
        for (int layer = 0; layer < 3; layer++)
        {
            var bodyLayer = new MeshInstance3D();
            var layerMesh = new SphereMesh { Radius = 0.36f - layer * 0.03f, Height = 0.72f - layer * 0.06f, RadialSegments = bodySegments, Rings = bodyRings };
            bodyLayer.Mesh = layerMesh;
            var layerMat = new StandardMaterial3D
            {
                AlbedoColor = new Color(bossColor.R, bossColor.G, bossColor.B, 0.4f - layer * 0.1f),
                Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
                Roughness = 0.15f + layer * 0.05f,
                Metallic = 0.15f
            };
            bodyLayer.MaterialOverride = layerMat;
            bodyLayer.Position = new Vector3(layer * 0.08f - 0.08f, 0.38f * bossScale, layer * 0.05f - 0.05f);
            bodyLayer.Scale = new Vector3(bossScale * (1.1f - layer * 0.05f), bossScale * (0.85f + layer * 0.05f), bossScale * (1.05f - layer * 0.03f));
            parent.AddChild(bodyLayer);
        }

        // Multiple nuclei cores - menacing
        for (int i = 0; i < 3; i++)
        {
            var core = new MeshInstance3D();
            var coreMesh = new SphereMesh { Radius = 0.18f - i * 0.03f, Height = 0.36f - i * 0.06f, RadialSegments = 28, Rings = 22 };
            core.Mesh = coreMesh;
            core.MaterialOverride = coreMat;

            float angle = i * 120f * Mathf.Pi / 180f;
            core.Position = new Vector3(
                Mathf.Cos(angle) * 0.15f * bossScale,
                (0.35f + i * 0.05f) * bossScale,
                Mathf.Sin(angle) * 0.15f * bossScale
            );
            core.Scale = Vector3.One * bossScale * (0.9f + i * 0.1f);
            parent.AddChild(core);

            // Glow around each nucleus
            var glow = new MeshInstance3D();
            var glowMesh = new SphereMesh { Radius = 0.24f - i * 0.03f, Height = 0.48f - i * 0.06f, RadialSegments = 24, Rings = 18 };
            glow.Mesh = glowMesh;
            var glowMat = new StandardMaterial3D
            {
                AlbedoColor = new Color(toxicGlow.R, toxicGlow.G, toxicGlow.B, 0.4f),
                Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
                EmissionEnabled = true,
                Emission = toxicGlow * 0.4f,
                BlendMode = BaseMaterial3D.BlendModeEnum.Add
            };
            glow.MaterialOverride = glowMat;
            glow.Position = core.Position;
            glow.Scale = Vector3.One * bossScale * 1.1f;
            parent.AddChild(glow);
        }

        // Crown/spikes on top
        var crownMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(0.8f, 0.7f, 0.2f), // Gold
            Metallic = 0.8f,
            Roughness = 0.3f,
            EmissionEnabled = true,
            Emission = new Color(0.8f, 0.7f, 0.2f) * 0.2f
        };

        int spikeCount = 8;
        for (int i = 0; i < spikeCount; i++)
        {
            var spike = new MeshInstance3D();
            var spikeMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.06f, Height = 0.25f };
            spike.Mesh = spikeMesh;
            spike.MaterialOverride = crownMat;

            float angle = i * (360f / spikeCount) * Mathf.Pi / 180f;
            float crownRadius = 0.35f * bossScale;
            spike.Position = new Vector3(
                Mathf.Cos(angle) * crownRadius,
                0.75f * bossScale,
                Mathf.Sin(angle) * crownRadius
            );
            spike.RotationDegrees = new Vector3(-10, 0, 0);
            spike.Scale = new Vector3(1f, 1f + (i % 2) * 0.3f, 1f);
            parent.AddChild(spike);
        }

        // Crown band
        var crownBand = new MeshInstance3D();
        var bandMesh = new CylinderMesh { TopRadius = 0.38f * bossScale, BottomRadius = 0.42f * bossScale, Height = 0.08f };
        crownBand.Mesh = bandMesh;
        crownBand.MaterialOverride = crownMat;
        crownBand.Position = new Vector3(0, 0.68f * bossScale, 0);
        parent.AddChild(crownBand);

        // Many bubbles
        var bubbleMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(bubbleColor.R, bubbleColor.G, bubbleColor.B, 0.6f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            Roughness = 0.08f,
            Metallic = 0.25f
        };

        for (int i = 0; i < 20; i++)
        {
            var bubble = new MeshInstance3D();
            var bubbleMesh = new SphereMesh { Radius = 0.04f + GD.Randf() * 0.06f, Height = 0.08f + GD.Randf() * 0.12f, RadialSegments = 16, Rings = 12 };
            bubble.Mesh = bubbleMesh;
            bubble.MaterialOverride = bubbleMat;

            float angle = GD.Randf() * 360f;
            float radius = GD.Randf() * 0.3f;
            bubble.Position = new Vector3(
                Mathf.Cos(angle * Mathf.Pi / 180f) * radius * bossScale,
                (0.2f + GD.Randf() * 0.5f) * bossScale,
                Mathf.Sin(angle * Mathf.Pi / 180f) * radius * bossScale
            );
            bubble.Scale = Vector3.One * (0.8f + GD.Randf() * 0.6f);
            parent.AddChild(bubble);
        }

        // Toxic dripping tendrils
        var dripMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(bossColor.R, bossColor.G, bossColor.B, 0.8f),
            Transparency = BaseMaterial3D.TransparencyEnum.Alpha,
            EmissionEnabled = true,
            Emission = toxicGlow * 0.1f,
            Roughness = 0.2f
        };

        for (int i = 0; i < 12; i++)
        {
            var drip = new MeshInstance3D();
            float dripHeight = 0.15f + GD.Randf() * 0.25f;
            var dripMesh = new CylinderMesh { TopRadius = 0.03f, BottomRadius = 0.08f, Height = dripHeight };
            drip.Mesh = dripMesh;
            drip.MaterialOverride = dripMat;

            float angle = (i / 12f * 360f + GD.Randf() * 20f) * Mathf.Pi / 180f;
            float dripDist = 0.32f + GD.Randf() * 0.15f;
            drip.Position = new Vector3(
                Mathf.Cos(angle) * dripDist * bossScale,
                0.1f * bossScale,
                Mathf.Sin(angle) * dripDist * bossScale
            );
            drip.RotationDegrees = new Vector3(0, 0, Mathf.Sin(angle * 3) * 20f);
            drip.Scale = new Vector3(1f + GD.Randf() * 0.5f, 1f, 1f + GD.Randf() * 0.5f);
            parent.AddChild(drip);
        }

        // Menacing eyes - three red glowing eyes
        var eyeMat = new StandardMaterial3D
        {
            AlbedoColor = new Color(1f, 0.3f, 0.2f),
            EmissionEnabled = true,
            Emission = new Color(1f, 0.2f, 0.1f) * 0.6f,
            Roughness = 0.15f
        };
        var pupilMat = new StandardMaterial3D
        {
            AlbedoColor = Colors.Black,
            EmissionEnabled = true,
            Emission = new Color(0.3f, 0f, 0f) * 0.3f
        };

        var eyeMesh = new SphereMesh { Radius = 0.12f, Height = 0.24f, RadialSegments = 24, Rings = 20 };
        var pupilMesh = new SphereMesh { Radius = 0.06f, Height = 0.12f, RadialSegments = 20, Rings = 16 };

        // Left eye
        var leftEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        leftEye.Position = new Vector3(-0.18f * bossScale, 0.52f * bossScale, 0.28f * bossScale);
        leftEye.Scale = new Vector3(1.1f, 1.2f, 0.9f);
        parent.AddChild(leftEye);
        var leftPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        leftPupil.Position = new Vector3(-0.18f * bossScale, 0.52f * bossScale, 0.38f * bossScale);
        leftPupil.Scale = new Vector3(1.2f, 1.1f, 1f);
        parent.AddChild(leftPupil);

        // Right eye
        var rightEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        rightEye.Position = new Vector3(0.18f * bossScale, 0.52f * bossScale, 0.28f * bossScale);
        rightEye.Scale = new Vector3(1.15f, 1.15f, 0.85f);
        parent.AddChild(rightEye);
        var rightPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        rightPupil.Position = new Vector3(0.18f * bossScale, 0.52f * bossScale, 0.38f * bossScale);
        rightPupil.Scale = new Vector3(1.1f, 1.2f, 1f);
        parent.AddChild(rightPupil);

        // Center eye (third eye)
        var centerEye = new MeshInstance3D { Mesh = eyeMesh, MaterialOverride = eyeMat };
        centerEye.Position = new Vector3(0, 0.68f * bossScale, 0.22f * bossScale);
        centerEye.Scale = new Vector3(1f, 1.1f, 0.8f);
        parent.AddChild(centerEye);
        var centerPupil = new MeshInstance3D { Mesh = pupilMesh, MaterialOverride = pupilMat };
        centerPupil.Position = new Vector3(0, 0.68f * bossScale, 0.3f * bossScale);
        centerPupil.Scale = new Vector3(1f, 1.1f, 1f);
        parent.AddChild(centerPupil);

        // Large menacing mouth with teeth
        var mouthMesh = new SphereMesh { Radius = 0.08f, Height = 0.16f };
        var mouthMat = new StandardMaterial3D
        {
            AlbedoColor = bossColor.Darkened(0.6f),
            EmissionEnabled = true,
            Emission = toxicGlow * 0.05f
        };
        var mouth = new MeshInstance3D { Mesh = mouthMesh, MaterialOverride = mouthMat };
        mouth.Position = new Vector3(0, 0.42f * bossScale, 0.38f * bossScale);
        mouth.Scale = new Vector3(2.2f, 1f, 0.6f);
        parent.AddChild(mouth);

        // Teeth
        var toothMat = new StandardMaterial3D { AlbedoColor = new Color(0.9f, 0.9f, 0.8f), Roughness = 0.6f };
        var toothMesh = new CylinderMesh { TopRadius = 0.01f, BottomRadius = 0.025f, Height = 0.08f };

        for (int i = 0; i < 8; i++)
        {
            var tooth = new MeshInstance3D { Mesh = toothMesh, MaterialOverride = toothMat };
            float toothX = -0.14f + i * 0.04f;
            tooth.Position = new Vector3(toothX * bossScale, 0.42f * bossScale, 0.42f * bossScale);
            tooth.RotationDegrees = new Vector3(90, 0, 0);
            tooth.Scale = new Vector3(1f, 1f, 0.8f + (i % 2) * 0.4f);
            parent.AddChild(tooth);
        }
    }
}

